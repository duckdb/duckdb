# name: test/sql/json/issues/issue18301.test
# description: Test issue 18301 - DuckDB JSON Schema Inconsistency - V 1.3.2
# group: [issues]

require json

statement ok
pragma enable_verification

statement ok
SET threads = 2;

statement ok
CREATE OR REPLACE TABLE cricket_staging AS
SELECT * FROM read_json('{DATA_DIR}/json/18301/*.json', filename=true)
WHERE 1=0;

statement ok
TRUNCATE cricket_staging;

statement ok
INSERT INTO cricket_staging
SELECT * FROM read_json('{DATA_DIR}/json/18301/*.json',
    union_by_name=true,
    filename=true
);

query I
SELECT list_sort(map_entries((info->'$.outcome.by')::MAP(VARCHAR, VARCHAR))) as outcome_by
FROM cricket_staging
WHERE info->>'$.city' = 'Colombo';
----
[{'key': innings, 'value': 1}, {'key': runs, 'value': 175}, {'key': wickets, 'value': NULL}]
