# name: test/sql/function/string/test_complex_unicode.test
# description: Test correct behavior of various string functions under complex unicode characters
# group: [string]

statement ok
PRAGMA enable_verification

# length_grapheme returns the number of grapheme clusters
query I
SELECT length_grapheme('SÌˆa')
----
2

query I
SELECT length_grapheme('ğŸ¤¦ğŸ¼â€â™‚ï¸')
----
1

query I
SELECT length_grapheme('ğŸ¤¦ğŸ¼â€â™‚ï¸ LğŸ¤¦ğŸ¼â€â™‚ï¸R ğŸ¤¦ğŸ¼â€â™‚ï¸')
----
7

# length returns the number of unicode codepoints
query I
SELECT length('SÌˆa')
----
3

query I
SELECT length('ğŸ¤¦ğŸ¼â€â™‚ï¸')
----
5

query I
SELECT length('ğŸ¤¦ğŸ¼â€â™‚ï¸ LğŸ¤¦ğŸ¼â€â™‚ï¸R ğŸ¤¦ğŸ¼â€â™‚ï¸')
----
19

# strlen returns size in bytes
query I
SELECT strlen('ğŸ¤¦ğŸ¼â€â™‚ï¸')
----
17

query I
SELECT strlen('SÌˆa')
----
4

# reverse with grapheme clusters
query T
SELECT REVERSE('SÌˆaï¸')
----
aï¸SÌˆ

query T
SELECT REVERSE('ZÍ‘Í«Ì“ÍªÌ‚Í«Ì½ÍÌ´Ì™Ì¤ÌÍ‰ÍšÌ¯ÌÌ ÍAÌ´ÌµÌœÌ°Í”Í«Í—Í¢')
----
AÌ´ÌµÌœÌ°Í”Í«Í—Í¢ZÍ‘Í«Ì“ÍªÌ‚Í«Ì½ÍÌ´Ì™Ì¤ÌÍ‰ÍšÌ¯ÌÌ Í

query T
SELECT REVERSE('ğŸ¤¦ğŸ¼â€â™‚ï¸')
----
ğŸ¤¦ğŸ¼â€â™‚ï¸

query T
SELECT REVERSE('ğŸ¤¦ğŸ¼â€â™‚ï¸ LğŸ¤¦ğŸ¼â€â™‚ï¸R ğŸ¤¦ğŸ¼â€â™‚ï¸')
----
ğŸ¤¦ğŸ¼â€â™‚ï¸ RğŸ¤¦ğŸ¼â€â™‚ï¸L ğŸ¤¦ğŸ¼â€â™‚ï¸

query T
SELECT REVERSE('MotÃ¶rHead')
----
daeHrÃ¶toM

# substring with grapheme clusters
query T
SELECT substring_grapheme('ğŸ¤¦ğŸ¼â€â™‚ï¸ğŸ¤¦ğŸ¼â€â™‚ï¸ğŸ¤¦ğŸ¼â€â™‚ï¸', 1, 1)
----
ğŸ¤¦ğŸ¼â€â™‚ï¸

query T
SELECT substring_grapheme('SÌˆaï¸', 2, 1)
----
aï¸

query T
SELECT substring_grapheme('test: ğŸ¤¦ğŸ¼â€â™‚ï¸helloğŸ¤¦ğŸ¼â€â™‚ï¸ world', 7, 7)
----
ğŸ¤¦ğŸ¼â€â™‚ï¸helloğŸ¤¦ğŸ¼â€â™‚ï¸

query T
SELECT substring_grapheme('SÌˆa', 1, 1)
----
SÌˆ

query T
SELECT substring_grapheme('SÌˆaï¸', -1, 1)
----
aï¸
