# name: test/sql/function/timestamp/test_time_bucket_timestamp.test
# description: Test time bucket functionality
# group: [timestamp]

statement ok
PRAGMA enable_verification

statement ok
CREATE TABLE timestamps(w INTERVAL, t TIMESTAMP, shift INTERVAL, origin TIMESTAMP);

statement ok
INSERT INTO timestamps VALUES ('10 days', '-infinity', '0 days', '1970-01-05 00:00:00'),
	('10 days', '3000-01-02 (BC) 03:16:23.003003', '3 days', '3000-01-01 (BC) 00:00:00'),
	('2 months', '1024-04-10 (BC) 12:35:40.003003', '10 days', '1024-03-01 (BC) 00:00:00'),
	('10 days', '0044-06-15 (BC) 12:35:40.003003', '6 days', '0044-02-01 (BC) 00:00:00'),
	('333 microseconds', '0678-06-30 02:02:03.003003', '0 microseconds', '1970-02-10 00:00:00'),
	('333 microseconds', '0794-07-03 02:02:04.003003', '444 microseconds', '1970-10-17 00:05:05.006006'),
	('333 microseconds', '1700-01-01 00:00:00', '-444 microseconds', '1970-09-27 00:05:05.006006'),
	('333 milliseconds', '1962-12-31 00:00:00', '0 milliseconds', '1970-08-12 00:00:00'),
	('333 milliseconds', '1970-01-01 00:00:00', '444 milliseconds', '1970-06-23 00:05:05.006006'),
	('333 milliseconds', '1985-12-07 02:02:08.003003', '-444 milliseconds', '1970-01-05 00:05:05.006006'),
	('333 seconds', '1989-10-18 02:02:09.003003', '0 seconds', '1970-09-07 00:00:00'),
	('333 seconds', '1990-01-21 02:02:10.003003', '444 seconds', '1970-07-06 00:05:05.006006'),
	('333 seconds', '1991-02-10 02:02:11.003003', '-444 seconds', '1970-10-09 00:05:05.006006'),
	('333 minutes', '1992-09-11 02:02:12.003003', '0 minutes', '1970-04-10 00:00:00'),
	('333 minutes', '1994-12-26 02:02:13.003003', '444 minute', '1970-03-05 00:05:05.006006'),
	('333 minutes', '1997-05-13 02:02:14.003003', '-444 minute', '2000-01-03 00:00:00'),
	('333 hours', '1999-02-14 02:02:15.003003', '0 hours', '2000-01-01 00:00:00'),
	('333 hours', '2000-01-01 00:00:00', '444 hours', '1980-11-25 00:05:05.006006'),
	('333 hours', '2000-01-03 00:00:00', '-444 hours', '2045-01-05 00:05:05.006006'),
	('10 days', '2008-09-17 02:02:18.003003', '0 days', '2009-11-05 00:00:00'),
	('1 week', '2010-08-18 02:02:19.003003', '0 days', '2100-09-05 00:00:00'),
	('10 days', '2013-03-19 02:02:20.003003', '2 days 4 hours', '2300-10-07 00:05:05.006006'),
	('10 days', '2014-11-20 02:02:21.003003', '-2 days 4 hours', '1970-12-07 00:05:05.006006'),
	('2 months', '2016-02-21 02:02:22.003003', '0 months', '1970-09-05 00:00:00'),
	('2 months', '2018-08-22 02:02:23.003003', '1 month 1 week', '1970-07-01 00:05:05.006006'),
	('2 months', '2019-01-23 02:02:24.003003', '-1 month 1 week', '1969-09-01 00:05:05.006006'),
	('2 year', '2020-02-24 02:02:25.003003', '6 months', '1970-02-13 00:05:05.006006'),
	('2 year', '2022-07-25 02:02:26.003003', '-6 months', '1969-10-09 00:05:05.006006'),
	('10 days', '2024-02-25 02:02:26.003003', '1 year', '-infinity'),
	('10 days', '2032-09-25 02:02:26.003003', '-1 year', 'infinity'),
	('10 days', 'infinity', '0 days', '1970-01-01 00:00:00'),
;

query II
select t, time_bucket('56 seconds'::interval, t) from timestamps;
----
-infinity	-infinity
3000-01-02 (BC) 03:16:23.003003	3000-01-02 (BC) 03:15:36
1024-04-10 (BC) 12:35:40.003003	1024-04-10 (BC) 12:35:28
0044-06-15 (BC) 12:35:40.003003	0044-06-15 (BC) 12:34:48
0678-06-30 02:02:03.003003	0678-06-30 02:01:12
0794-07-03 02:02:04.003003	0794-07-03 02:01:12
1700-01-01 00:00:00	1699-12-31 23:59:36
1962-12-31 00:00:00	1962-12-31 00:00:00
1970-01-01 00:00:00	1969-12-31 23:59:28
1985-12-07 02:02:08.003003	1985-12-07 02:02:00
1989-10-18 02:02:09.003003	1989-10-18 02:01:36
1990-01-21 02:02:10.003003	1990-01-21 02:02:08
1991-02-10 02:02:11.003003	1991-02-10 02:02:08
1992-09-11 02:02:12.003003	1992-09-11 02:01:52
1994-12-26 02:02:13.003003	1994-12-26 02:01:20
1997-05-13 02:02:14.003003	1997-05-13 02:01:28
1999-02-14 02:02:15.003003	1999-02-14 02:02:08
2000-01-01 00:00:00	1999-12-31 23:59:44
2000-01-03 00:00:00	2000-01-03 00:00:00
2008-09-17 02:02:18.003003	2008-09-17 02:01:36
2010-08-18 02:02:19.003003	2010-08-18 02:01:36
2013-03-19 02:02:20.003003	2013-03-19 02:01:28
2014-11-20 02:02:21.003003	2014-11-20 02:01:44
2016-02-21 02:02:22.003003	2016-02-21 02:02:08
2018-08-22 02:02:23.003003	2018-08-22 02:01:36
2019-01-23 02:02:24.003003	2019-01-23 02:01:36
2020-02-24 02:02:25.003003	2020-02-24 02:02:16
2022-07-25 02:02:26.003003	2022-07-25 02:02:16
2024-02-25 02:02:26.003003	2024-02-25 02:02:08
2032-09-25 02:02:26.003003	2032-09-25 02:02:00
infinity	infinity

query II
select t, time_bucket('3 days'::interval, t) from timestamps;
----
-infinity	-infinity
3000-01-02 (BC) 03:16:23.003003	3000-01-02 (BC) 00:00:00
1024-04-10 (BC) 12:35:40.003003	1024-04-10 (BC) 00:00:00
0044-06-15 (BC) 12:35:40.003003	0044-06-14 (BC) 00:00:00
0678-06-30 02:02:03.003003	0678-06-29 00:00:00
0794-07-03 02:02:04.003003	0794-07-03 00:00:00
1700-01-01 00:00:00	1699-12-31 00:00:00
1962-12-31 00:00:00	1962-12-30 00:00:00
1970-01-01 00:00:00	1970-01-01 00:00:00
1985-12-07 02:02:08.003003	1985-12-05 00:00:00
1989-10-18 02:02:09.003003	1989-10-18 00:00:00
1990-01-21 02:02:10.003003	1990-01-19 00:00:00
1991-02-10 02:02:11.003003	1991-02-10 00:00:00
1992-09-11 02:02:12.003003	1992-09-11 00:00:00
1994-12-26 02:02:13.003003	1994-12-24 00:00:00
1997-05-13 02:02:14.003003	1997-05-12 00:00:00
1999-02-14 02:02:15.003003	1999-02-13 00:00:00
2000-01-01 00:00:00	1999-12-31 00:00:00
2000-01-03 00:00:00	2000-01-03 00:00:00
2008-09-17 02:02:18.003003	2008-09-17 00:00:00
2010-08-18 02:02:19.003003	2010-08-17 00:00:00
2013-03-19 02:02:20.003003	2013-03-19 00:00:00
2014-11-20 02:02:21.003003	2014-11-18 00:00:00
2016-02-21 02:02:22.003003	2016-02-20 00:00:00
2018-08-22 02:02:23.003003	2018-08-20 00:00:00
2019-01-23 02:02:24.003003	2019-01-23 00:00:00
2020-02-24 02:02:25.003003	2020-02-23 00:00:00
2022-07-25 02:02:26.003003	2022-07-24 00:00:00
2024-02-25 02:02:26.003003	2024-02-23 00:00:00
2032-09-25 02:02:26.003003	2032-09-23 00:00:00
infinity	infinity

query II
select t, time_bucket('3 years'::interval, t) from timestamps;
----
-infinity	-infinity
3000-01-02 (BC) 03:16:23.003003	3002-01-01 (BC) 00:00:00
1024-04-10 (BC) 12:35:40.003003	1025-01-01 (BC) 00:00:00
0044-06-15 (BC) 12:35:40.003003	0044-01-01 (BC) 00:00:00
0678-06-30 02:02:03.003003	0677-01-01 00:00:00
0794-07-03 02:02:04.003003	0794-01-01 00:00:00
1700-01-01 00:00:00	1700-01-01 00:00:00
1962-12-31 00:00:00	1961-01-01 00:00:00
1970-01-01 00:00:00	1970-01-01 00:00:00
1985-12-07 02:02:08.003003	1985-01-01 00:00:00
1989-10-18 02:02:09.003003	1988-01-01 00:00:00
1990-01-21 02:02:10.003003	1988-01-01 00:00:00
1991-02-10 02:02:11.003003	1991-01-01 00:00:00
1992-09-11 02:02:12.003003	1991-01-01 00:00:00
1994-12-26 02:02:13.003003	1994-01-01 00:00:00
1997-05-13 02:02:14.003003	1997-01-01 00:00:00
1999-02-14 02:02:15.003003	1997-01-01 00:00:00
2000-01-01 00:00:00	2000-01-01 00:00:00
2000-01-03 00:00:00	2000-01-01 00:00:00
2008-09-17 02:02:18.003003	2006-01-01 00:00:00
2010-08-18 02:02:19.003003	2009-01-01 00:00:00
2013-03-19 02:02:20.003003	2012-01-01 00:00:00
2014-11-20 02:02:21.003003	2012-01-01 00:00:00
2016-02-21 02:02:22.003003	2015-01-01 00:00:00
2018-08-22 02:02:23.003003	2018-01-01 00:00:00
2019-01-23 02:02:24.003003	2018-01-01 00:00:00
2020-02-24 02:02:25.003003	2018-01-01 00:00:00
2022-07-25 02:02:26.003003	2021-01-01 00:00:00
2024-02-25 02:02:26.003003	2024-01-01 00:00:00
2032-09-25 02:02:26.003003	2030-01-01 00:00:00
infinity	infinity

query II
select t, time_bucket(null::interval, t) from timestamps;
----
-infinity	NULL
3000-01-02 (BC) 03:16:23.003003	NULL
1024-04-10 (BC) 12:35:40.003003	NULL
0044-06-15 (BC) 12:35:40.003003	NULL
0678-06-30 02:02:03.003003	NULL
0794-07-03 02:02:04.003003	NULL
1700-01-01 00:00:00	NULL
1962-12-31 00:00:00	NULL
1970-01-01 00:00:00	NULL
1985-12-07 02:02:08.003003	NULL
1989-10-18 02:02:09.003003	NULL
1990-01-21 02:02:10.003003	NULL
1991-02-10 02:02:11.003003	NULL
1992-09-11 02:02:12.003003	NULL
1994-12-26 02:02:13.003003	NULL
1997-05-13 02:02:14.003003	NULL
1999-02-14 02:02:15.003003	NULL
2000-01-01 00:00:00	NULL
2000-01-03 00:00:00	NULL
2008-09-17 02:02:18.003003	NULL
2010-08-18 02:02:19.003003	NULL
2013-03-19 02:02:20.003003	NULL
2014-11-20 02:02:21.003003	NULL
2016-02-21 02:02:22.003003	NULL
2018-08-22 02:02:23.003003	NULL
2019-01-23 02:02:24.003003	NULL
2020-02-24 02:02:25.003003	NULL
2022-07-25 02:02:26.003003	NULL
2024-02-25 02:02:26.003003	NULL
2032-09-25 02:02:26.003003	NULL
infinity	NULL

query I
select time_bucket('3 years'::interval, null::timestamp) from timestamps;
----
NULL
NULL
NULL
NULL
NULL
NULL
NULL
NULL
NULL
NULL
NULL
NULL
NULL
NULL
NULL
NULL
NULL
NULL
NULL
NULL
NULL
NULL
NULL
NULL
NULL
NULL
NULL
NULL
NULL
NULL
NULL

query III
select w, t, time_bucket(w, t) from timestamps;
----
10 days	-infinity	-infinity
10 days	3000-01-02 (BC) 03:16:23.003003	3001-12-31 (BC) 00:00:00
2 months	1024-04-10 (BC) 12:35:40.003003	1024-03-01 (BC) 00:00:00
10 days	0044-06-15 (BC) 12:35:40.003003	0044-06-12 (BC) 00:00:00
00:00:00.000333	0678-06-30 02:02:03.003003	0678-06-30 02:02:03.002739
00:00:00.000333	0794-07-03 02:02:04.003003	0794-07-03 02:02:04.002819
00:00:00.000333	1700-01-01 00:00:00	1699-12-31 23:59:59.999937
00:00:00.333	1962-12-31 00:00:00	1962-12-30 23:59:59.838
00:00:00.333	1970-01-01 00:00:00	1969-12-31 23:59:59.739
00:00:00.333	1985-12-07 02:02:08.003003	1985-12-07 02:02:07.872
00:05:33	1989-10-18 02:02:09.003003	1989-10-18 01:58:21
00:05:33	1990-01-21 02:02:10.003003	1990-01-21 02:00:18
00:05:33	1991-02-10 02:02:11.003003	1991-02-10 02:00:54
05:33:00	1992-09-11 02:02:12.003003	1992-09-10 23:42:00
05:33:00	1994-12-26 02:02:13.003003	1994-12-25 22:57:00
05:33:00	1997-05-13 02:02:14.003003	1997-05-12 23:51:00
333:00:00	1999-02-14 02:02:15.003003	1999-02-04 00:00:00
333:00:00	2000-01-01 00:00:00	1999-12-20 03:00:00
333:00:00	2000-01-03 00:00:00	2000-01-03 00:00:00
10 days	2008-09-17 02:02:18.003003	2008-09-17 00:00:00
7 days	2010-08-18 02:02:19.003003	2010-08-16 00:00:00
10 days	2013-03-19 02:02:20.003003	2013-03-15 00:00:00
10 days	2014-11-20 02:02:21.003003	2014-11-15 00:00:00
2 months	2016-02-21 02:02:22.003003	2016-01-01 00:00:00
2 months	2018-08-22 02:02:23.003003	2018-07-01 00:00:00
2 months	2019-01-23 02:02:24.003003	2019-01-01 00:00:00
2 years	2020-02-24 02:02:25.003003	2020-01-01 00:00:00
2 years	2022-07-25 02:02:26.003003	2022-01-01 00:00:00
10 days	2024-02-25 02:02:26.003003	2024-02-16 00:00:00
10 days	2032-09-25 02:02:26.003003	2032-09-21 00:00:00
10 days	infinity	infinity

query II
select t, time_bucket('4 seconds'::interval, t, '2 seconds'::interval) from timestamps;
----
-infinity	-infinity
3000-01-02 (BC) 03:16:23.003003	3000-01-02 (BC) 03:16:22
1024-04-10 (BC) 12:35:40.003003	1024-04-10 (BC) 12:35:38
0044-06-15 (BC) 12:35:40.003003	0044-06-15 (BC) 12:35:38
0678-06-30 02:02:03.003003	0678-06-30 02:02:02
0794-07-03 02:02:04.003003	0794-07-03 02:02:02
1700-01-01 00:00:00	1699-12-31 23:59:58
1962-12-31 00:00:00	1962-12-30 23:59:58
1970-01-01 00:00:00	1969-12-31 23:59:58
1985-12-07 02:02:08.003003	1985-12-07 02:02:06
1989-10-18 02:02:09.003003	1989-10-18 02:02:06
1990-01-21 02:02:10.003003	1990-01-21 02:02:10
1991-02-10 02:02:11.003003	1991-02-10 02:02:10
1992-09-11 02:02:12.003003	1992-09-11 02:02:10
1994-12-26 02:02:13.003003	1994-12-26 02:02:10
1997-05-13 02:02:14.003003	1997-05-13 02:02:14
1999-02-14 02:02:15.003003	1999-02-14 02:02:14
2000-01-01 00:00:00	1999-12-31 23:59:58
2000-01-03 00:00:00	2000-01-02 23:59:58
2008-09-17 02:02:18.003003	2008-09-17 02:02:18
2010-08-18 02:02:19.003003	2010-08-18 02:02:18
2013-03-19 02:02:20.003003	2013-03-19 02:02:18
2014-11-20 02:02:21.003003	2014-11-20 02:02:18
2016-02-21 02:02:22.003003	2016-02-21 02:02:22
2018-08-22 02:02:23.003003	2018-08-22 02:02:22
2019-01-23 02:02:24.003003	2019-01-23 02:02:22
2020-02-24 02:02:25.003003	2020-02-24 02:02:22
2022-07-25 02:02:26.003003	2022-07-25 02:02:26
2024-02-25 02:02:26.003003	2024-02-25 02:02:26
2032-09-25 02:02:26.003003	2032-09-25 02:02:26
infinity	infinity

query II
select t, time_bucket('4 days'::interval, t, '6 hours'::interval) from timestamps;
----
-infinity	-infinity
3000-01-02 (BC) 03:16:23.003003	3001-12-29 (BC) 06:00:00
1024-04-10 (BC) 12:35:40.003003	1024-04-08 (BC) 06:00:00
0044-06-15 (BC) 12:35:40.003003	0044-06-14 (BC) 06:00:00
0678-06-30 02:02:03.003003	0678-06-26 06:00:00
0794-07-03 02:02:04.003003	0794-06-30 06:00:00
1700-01-01 00:00:00	1699-12-30 06:00:00
1962-12-31 00:00:00	1962-12-28 06:00:00
1970-01-01 00:00:00	1969-12-31 06:00:00
1985-12-07 02:02:08.003003	1985-12-03 06:00:00
1989-10-18 02:02:09.003003	1989-10-15 06:00:00
1990-01-21 02:02:10.003003	1990-01-19 06:00:00
1991-02-10 02:02:11.003003	1991-02-07 06:00:00
1992-09-11 02:02:12.003003	1992-09-09 06:00:00
1994-12-26 02:02:13.003003	1994-12-24 06:00:00
1997-05-13 02:02:14.003003	1997-05-10 06:00:00
1999-02-14 02:02:15.003003	1999-02-13 06:00:00
2000-01-01 00:00:00	1999-12-30 06:00:00
2000-01-03 00:00:00	1999-12-30 06:00:00
2008-09-17 02:02:18.003003	2008-09-13 06:00:00
2010-08-18 02:02:19.003003	2010-08-14 06:00:00
2013-03-19 02:02:20.003003	2013-03-15 06:00:00
2014-11-20 02:02:21.003003	2014-11-17 06:00:00
2016-02-21 02:02:22.003003	2016-02-20 06:00:00
2018-08-22 02:02:23.003003	2018-08-20 06:00:00
2019-01-23 02:02:24.003003	2019-01-19 06:00:00
2020-02-24 02:02:25.003003	2020-02-23 06:00:00
2022-07-25 02:02:26.003003	2022-07-22 06:00:00
2024-02-25 02:02:26.003003	2024-02-22 06:00:00
2032-09-25 02:02:26.003003	2032-09-23 06:00:00
infinity	infinity

query II
select t, time_bucket('3 months'::interval, t, '6 days 11 hours'::interval) from timestamps;
----
-infinity	-infinity
3000-01-02 (BC) 03:16:23.003003	3001-10-07 (BC) 11:00:00
1024-04-10 (BC) 12:35:40.003003	1024-04-07 (BC) 11:00:00
0044-06-15 (BC) 12:35:40.003003	0044-04-07 (BC) 11:00:00
0678-06-30 02:02:03.003003	0678-04-07 11:00:00
0794-07-03 02:02:04.003003	0794-04-07 11:00:00
1700-01-01 00:00:00	1699-10-07 11:00:00
1962-12-31 00:00:00	1962-10-07 11:00:00
1970-01-01 00:00:00	1969-10-07 11:00:00
1985-12-07 02:02:08.003003	1985-10-07 11:00:00
1989-10-18 02:02:09.003003	1989-10-07 11:00:00
1990-01-21 02:02:10.003003	1990-01-07 11:00:00
1991-02-10 02:02:11.003003	1991-01-07 11:00:00
1992-09-11 02:02:12.003003	1992-07-07 11:00:00
1994-12-26 02:02:13.003003	1994-10-07 11:00:00
1997-05-13 02:02:14.003003	1997-04-07 11:00:00
1999-02-14 02:02:15.003003	1999-01-07 11:00:00
2000-01-01 00:00:00	1999-10-07 11:00:00
2000-01-03 00:00:00	1999-10-07 11:00:00
2008-09-17 02:02:18.003003	2008-07-07 11:00:00
2010-08-18 02:02:19.003003	2010-07-07 11:00:00
2013-03-19 02:02:20.003003	2013-01-07 11:00:00
2014-11-20 02:02:21.003003	2014-10-07 11:00:00
2016-02-21 02:02:22.003003	2016-01-07 11:00:00
2018-08-22 02:02:23.003003	2018-07-07 11:00:00
2019-01-23 02:02:24.003003	2019-01-07 11:00:00
2020-02-24 02:02:25.003003	2020-01-07 11:00:00
2022-07-25 02:02:26.003003	2022-07-07 11:00:00
2024-02-25 02:02:26.003003	2024-01-07 11:00:00
2032-09-25 02:02:26.003003	2032-07-07 11:00:00
infinity	infinity

query II
select t, time_bucket(null::interval, t, '2 seconds'::interval) from timestamps;
----
-infinity	NULL
3000-01-02 (BC) 03:16:23.003003	NULL
1024-04-10 (BC) 12:35:40.003003	NULL
0044-06-15 (BC) 12:35:40.003003	NULL
0678-06-30 02:02:03.003003	NULL
0794-07-03 02:02:04.003003	NULL
1700-01-01 00:00:00	NULL
1962-12-31 00:00:00	NULL
1970-01-01 00:00:00	NULL
1985-12-07 02:02:08.003003	NULL
1989-10-18 02:02:09.003003	NULL
1990-01-21 02:02:10.003003	NULL
1991-02-10 02:02:11.003003	NULL
1992-09-11 02:02:12.003003	NULL
1994-12-26 02:02:13.003003	NULL
1997-05-13 02:02:14.003003	NULL
1999-02-14 02:02:15.003003	NULL
2000-01-01 00:00:00	NULL
2000-01-03 00:00:00	NULL
2008-09-17 02:02:18.003003	NULL
2010-08-18 02:02:19.003003	NULL
2013-03-19 02:02:20.003003	NULL
2014-11-20 02:02:21.003003	NULL
2016-02-21 02:02:22.003003	NULL
2018-08-22 02:02:23.003003	NULL
2019-01-23 02:02:24.003003	NULL
2020-02-24 02:02:25.003003	NULL
2022-07-25 02:02:26.003003	NULL
2024-02-25 02:02:26.003003	NULL
2032-09-25 02:02:26.003003	NULL
infinity	NULL

query I
select time_bucket('3 months'::interval, null::timestamp, '2 seconds'::interval) from timestamps;
----
NULL
NULL
NULL
NULL
NULL
NULL
NULL
NULL
NULL
NULL
NULL
NULL
NULL
NULL
NULL
NULL
NULL
NULL
NULL
NULL
NULL
NULL
NULL
NULL
NULL
NULL
NULL
NULL
NULL
NULL
NULL

query II
select t, time_bucket('3 months'::interval, t, null::interval) from timestamps;
----
-infinity	NULL
3000-01-02 (BC) 03:16:23.003003	NULL
1024-04-10 (BC) 12:35:40.003003	NULL
0044-06-15 (BC) 12:35:40.003003	NULL
0678-06-30 02:02:03.003003	NULL
0794-07-03 02:02:04.003003	NULL
1700-01-01 00:00:00	NULL
1962-12-31 00:00:00	NULL
1970-01-01 00:00:00	NULL
1985-12-07 02:02:08.003003	NULL
1989-10-18 02:02:09.003003	NULL
1990-01-21 02:02:10.003003	NULL
1991-02-10 02:02:11.003003	NULL
1992-09-11 02:02:12.003003	NULL
1994-12-26 02:02:13.003003	NULL
1997-05-13 02:02:14.003003	NULL
1999-02-14 02:02:15.003003	NULL
2000-01-01 00:00:00	NULL
2000-01-03 00:00:00	NULL
2008-09-17 02:02:18.003003	NULL
2010-08-18 02:02:19.003003	NULL
2013-03-19 02:02:20.003003	NULL
2014-11-20 02:02:21.003003	NULL
2016-02-21 02:02:22.003003	NULL
2018-08-22 02:02:23.003003	NULL
2019-01-23 02:02:24.003003	NULL
2020-02-24 02:02:25.003003	NULL
2022-07-25 02:02:26.003003	NULL
2024-02-25 02:02:26.003003	NULL
2032-09-25 02:02:26.003003	NULL
infinity	NULL

query IIII
select w, t, shift, time_bucket(w, t, shift) from timestamps;
----
10 days	-infinity	00:00:00	-infinity
10 days	3000-01-02 (BC) 03:16:23.003003	3 days	3001-12-24 (BC) 00:00:00
2 months	1024-04-10 (BC) 12:35:40.003003	10 days	1024-03-11 (BC) 00:00:00
10 days	0044-06-15 (BC) 12:35:40.003003	6 days	0044-06-08 (BC) 00:00:00
00:00:00.000333	0678-06-30 02:02:03.003003	00:00:00	0678-06-30 02:02:03.002739
00:00:00.000333	0794-07-03 02:02:04.003003	00:00:00.000444	0794-07-03 02:02:04.00293
00:00:00.000333	1700-01-01 00:00:00	-00:00:00.000444	1699-12-31 23:59:59.999826
00:00:00.333	1962-12-31 00:00:00	00:00:00	1962-12-30 23:59:59.838
00:00:00.333	1970-01-01 00:00:00	00:00:00.444	1969-12-31 23:59:59.85
00:00:00.333	1985-12-07 02:02:08.003003	-00:00:00.444	1985-12-07 02:02:07.761
00:05:33	1989-10-18 02:02:09.003003	00:00:00	1989-10-18 01:58:21
00:05:33	1990-01-21 02:02:10.003003	00:07:24	1990-01-21 02:02:09
00:05:33	1991-02-10 02:02:11.003003	-00:07:24	1991-02-10 01:59:03
05:33:00	1992-09-11 02:02:12.003003	00:00:00	1992-09-10 23:42:00
05:33:00	1994-12-26 02:02:13.003003	07:24:00	1994-12-26 00:48:00
05:33:00	1997-05-13 02:02:14.003003	-07:24:00	1997-05-12 22:00:00
333:00:00	1999-02-14 02:02:15.003003	00:00:00	1999-02-04 00:00:00
333:00:00	2000-01-01 00:00:00	444:00:00	1999-12-24 18:00:00
333:00:00	2000-01-03 00:00:00	-444:00:00	1999-12-29 09:00:00
10 days	2008-09-17 02:02:18.003003	00:00:00	2008-09-17 00:00:00
7 days	2010-08-18 02:02:19.003003	00:00:00	2010-08-16 00:00:00
10 days	2013-03-19 02:02:20.003003	2 days 04:00:00	2013-03-17 04:00:00
10 days	2014-11-20 02:02:21.003003	-2 days 04:00:00	2014-11-13 04:00:00
2 months	2016-02-21 02:02:22.003003	00:00:00	2016-01-01 00:00:00
2 months	2018-08-22 02:02:23.003003	1 month 7 days	2018-08-08 00:00:00
2 months	2019-01-23 02:02:24.003003	-1 month 7 days	2018-12-08 00:00:00
2 years	2020-02-24 02:02:25.003003	6 months	2018-07-01 00:00:00
2 years	2022-07-25 02:02:26.003003	-6 months	2021-07-01 00:00:00
10 days	2024-02-25 02:02:26.003003	1 year	2024-02-21 00:00:00
10 days	2032-09-25 02:02:26.003003	-1 year	2032-09-16 00:00:00
10 days	infinity	00:00:00	infinity

query II
select t, time_bucket('11 seconds'::interval, t, '1990-12-10 08:08:10'::timestamp) from timestamps;
----
-infinity	-infinity
3000-01-02 (BC) 03:16:23.003003	3000-01-02 (BC) 03:16:19
1024-04-10 (BC) 12:35:40.003003	1024-04-10 (BC) 12:35:30
0044-06-15 (BC) 12:35:40.003003	0044-06-15 (BC) 12:35:37
0678-06-30 02:02:03.003003	0678-06-30 02:01:59
0794-07-03 02:02:04.003003	0794-07-03 02:01:54
1700-01-01 00:00:00	1699-12-31 23:59:53
1962-12-31 00:00:00	1962-12-30 23:59:56
1970-01-01 00:00:00	1969-12-31 23:59:53
1985-12-07 02:02:08.003003	1985-12-07 02:01:59
1989-10-18 02:02:09.003003	1989-10-18 02:02:03
1990-01-21 02:02:10.003003	1990-01-21 02:02:05
1991-02-10 02:02:11.003003	1991-02-10 02:02:05
1992-09-11 02:02:12.003003	1992-09-11 02:02:07
1994-12-26 02:02:13.003003	1994-12-26 02:02:07
1997-05-13 02:02:14.003003	1997-05-13 02:02:07
1999-02-14 02:02:15.003003	1999-02-14 02:02:05
2000-01-01 00:00:00	1999-12-31 23:59:58
2000-01-03 00:00:00	2000-01-02 23:59:57
2008-09-17 02:02:18.003003	2008-09-17 02:02:08
2010-08-18 02:02:19.003003	2010-08-18 02:02:10
2013-03-19 02:02:20.003003	2013-03-19 02:02:11
2014-11-20 02:02:21.003003	2014-11-20 02:02:19
2016-02-21 02:02:22.003003	2016-02-21 02:02:21
2018-08-22 02:02:23.003003	2018-08-22 02:02:21
2019-01-23 02:02:24.003003	2019-01-23 02:02:21
2020-02-24 02:02:25.003003	2020-02-24 02:02:15
2022-07-25 02:02:26.003003	2022-07-25 02:02:25
2024-02-25 02:02:26.003003	2024-02-25 02:02:21
2032-09-25 02:02:26.003003	2032-09-25 02:02:21
infinity	infinity

query II
select t, time_bucket('11 days'::interval, t, '1990-01-06 08:08:10'::timestamp) from timestamps;
----
-infinity	-infinity
3000-01-02 (BC) 03:16:23.003003	3001-12-27 (BC) 08:08:10
1024-04-10 (BC) 12:35:40.003003	1024-04-06 (BC) 08:08:10
0044-06-15 (BC) 12:35:40.003003	0044-06-14 (BC) 08:08:10
0678-06-30 02:02:03.003003	0678-06-25 08:08:10
0794-07-03 02:02:04.003003	0794-06-29 08:08:10
1700-01-01 00:00:00	1699-12-27 08:08:10
1962-12-31 00:00:00	1962-12-21 08:08:10
1970-01-01 00:00:00	1969-12-27 08:08:10
1985-12-07 02:02:08.003003	1985-12-02 08:08:10
1989-10-18 02:02:09.003003	1989-10-10 08:08:10
1990-01-21 02:02:10.003003	1990-01-17 08:08:10
1991-02-10 02:02:11.003003	1991-02-06 08:08:10
1992-09-11 02:02:12.003003	1992-08-31 08:08:10
1994-12-26 02:02:13.003003	1994-12-15 08:08:10
1997-05-13 02:02:14.003003	1997-05-02 08:08:10
1999-02-14 02:02:15.003003	1999-02-10 08:08:10
2000-01-01 00:00:00	1999-12-26 08:08:10
2000-01-03 00:00:00	1999-12-26 08:08:10
2008-09-17 02:02:18.003003	2008-09-08 08:08:10
2010-08-18 02:02:19.003003	2010-08-13 08:08:10
2013-03-19 02:02:20.003003	2013-03-16 08:08:10
2014-11-20 02:02:21.003003	2014-11-11 08:08:10
2016-02-21 02:02:22.003003	2016-02-16 08:08:10
2018-08-22 02:02:23.003003	2018-08-17 08:08:10
2019-01-23 02:02:24.003003	2019-01-18 08:08:10
2020-02-24 02:02:25.003003	2020-02-18 08:08:10
2022-07-25 02:02:26.003003	2022-07-17 08:08:10
2024-02-25 02:02:26.003003	2024-02-20 08:08:10
2032-09-25 02:02:26.003003	2032-09-20 08:08:10
infinity	infinity

query II
select t, time_bucket('7 months'::interval, t, '1990-01-06 08:08:10'::timestamp) from timestamps;
----
-infinity	-infinity
3000-01-02 (BC) 03:16:23.003003	3001-10-01 (BC) 00:00:00
1024-04-10 (BC) 12:35:40.003003	1024-02-01 (BC) 00:00:00
0044-06-15 (BC) 12:35:40.003003	0044-02-01 (BC) 00:00:00
0678-06-30 02:02:03.003003	0678-02-01 00:00:00
0794-07-03 02:02:04.003003	0794-03-01 00:00:00
1700-01-01 00:00:00	1699-07-01 00:00:00
1962-12-31 00:00:00	1962-08-01 00:00:00
1970-01-01 00:00:00	1969-08-01 00:00:00
1985-12-07 02:02:08.003003	1985-12-01 00:00:00
1989-10-18 02:02:09.003003	1989-06-01 00:00:00
1990-01-21 02:02:10.003003	1990-01-01 00:00:00
1991-02-10 02:02:11.003003	1990-08-01 00:00:00
1992-09-11 02:02:12.003003	1992-05-01 00:00:00
1994-12-26 02:02:13.003003	1994-09-01 00:00:00
1997-05-13 02:02:14.003003	1997-01-01 00:00:00
1999-02-14 02:02:15.003003	1998-10-01 00:00:00
2000-01-01 00:00:00	1999-12-01 00:00:00
2000-01-03 00:00:00	1999-12-01 00:00:00
2008-09-17 02:02:18.003003	2008-09-01 00:00:00
2010-08-18 02:02:19.003003	2010-06-01 00:00:00
2013-03-19 02:02:20.003003	2012-10-01 00:00:00
2014-11-20 02:02:21.003003	2014-07-01 00:00:00
2016-02-21 02:02:22.003003	2015-09-01 00:00:00
2018-08-22 02:02:23.003003	2018-08-01 00:00:00
2019-01-23 02:02:24.003003	2018-08-01 00:00:00
2020-02-24 02:02:25.003003	2019-10-01 00:00:00
2022-07-25 02:02:26.003003	2022-02-01 00:00:00
2024-02-25 02:02:26.003003	2023-11-01 00:00:00
2032-09-25 02:02:26.003003	2032-08-01 00:00:00
infinity	infinity

query II
select t, time_bucket(null::interval, t, '1990-01-06 08:08:10'::timestamp) from timestamps;
----
-infinity	NULL
3000-01-02 (BC) 03:16:23.003003	NULL
1024-04-10 (BC) 12:35:40.003003	NULL
0044-06-15 (BC) 12:35:40.003003	NULL
0678-06-30 02:02:03.003003	NULL
0794-07-03 02:02:04.003003	NULL
1700-01-01 00:00:00	NULL
1962-12-31 00:00:00	NULL
1970-01-01 00:00:00	NULL
1985-12-07 02:02:08.003003	NULL
1989-10-18 02:02:09.003003	NULL
1990-01-21 02:02:10.003003	NULL
1991-02-10 02:02:11.003003	NULL
1992-09-11 02:02:12.003003	NULL
1994-12-26 02:02:13.003003	NULL
1997-05-13 02:02:14.003003	NULL
1999-02-14 02:02:15.003003	NULL
2000-01-01 00:00:00	NULL
2000-01-03 00:00:00	NULL
2008-09-17 02:02:18.003003	NULL
2010-08-18 02:02:19.003003	NULL
2013-03-19 02:02:20.003003	NULL
2014-11-20 02:02:21.003003	NULL
2016-02-21 02:02:22.003003	NULL
2018-08-22 02:02:23.003003	NULL
2019-01-23 02:02:24.003003	NULL
2020-02-24 02:02:25.003003	NULL
2022-07-25 02:02:26.003003	NULL
2024-02-25 02:02:26.003003	NULL
2032-09-25 02:02:26.003003	NULL
infinity	NULL

query I
select time_bucket('7 months'::interval, null::timestamp, '1990-01-06 08:08:10'::timestamp) from timestamps;
----
NULL
NULL
NULL
NULL
NULL
NULL
NULL
NULL
NULL
NULL
NULL
NULL
NULL
NULL
NULL
NULL
NULL
NULL
NULL
NULL
NULL
NULL
NULL
NULL
NULL
NULL
NULL
NULL
NULL
NULL
NULL

query II
select t, time_bucket('7 months'::interval, t, null::timestamp) from timestamps;
----
-infinity	NULL
3000-01-02 (BC) 03:16:23.003003	NULL
1024-04-10 (BC) 12:35:40.003003	NULL
0044-06-15 (BC) 12:35:40.003003	NULL
0678-06-30 02:02:03.003003	NULL
0794-07-03 02:02:04.003003	NULL
1700-01-01 00:00:00	NULL
1962-12-31 00:00:00	NULL
1970-01-01 00:00:00	NULL
1985-12-07 02:02:08.003003	NULL
1989-10-18 02:02:09.003003	NULL
1990-01-21 02:02:10.003003	NULL
1991-02-10 02:02:11.003003	NULL
1992-09-11 02:02:12.003003	NULL
1994-12-26 02:02:13.003003	NULL
1997-05-13 02:02:14.003003	NULL
1999-02-14 02:02:15.003003	NULL
2000-01-01 00:00:00	NULL
2000-01-03 00:00:00	NULL
2008-09-17 02:02:18.003003	NULL
2010-08-18 02:02:19.003003	NULL
2013-03-19 02:02:20.003003	NULL
2014-11-20 02:02:21.003003	NULL
2016-02-21 02:02:22.003003	NULL
2018-08-22 02:02:23.003003	NULL
2019-01-23 02:02:24.003003	NULL
2020-02-24 02:02:25.003003	NULL
2022-07-25 02:02:26.003003	NULL
2024-02-25 02:02:26.003003	NULL
2032-09-25 02:02:26.003003	NULL
infinity	NULL

query IIII
select w, t, origin, time_bucket(w, t, origin) from timestamps;
----
10 days	-infinity	1970-01-05 00:00:00	-infinity
10 days	3000-01-02 (BC) 03:16:23.003003	3000-01-01 (BC) 00:00:00	3000-01-01 (BC) 00:00:00
2 months	1024-04-10 (BC) 12:35:40.003003	1024-03-01 (BC) 00:00:00	1024-03-01 (BC) 00:00:00
10 days	0044-06-15 (BC) 12:35:40.003003	0044-02-01 (BC) 00:00:00	0044-06-11 (BC) 00:00:00
00:00:00.000333	0678-06-30 02:02:03.003003	1970-02-10 00:00:00	0678-06-30 02:02:03.002793
00:00:00.000333	0794-07-03 02:02:04.003003	1970-10-17 00:05:05.006006	0794-07-03 02:02:04.002992
00:00:00.000333	1700-01-01 00:00:00	1970-09-27 00:05:05.006006	1699-12-31 23:59:59.999714
00:00:00.333	1962-12-31 00:00:00	1970-08-12 00:00:00	1962-12-30 23:59:59.919
00:00:00.333	1970-01-01 00:00:00	1970-06-23 00:05:05.006006	1969-12-31 23:59:59.807006
00:00:00.333	1985-12-07 02:02:08.003003	1970-01-05 00:05:05.006006	1985-12-07 02:02:07.724006
00:05:33	1989-10-18 02:02:09.003003	1970-09-07 00:00:00	1989-10-18 01:59:24
00:05:33	1990-01-21 02:02:10.003003	1970-07-06 00:05:05.006006	1990-01-21 02:01:11.006006
00:05:33	1991-02-10 02:02:11.003003	1970-10-09 00:05:05.006006	1991-02-10 01:59:50.006006
05:33:00	1992-09-11 02:02:12.003003	1970-04-10 00:00:00	1992-09-10 22:48:00
05:33:00	1994-12-26 02:02:13.003003	1970-03-05 00:05:05.006006	1994-12-25 23:56:05.006006
05:33:00	1997-05-13 02:02:14.003003	2000-01-03 00:00:00	1997-05-12 23:51:00
333:00:00	1999-02-14 02:02:15.003003	2000-01-01 00:00:00	1999-02-02 00:00:00
333:00:00	2000-01-01 00:00:00	1980-11-25 00:05:05.006006	1999-12-21 06:05:05.006006
333:00:00	2000-01-03 00:00:00	2045-01-05 00:05:05.006006	1999-12-31 03:05:05.006006
10 days	2008-09-17 02:02:18.003003	2009-11-05 00:00:00	2008-09-11 00:00:00
7 days	2010-08-18 02:02:19.003003	2100-09-05 00:00:00	2010-08-15 00:00:00
10 days	2013-03-19 02:02:20.003003	2300-10-07 00:05:05.006006	2013-03-15 00:05:05.006006
10 days	2014-11-20 02:02:21.003003	1970-12-07 00:05:05.006006	2014-11-16 00:05:05.006006
2 months	2016-02-21 02:02:22.003003	1970-09-05 00:00:00	2016-01-01 00:00:00
2 months	2018-08-22 02:02:23.003003	1970-07-01 00:05:05.006006	2018-07-01 00:00:00
2 months	2019-01-23 02:02:24.003003	1969-09-01 00:05:05.006006	2019-01-01 00:00:00
2 years	2020-02-24 02:02:25.003003	1970-02-13 00:05:05.006006	2020-02-01 00:00:00
2 years	2022-07-25 02:02:26.003003	1969-10-09 00:05:05.006006	2021-10-01 00:00:00
10 days	2024-02-25 02:02:26.003003	-infinity	NULL
10 days	2032-09-25 02:02:26.003003	infinity	NULL
10 days	infinity	1970-01-01 00:00:00	infinity

statement error
select time_bucket('-3 hours'::interval, '2019-04-05 00:00:00'::timestamp);
----

statement error
select time_bucket('-3 hours'::interval, '2019-04-05 00:00:00'::timestamp, '1 hour 30 minutes':: interval);
----

statement error
select time_bucket('-3 hours'::interval, '2019-04-05 00:00:00'::timestamp, '2019-04-05 00:00:00'::timestamp);
----

statement error
select time_bucket('-1 month'::interval, '2019-04-05 00:00:00'::timestamp);
----

statement error
select time_bucket('-1 month'::interval, '2019-04-05 00:00:00'::timestamp, '1 hour 30 minutes':: interval);
----

statement error
select time_bucket('-1 month'::interval, '2019-04-05 00:00:00'::timestamp, '2018-04-05 00:00:00'::timestamp);
----

statement error
select time_bucket('1 day - 172800 seconds'::interval, '2018-05-05 00:00:00'::timestamp);
----

statement error
select time_bucket('1 day - 172800 seconds'::interval, '2018-05-05 00:00:00'::timestamp, '1 hour 30 minutes':: interval);
----

statement error
select time_bucket('1 day - 172800 seconds'::interval, '2018-05-05 00:00:00'::timestamp, '2018-05-05 00:00:00'::timestamp);
----

statement error
select time_bucket('1 month 1 day'::interval, '2018-05-05 00:00:00'::timestamp);
----

statement error
select time_bucket('1 month 1 day'::interval, '2018-05-05 00:00:00'::timestamp, '1 hour 30 minutes':: interval);
----

statement error
select time_bucket('1 month 1 day'::interval, '2018-05-05 00:00:00'::timestamp, '2018-05-05 00:00:00'::timestamp);
----

statement error
select time_bucket('3 days'::interval, '2019-05-05 00:00:00'::timestamp, '2000000000 months'::interval);
----

statement error
select time_bucket('3 days'::interval, '2019-05-05 00:00:00'::timestamp, '-2000000000 months'::interval);
----

statement error
select time_bucket('3 months'::interval, '2019-05-05 00:00:00'::timestamp, '2000000000 months'::interval);
----

statement error
select time_bucket('3 months'::interval, '2019-05-05 00:00:00'::timestamp, '-2000000000 months'::interval);
----

statement error
select time_bucket('1 microseconds'::interval, '290309-12-21 (BC) 23:59:59.999999'::timestamp);
----

query I
select time_bucket('1 microseconds'::interval, '290309-12-22 (BC) 00:00:00'::timestamp);
----
290309-12-22 (BC) 00:00:00

statement error
select time_bucket('1 microseconds'::interval, '294247-01-10 04:00:54.775807'::timestamp);
----

query I
select time_bucket('1 microseconds'::interval, '294247-01-10 04:00:54.775806'::timestamp);
----
294247-01-10 04:00:54.775806

query I
select time_bucket('1 month 1 day'::interval, null::timestamp);
----
NULL

query I
select time_bucket('1 month 1 day'::interval, null::timestamp, '6 days'::interval);
----
NULL

query I
select time_bucket('1 month 1 day'::interval, null::timestamp, '2022-12-20 10:00:00'::timestamp);
----
NULL

query I
select time_bucket('-1 month'::interval, null::timestamp);
----
NULL

query I
select time_bucket('-1 month'::interval, null::timestamp, '6 days'::interval);
----
NULL

query I
select time_bucket('-1 month'::interval, '2022-12-22 10:00:00'::timestamp, null::interval);
----
NULL

query I
select time_bucket('-1 month'::interval, null::timestamp, '2022-12-20 10:00:00'::timestamp);
----
NULL

query I
select time_bucket('-1 month'::interval, '2022-12-22'::timestamp, null::timestamp);
----
NULL
