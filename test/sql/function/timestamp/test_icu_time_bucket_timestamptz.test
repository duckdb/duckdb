# name: test/sql/function/timestamp/test_icu_time_bucket_timestamptz.test
# description: Test time bucket functionality
# group: [timestamp]

require icu

statement ok
SET Calendar = 'gregorian';

statement ok
SET TimeZone = 'America/Los_Angeles';

statement ok
CREATE TABLE timestamps_tz(w INTERVAL, t TIMESTAMPTZ, shift INTERVAL, origin TIMESTAMPTZ, timezone VARCHAR);

statement ok
INSERT INTO timestamps_tz VALUES ('10 days', '-infinity', '0 days', '1970-01-05 00:00:00+00', 'UTC'),
	('333 microseconds', '1907-11-20 04:00:00+08', '0 microseconds', '1970-03-06 00:00:00+00', 'UTC'),
	('333 microseconds', '1970-01-01 00:00:00+00', '444 microseconds', '1970-01-05 00:05:05.006006+03', 'America/Los_Angeles'),
	('333 microseconds', '1979-04-10 02:02:05.003003-03', '-444 microseconds', '1962-12-10 00:05:05.006006-03', 'America/Los_Angeles'),
	('333 milliseconds', '1981-09-30 02:02:06.003003+00', '0 milliseconds', '1970-02-05 00:00:00+00', 'UTC'),
	('333 milliseconds', '1982-06-15 02:02:07.003003+04', '444 milliseconds', '1970-11-15 00:05:05.006006+04', 'Asia/Aden'),
	('333 milliseconds', '1985-02-20 02:02:08.003003-04', '-444 milliseconds', '1980-08-05 00:05:05.006006-04', 'Asia/Aden'),
	('333 seconds', '1989-06-08 02:02:09.003003+00', '0 seconds', '1970-11-25 00:00:00+00', 'UTC'),
	('333 seconds', '1990-07-11 02:02:10.003003+02', '444 seconds', '1970-04-10 00:05:05.006006+02', 'Pacific/Guam'),
	('333 seconds', '1991-05-12 02:02:11.003003-02', '-444 seconds', '1971-01-05 00:05:05.006006-02', 'Pacific/Guam'),
	('333 minutes', '1992-10-17 02:02:12.003003+00', '0 minutes', '1950-04-24 00:00:00+00', 'UTC'),
	('333 minutes', '1994-12-05 02:02:13.003003+05', '444 minute', '1970-06-09 00:05:05.006006+05', 'Europe/Berlin'),
	('333 minutes', '1997-01-02 02:02:14.003003-05', '-444 minute', '1970-07-06 00:05:05.006006-05', 'Europe/Berlin'),
	('333 hours', '1999-04-26 02:02:15.003003+00', '0 hours', '1970-02-05 00:00:00+00', 'UTC'),
	('333 hours', '2000-01-01 00:00:00+00', '444 hours', '1970-01-05 00:05:05.006006+01', 'Europe/London'),
	('333 hours', '2000-01-03 00:00:00+00', '-444 hours', '1970-03-15 00:05:05.006006-01', 'Europe/London'),
	('333 hours', '2000-03-26 02:00:00+01', '0 hours', '1980-10-05 00:00:00+00', 'Europe/London'),
	('333 hours', '2000-04-02 03:00:00-07', '0 hours', '1990-05-20 00:00:00+00', 'Europe/London'),
	('333 hours', '2000-10-29 01:00:00+00', '0 hours', '2010-07-27 00:00:00+00', 'Europe/London'),
	('333 hours', '2000-10-29 01:00:00-08', '0 hours', '2010-07-27 00:00:00+00', 'Europe/London'),
	('10 days', '2008-12-31 23:59:59.999999+00', '0 days', '1970-02-27 00:00:00+00', 'UTC'),
	('1 week', '2010-05-03 02:02:19.003003+00', '0 days', '1970-07-25 00:00:00+00', 'UTC'),
	('10 days', '2013-08-19 02:02:20.003003+02', '2 days 4 hours', '2003-03-24 00:05:05.006006+02', 'Asia/Kolkata'),
	('10 days', '2014-07-15 02:02:21.003003-02', '-2 days 4 hours', '1970-04-12 00:05:05.006006-02', 'Asia/Kolkata'),
	('2 months', '2016-03-21 02:02:22.003003+00', '0 months', '1970-11-05 00:00:00+00', 'UTC'),
	('2 months', '2018-02-01 02:02:23.003003+09', '1 month 1 week', '1970-05-07 00:05:05.006006+09', 'Australia/Sydney'),
	('2 months', '2019-09-30 02:02:24.003003-09', '-1 month 1 week', '1969-10-09 00:05:05.006006-09', 'Australia/Sydney'),
	('2 year', '2020-03-20 02:02:25.003003+11', '6 months', '2032-06-29 00:05:05.006006+11', 'Asia/Yekaterinburg'),
	('2 year', '2022-07-20 02:02:26.003003-11', '-6 months', '1969-11-14 00:05:05.006006-11', 'Asia/Yekaterinburg'),
	('10 days', '2024-08-12 02:02:26.003003+07', '1 year', '-infinity', 'Asia/Tokyo'),
	('10 days', '2032-12-18 02:02:26.003003-07', '-1 year', 'infinity', 'Asia/Tokyo'),
	('10 days', 'infinity', '0 days', '1970-01-01 00:00:00+00', 'UTC'),
;

query II
select t, time_bucket('56 seconds'::interval, t) from timestamps_tz;
----
-infinity	-infinity
1907-11-19 12:00:00-08	1907-11-19 11:59:28-08
1969-12-31 16:00:00-08	1969-12-31 15:59:28-08
1979-04-09 21:02:05.003003-08	1979-04-09 21:01:36-08
1981-09-29 19:02:06.003003-07	1981-09-29 19:01:36-07
1982-06-14 15:02:07.003003-07	1982-06-14 15:01:36-07
1985-02-19 22:02:08.003003-08	1985-02-19 22:01:28-08
1989-06-07 19:02:09.003003-07	1989-06-07 19:01:44-07
1990-07-10 17:02:10.003003-07	1990-07-10 17:02:08-07
1991-05-11 21:02:11.003003-07	1991-05-11 21:01:36-07
1992-10-16 19:02:12.003003-07	1992-10-16 19:02:00-07
1994-12-04 13:02:13.003003-08	1994-12-04 13:01:44-08
1997-01-01 23:02:14.003003-08	1997-01-01 23:01:20-08
1999-04-25 19:02:15.003003-07	1999-04-25 19:01:20-07
1999-12-31 16:00:00-08	1999-12-31 15:59:44-08
2000-01-02 16:00:00-08	2000-01-02 16:00:00-08
2000-03-25 17:00:00-08	2000-03-25 16:59:36-08
2000-04-02 03:00:00-07	2000-04-02 03:00:00-07
2000-10-28 18:00:00-07	2000-10-28 17:59:36-07
2000-10-29 01:00:00-08	2000-10-29 01:59:20-07
2008-12-31 15:59:59.999999-08	2008-12-31 15:59:28-08
2010-05-02 19:02:19.003003-07	2010-05-02 19:02:16-07
2013-08-18 17:02:20.003003-07	2013-08-18 17:01:52-07
2014-07-14 21:02:21.003003-07	2014-07-14 21:01:52-07
2016-03-20 19:02:22.003003-07	2016-03-20 19:02:16-07
2018-01-31 09:02:23.003003-08	2018-01-31 09:02:16-08
2019-09-30 04:02:24.003003-07	2019-09-30 04:01:44-07
2020-03-19 08:02:25.003003-07	2020-03-19 08:02:00-07
2022-07-20 06:02:26.003003-07	2022-07-20 06:02:24-07
2024-08-11 12:02:26.003003-07	2024-08-11 12:02:16-07
2032-12-18 01:02:26.003003-08	2032-12-18 01:02:00-08
infinity	infinity

query II
select t, time_bucket('3 days'::interval, t) from timestamps_tz;
----
-infinity	-infinity
1907-11-19 12:00:00-08	1907-11-18 16:00:00-08
1969-12-31 16:00:00-08	1969-12-31 16:00:00-08
1979-04-09 21:02:05.003003-08	1979-04-07 16:00:00-08
1981-09-29 19:02:06.003003-07	1981-09-29 17:00:00-07
1982-06-14 15:02:07.003003-07	1982-06-11 17:00:00-07
1985-02-19 22:02:08.003003-08	1985-02-19 16:00:00-08
1989-06-07 19:02:09.003003-07	1989-06-07 17:00:00-07
1990-07-10 17:02:10.003003-07	1990-07-08 17:00:00-07
1991-05-11 21:02:11.003003-07	1991-05-10 17:00:00-07
1992-10-16 19:02:12.003003-07	1992-10-16 17:00:00-07
1994-12-04 13:02:13.003003-08	1994-12-02 16:00:00-08
1997-01-01 23:02:14.003003-08	1996-12-30 16:00:00-08
1999-04-25 19:02:15.003003-07	1999-04-25 17:00:00-07
1999-12-31 16:00:00-08	1999-12-30 16:00:00-08
2000-01-02 16:00:00-08	2000-01-02 16:00:00-08
2000-03-25 17:00:00-08	2000-03-23 16:00:00-08
2000-04-02 03:00:00-07	2000-04-01 16:00:00-08
2000-10-28 18:00:00-07	2000-10-28 17:00:00-07
2000-10-29 01:00:00-08	2000-10-28 17:00:00-07
2008-12-31 15:59:59.999999-08	2008-12-30 16:00:00-08
2010-05-02 19:02:19.003003-07	2010-04-30 17:00:00-07
2013-08-18 17:02:20.003003-07	2013-08-18 17:00:00-07
2014-07-14 21:02:21.003003-07	2014-07-14 17:00:00-07
2016-03-20 19:02:22.003003-07	2016-03-20 17:00:00-07
2018-01-31 09:02:23.003003-08	2018-01-30 16:00:00-08
2019-09-30 04:02:24.003003-07	2019-09-28 17:00:00-07
2020-03-19 08:02:25.003003-07	2020-03-17 17:00:00-07
2022-07-20 06:02:26.003003-07	2022-07-17 17:00:00-07
2024-08-11 12:02:26.003003-07	2024-08-08 17:00:00-07
2032-12-18 01:02:26.003003-08	2032-12-15 16:00:00-08
infinity	infinity

query II
select t, time_bucket('3 years'::interval, t) from timestamps_tz;
----
-infinity	-infinity
1907-11-19 12:00:00-08	1906-12-31 16:00:00-08
1969-12-31 16:00:00-08	1969-12-31 16:00:00-08
1979-04-09 21:02:05.003003-08	1978-12-31 16:00:00-08
1981-09-29 19:02:06.003003-07	1978-12-31 16:00:00-08
1982-06-14 15:02:07.003003-07	1981-12-31 16:00:00-08
1985-02-19 22:02:08.003003-08	1984-12-31 16:00:00-08
1989-06-07 19:02:09.003003-07	1987-12-31 16:00:00-08
1990-07-10 17:02:10.003003-07	1987-12-31 16:00:00-08
1991-05-11 21:02:11.003003-07	1990-12-31 16:00:00-08
1992-10-16 19:02:12.003003-07	1990-12-31 16:00:00-08
1994-12-04 13:02:13.003003-08	1993-12-31 16:00:00-08
1997-01-01 23:02:14.003003-08	1996-12-31 16:00:00-08
1999-04-25 19:02:15.003003-07	1996-12-31 16:00:00-08
1999-12-31 16:00:00-08	1999-12-31 16:00:00-08
2000-01-02 16:00:00-08	1999-12-31 16:00:00-08
2000-03-25 17:00:00-08	1999-12-31 16:00:00-08
2000-04-02 03:00:00-07	1999-12-31 16:00:00-08
2000-10-28 18:00:00-07	1999-12-31 16:00:00-08
2000-10-29 01:00:00-08	1999-12-31 16:00:00-08
2008-12-31 15:59:59.999999-08	2005-12-31 16:00:00-08
2010-05-02 19:02:19.003003-07	2008-12-31 16:00:00-08
2013-08-18 17:02:20.003003-07	2011-12-31 16:00:00-08
2014-07-14 21:02:21.003003-07	2011-12-31 16:00:00-08
2016-03-20 19:02:22.003003-07	2014-12-31 16:00:00-08
2018-01-31 09:02:23.003003-08	2017-12-31 16:00:00-08
2019-09-30 04:02:24.003003-07	2017-12-31 16:00:00-08
2020-03-19 08:02:25.003003-07	2017-12-31 16:00:00-08
2022-07-20 06:02:26.003003-07	2020-12-31 16:00:00-08
2024-08-11 12:02:26.003003-07	2023-12-31 16:00:00-08
2032-12-18 01:02:26.003003-08	2029-12-31 16:00:00-08
infinity	infinity

query II
select t, time_bucket(null::interval, t) from timestamps_tz;
----
-infinity	NULL
1907-11-19 12:00:00-08	NULL
1969-12-31 16:00:00-08	NULL
1979-04-09 21:02:05.003003-08	NULL
1981-09-29 19:02:06.003003-07	NULL
1982-06-14 15:02:07.003003-07	NULL
1985-02-19 22:02:08.003003-08	NULL
1989-06-07 19:02:09.003003-07	NULL
1990-07-10 17:02:10.003003-07	NULL
1991-05-11 21:02:11.003003-07	NULL
1992-10-16 19:02:12.003003-07	NULL
1994-12-04 13:02:13.003003-08	NULL
1997-01-01 23:02:14.003003-08	NULL
1999-04-25 19:02:15.003003-07	NULL
1999-12-31 16:00:00-08	NULL
2000-01-02 16:00:00-08	NULL
2000-03-25 17:00:00-08	NULL
2000-04-02 03:00:00-07	NULL
2000-10-28 18:00:00-07	NULL
2000-10-29 01:00:00-08	NULL
2008-12-31 15:59:59.999999-08	NULL
2010-05-02 19:02:19.003003-07	NULL
2013-08-18 17:02:20.003003-07	NULL
2014-07-14 21:02:21.003003-07	NULL
2016-03-20 19:02:22.003003-07	NULL
2018-01-31 09:02:23.003003-08	NULL
2019-09-30 04:02:24.003003-07	NULL
2020-03-19 08:02:25.003003-07	NULL
2022-07-20 06:02:26.003003-07	NULL
2024-08-11 12:02:26.003003-07	NULL
2032-12-18 01:02:26.003003-08	NULL
infinity	NULL

query I
select time_bucket('3 years'::interval, null::timestamptz) from timestamps_tz;
----
NULL
NULL
NULL
NULL
NULL
NULL
NULL
NULL
NULL
NULL
NULL
NULL
NULL
NULL
NULL
NULL
NULL
NULL
NULL
NULL
NULL
NULL
NULL
NULL
NULL
NULL
NULL
NULL
NULL
NULL
NULL
NULL

query III
select w, t, time_bucket(w, t) from timestamps_tz;
----
10 days	-infinity	-infinity
00:00:00.000333	1907-11-19 12:00:00-08	1907-11-19 11:59:59.999892-08
00:00:00.000333	1969-12-31 16:00:00-08	1969-12-31 15:59:59.999739-08
00:00:00.000333	1979-04-09 21:02:05.003003-08	1979-04-09 21:02:05.002683-08
00:00:00.333	1981-09-29 19:02:06.003003-07	1981-09-29 19:02:05.712-07
00:00:00.333	1982-06-14 15:02:07.003003-07	1982-06-14 15:02:06.945-07
00:00:00.333	1985-02-19 22:02:08.003003-08	1985-02-19 22:02:07.872-08
00:05:33	1989-06-07 19:02:09.003003-07	1989-06-07 19:01:57-07
00:05:33	1990-07-10 17:02:10.003003-07	1990-07-10 17:00:36-07
00:05:33	1991-05-11 21:02:11.003003-07	1991-05-11 20:58:30-07
05:33:00	1992-10-16 19:02:12.003003-07	1992-10-16 18:30:00-07
05:33:00	1994-12-04 13:02:13.003003-08	1994-12-04 08:21:00-08
05:33:00	1997-01-01 23:02:14.003003-08	1997-01-01 18:33:00-08
333:00:00	1999-04-25 19:02:15.003003-07	1999-04-14 02:00:00-07
333:00:00	1999-12-31 16:00:00-08	1999-12-19 19:00:00-08
333:00:00	2000-01-02 16:00:00-08	2000-01-02 16:00:00-08
333:00:00	2000-03-25 17:00:00-08	2000-03-12 01:00:00-08
333:00:00	2000-04-02 03:00:00-07	2000-03-25 22:00:00-08
333:00:00	2000-10-28 18:00:00-07	2000-10-20 02:00:00-07
333:00:00	2000-10-29 01:00:00-08	2000-10-20 02:00:00-07
10 days	2008-12-31 15:59:59.999999-08	2008-12-25 16:00:00-08
7 days	2010-05-02 19:02:19.003003-07	2010-05-02 17:00:00-07
10 days	2013-08-18 17:02:20.003003-07	2013-08-11 17:00:00-07
10 days	2014-07-14 21:02:21.003003-07	2014-07-07 17:00:00-07
2 months	2016-03-20 19:02:22.003003-07	2016-02-29 16:00:00-08
2 months	2018-01-31 09:02:23.003003-08	2017-12-31 16:00:00-08
2 months	2019-09-30 04:02:24.003003-07	2019-08-31 17:00:00-07
2 years	2020-03-19 08:02:25.003003-07	2019-12-31 16:00:00-08
2 years	2022-07-20 06:02:26.003003-07	2021-12-31 16:00:00-08
10 days	2024-08-11 12:02:26.003003-07	2024-08-03 17:00:00-07
10 days	2032-12-18 01:02:26.003003-08	2032-12-09 16:00:00-08
10 days	infinity	infinity

query II
select t, time_bucket('4 seconds'::interval, t, '2 seconds'::interval) from timestamps_tz;
----
-infinity	-infinity
1907-11-19 12:00:00-08	1907-11-19 11:59:58-08
1969-12-31 16:00:00-08	1969-12-31 15:59:58-08
1979-04-09 21:02:05.003003-08	1979-04-09 21:02:02-08
1981-09-29 19:02:06.003003-07	1981-09-29 19:02:06-07
1982-06-14 15:02:07.003003-07	1982-06-14 15:02:06-07
1985-02-19 22:02:08.003003-08	1985-02-19 22:02:06-08
1989-06-07 19:02:09.003003-07	1989-06-07 19:02:06-07
1990-07-10 17:02:10.003003-07	1990-07-10 17:02:10-07
1991-05-11 21:02:11.003003-07	1991-05-11 21:02:10-07
1992-10-16 19:02:12.003003-07	1992-10-16 19:02:10-07
1994-12-04 13:02:13.003003-08	1994-12-04 13:02:10-08
1997-01-01 23:02:14.003003-08	1997-01-01 23:02:14-08
1999-04-25 19:02:15.003003-07	1999-04-25 19:02:14-07
1999-12-31 16:00:00-08	1999-12-31 15:59:58-08
2000-01-02 16:00:00-08	2000-01-02 15:59:58-08
2000-03-25 17:00:00-08	2000-03-25 16:59:58-08
2000-04-02 03:00:00-07	2000-04-02 01:59:58-08
2000-10-28 18:00:00-07	2000-10-28 17:59:58-07
2000-10-29 01:00:00-08	2000-10-29 01:59:58-07
2008-12-31 15:59:59.999999-08	2008-12-31 15:59:58-08
2010-05-02 19:02:19.003003-07	2010-05-02 19:02:18-07
2013-08-18 17:02:20.003003-07	2013-08-18 17:02:18-07
2014-07-14 21:02:21.003003-07	2014-07-14 21:02:18-07
2016-03-20 19:02:22.003003-07	2016-03-20 19:02:22-07
2018-01-31 09:02:23.003003-08	2018-01-31 09:02:22-08
2019-09-30 04:02:24.003003-07	2019-09-30 04:02:22-07
2020-03-19 08:02:25.003003-07	2020-03-19 08:02:22-07
2022-07-20 06:02:26.003003-07	2022-07-20 06:02:26-07
2024-08-11 12:02:26.003003-07	2024-08-11 12:02:26-07
2032-12-18 01:02:26.003003-08	2032-12-18 01:02:26-08
infinity	infinity

query II
select t, time_bucket('4 days'::interval, t, '6 hours'::interval) from timestamps_tz;
----
-infinity	-infinity
1907-11-19 12:00:00-08	1907-11-18 22:00:00-08
1969-12-31 16:00:00-08	1969-12-30 22:00:00-08
1979-04-09 21:02:05.003003-08	1979-04-06 22:00:00-08
1981-09-29 19:02:06.003003-07	1981-09-26 23:00:00-07
1982-06-14 15:02:07.003003-07	1982-06-13 23:00:00-07
1985-02-19 22:02:08.003003-08	1985-02-17 22:00:00-08
1989-06-07 19:02:09.003003-07	1989-06-04 23:00:00-07
1990-07-10 17:02:10.003003-07	1990-07-09 23:00:00-07
1991-05-11 21:02:11.003003-07	1991-05-09 23:00:00-07
1992-10-16 19:02:12.003003-07	1992-10-14 23:00:00-07
1994-12-04 13:02:13.003003-08	1994-12-03 22:00:00-08
1997-01-01 23:02:14.003003-08	1997-01-01 22:00:00-08
1999-04-25 19:02:15.003003-07	1999-04-21 23:00:00-07
1999-12-31 16:00:00-08	1999-12-29 22:00:00-08
2000-01-02 16:00:00-08	1999-12-29 22:00:00-08
2000-03-25 17:00:00-08	2000-03-22 22:00:00-08
2000-04-02 03:00:00-07	2000-03-30 22:00:00-08
2000-10-28 18:00:00-07	2000-10-24 23:00:00-07
2000-10-29 01:00:00-08	2000-10-28 23:00:00-07
2008-12-31 15:59:59.999999-08	2008-12-29 22:00:00-08
2010-05-02 19:02:19.003003-07	2010-05-01 23:00:00-07
2013-08-18 17:02:20.003003-07	2013-08-17 23:00:00-07
2014-07-14 21:02:21.003003-07	2014-07-11 23:00:00-07
2016-03-20 19:02:22.003003-07	2016-03-18 23:00:00-07
2018-01-31 09:02:23.003003-08	2018-01-27 22:00:00-08
2019-09-30 04:02:24.003003-07	2019-09-27 23:00:00-07
2020-03-19 08:02:25.003003-07	2020-03-17 23:00:00-07
2022-07-20 06:02:26.003003-07	2022-07-17 23:00:00-07
2024-08-11 12:02:26.003003-07	2024-08-07 23:00:00-07
2032-12-18 01:02:26.003003-08	2032-12-15 22:00:00-08
infinity	infinity

query II
select t, time_bucket('3 months'::interval, t, '6 days 11 hours'::interval) from timestamps_tz;
----
-infinity	-infinity
1907-11-19 12:00:00-08	1907-10-07 03:00:00-08
1969-12-31 16:00:00-08	1969-10-07 04:00:00-07
1979-04-09 21:02:05.003003-08	1979-04-07 03:00:00-08
1981-09-29 19:02:06.003003-07	1981-07-07 04:00:00-07
1982-06-14 15:02:07.003003-07	1982-04-07 03:00:00-08
1985-02-19 22:02:08.003003-08	1985-01-07 03:00:00-08
1989-06-07 19:02:09.003003-07	1989-04-07 04:00:00-07
1990-07-10 17:02:10.003003-07	1990-07-07 04:00:00-07
1991-05-11 21:02:11.003003-07	1991-04-07 04:00:00-07
1992-10-16 19:02:12.003003-07	1992-10-07 04:00:00-07
1994-12-04 13:02:13.003003-08	1994-10-07 04:00:00-07
1997-01-01 23:02:14.003003-08	1996-10-07 04:00:00-07
1999-04-25 19:02:15.003003-07	1999-04-07 04:00:00-07
1999-12-31 16:00:00-08	1999-10-07 04:00:00-07
2000-01-02 16:00:00-08	1999-10-07 04:00:00-07
2000-03-25 17:00:00-08	2000-01-07 03:00:00-08
2000-04-02 03:00:00-07	2000-01-07 03:00:00-08
2000-10-28 18:00:00-07	2000-10-07 04:00:00-07
2000-10-29 01:00:00-08	2000-10-07 04:00:00-07
2008-12-31 15:59:59.999999-08	2008-10-07 04:00:00-07
2010-05-02 19:02:19.003003-07	2010-04-07 04:00:00-07
2013-08-18 17:02:20.003003-07	2013-07-07 04:00:00-07
2014-07-14 21:02:21.003003-07	2014-07-07 04:00:00-07
2016-03-20 19:02:22.003003-07	2016-01-07 03:00:00-08
2018-01-31 09:02:23.003003-08	2018-01-07 03:00:00-08
2019-09-30 04:02:24.003003-07	2019-07-07 04:00:00-07
2020-03-19 08:02:25.003003-07	2020-01-07 03:00:00-08
2022-07-20 06:02:26.003003-07	2022-07-07 04:00:00-07
2024-08-11 12:02:26.003003-07	2024-07-07 04:00:00-07
2032-12-18 01:02:26.003003-08	2032-10-07 04:00:00-07
infinity	infinity

query II
select t, time_bucket(null::interval, t, '2 seconds'::interval) from timestamps_tz;
----
-infinity	NULL
1907-11-19 12:00:00-08	NULL
1969-12-31 16:00:00-08	NULL
1979-04-09 21:02:05.003003-08	NULL
1981-09-29 19:02:06.003003-07	NULL
1982-06-14 15:02:07.003003-07	NULL
1985-02-19 22:02:08.003003-08	NULL
1989-06-07 19:02:09.003003-07	NULL
1990-07-10 17:02:10.003003-07	NULL
1991-05-11 21:02:11.003003-07	NULL
1992-10-16 19:02:12.003003-07	NULL
1994-12-04 13:02:13.003003-08	NULL
1997-01-01 23:02:14.003003-08	NULL
1999-04-25 19:02:15.003003-07	NULL
1999-12-31 16:00:00-08	NULL
2000-01-02 16:00:00-08	NULL
2000-03-25 17:00:00-08	NULL
2000-04-02 03:00:00-07	NULL
2000-10-28 18:00:00-07	NULL
2000-10-29 01:00:00-08	NULL
2008-12-31 15:59:59.999999-08	NULL
2010-05-02 19:02:19.003003-07	NULL
2013-08-18 17:02:20.003003-07	NULL
2014-07-14 21:02:21.003003-07	NULL
2016-03-20 19:02:22.003003-07	NULL
2018-01-31 09:02:23.003003-08	NULL
2019-09-30 04:02:24.003003-07	NULL
2020-03-19 08:02:25.003003-07	NULL
2022-07-20 06:02:26.003003-07	NULL
2024-08-11 12:02:26.003003-07	NULL
2032-12-18 01:02:26.003003-08	NULL
infinity	NULL

query I
select time_bucket('3 months'::interval, null::timestamptz, '2 seconds'::interval) from timestamps_tz;
----
NULL
NULL
NULL
NULL
NULL
NULL
NULL
NULL
NULL
NULL
NULL
NULL
NULL
NULL
NULL
NULL
NULL
NULL
NULL
NULL
NULL
NULL
NULL
NULL
NULL
NULL
NULL
NULL
NULL
NULL
NULL
NULL

query II
select t, time_bucket('3 months'::interval, t, null::interval) from timestamps_tz;
----
-infinity	NULL
1907-11-19 12:00:00-08	NULL
1969-12-31 16:00:00-08	NULL
1979-04-09 21:02:05.003003-08	NULL
1981-09-29 19:02:06.003003-07	NULL
1982-06-14 15:02:07.003003-07	NULL
1985-02-19 22:02:08.003003-08	NULL
1989-06-07 19:02:09.003003-07	NULL
1990-07-10 17:02:10.003003-07	NULL
1991-05-11 21:02:11.003003-07	NULL
1992-10-16 19:02:12.003003-07	NULL
1994-12-04 13:02:13.003003-08	NULL
1997-01-01 23:02:14.003003-08	NULL
1999-04-25 19:02:15.003003-07	NULL
1999-12-31 16:00:00-08	NULL
2000-01-02 16:00:00-08	NULL
2000-03-25 17:00:00-08	NULL
2000-04-02 03:00:00-07	NULL
2000-10-28 18:00:00-07	NULL
2000-10-29 01:00:00-08	NULL
2008-12-31 15:59:59.999999-08	NULL
2010-05-02 19:02:19.003003-07	NULL
2013-08-18 17:02:20.003003-07	NULL
2014-07-14 21:02:21.003003-07	NULL
2016-03-20 19:02:22.003003-07	NULL
2018-01-31 09:02:23.003003-08	NULL
2019-09-30 04:02:24.003003-07	NULL
2020-03-19 08:02:25.003003-07	NULL
2022-07-20 06:02:26.003003-07	NULL
2024-08-11 12:02:26.003003-07	NULL
2032-12-18 01:02:26.003003-08	NULL
infinity	NULL

query IIII
select w, t, shift, time_bucket(w, t, shift) from timestamps_tz;
----
10 days	-infinity	00:00:00	-infinity
00:00:00.000333	1907-11-19 12:00:00-08	00:00:00	1907-11-19 11:59:59.999892-08
00:00:00.000333	1969-12-31 16:00:00-08	00:00:00.000444	1969-12-31 15:59:59.99985-08
00:00:00.000333	1979-04-09 21:02:05.003003-08	-00:00:00.000444	1979-04-09 21:02:05.002905-08
00:00:00.333	1981-09-29 19:02:06.003003-07	00:00:00	1981-09-29 19:02:05.712-07
00:00:00.333	1982-06-14 15:02:07.003003-07	00:00:00.444	1982-06-14 15:02:06.723-07
00:00:00.333	1985-02-19 22:02:08.003003-08	-00:00:00.444	1985-02-19 22:02:07.761-08
00:05:33	1989-06-07 19:02:09.003003-07	00:00:00	1989-06-07 19:01:57-07
00:05:33	1990-07-10 17:02:10.003003-07	00:07:24	1990-07-10 16:56:54-07
00:05:33	1991-05-11 21:02:11.003003-07	-00:07:24	1991-05-11 20:56:39-07
05:33:00	1992-10-16 19:02:12.003003-07	00:00:00	1992-10-16 18:30:00-07
05:33:00	1994-12-04 13:02:13.003003-08	07:24:00	1994-12-04 10:12:00-08
05:33:00	1997-01-01 23:02:14.003003-08	-07:24:00	1997-01-01 22:15:00-08
333:00:00	1999-04-25 19:02:15.003003-07	00:00:00	1999-04-14 02:00:00-07
333:00:00	1999-12-31 16:00:00-08	444:00:00	1999-12-24 10:00:00-08
333:00:00	2000-01-02 16:00:00-08	-444:00:00	1999-12-29 01:00:00-08
333:00:00	2000-03-25 17:00:00-08	00:00:00	2000-03-12 01:00:00-08
333:00:00	2000-04-02 03:00:00-07	00:00:00	2000-03-25 22:00:00-08
333:00:00	2000-10-28 18:00:00-07	00:00:00	2000-10-20 02:00:00-07
333:00:00	2000-10-29 01:00:00-08	00:00:00	2000-10-20 02:00:00-07
10 days	2008-12-31 15:59:59.999999-08	00:00:00	2008-12-25 16:00:00-08
7 days	2010-05-02 19:02:19.003003-07	00:00:00	2010-05-02 17:00:00-07
10 days	2013-08-18 17:02:20.003003-07	2 days 04:00:00	2013-08-13 21:00:00-07
10 days	2014-07-14 21:02:21.003003-07	-2 days 04:00:00	2014-07-05 21:00:00-07
2 months	2016-03-20 19:02:22.003003-07	00:00:00	2016-02-29 16:00:00-08
2 months	2018-01-31 09:02:23.003003-08	1 month 7 days	2017-12-07 16:00:00-08
2 months	2019-09-30 04:02:24.003003-07	-1 month 7 days	2019-08-07 17:00:00-07
2 years	2020-03-19 08:02:25.003003-07	6 months	2018-06-30 17:00:00-07
2 years	2022-07-20 06:02:26.003003-07	-6 months	2021-06-30 17:00:00-07
10 days	2024-08-11 12:02:26.003003-07	1 year	2024-08-09 17:00:00-07
10 days	2032-12-18 01:02:26.003003-08	-1 year	2032-12-14 16:00:00-08
10 days	infinity	00:00:00	infinity

query II
select t, time_bucket('11 seconds'::interval, t, '1990-12-10 08:08:10+03'::timestamptz) from timestamps_tz;
----
-infinity	-infinity
1907-11-19 12:00:00-08	1907-11-19 11:59:59-08
1969-12-31 16:00:00-08	1969-12-31 15:59:55-08
1979-04-09 21:02:05.003003-08	1979-04-09 21:02:04-08
1981-09-29 19:02:06.003003-07	1981-09-29 19:02:01-07
1982-06-14 15:02:07.003003-07	1982-06-14 15:02:05-07
1985-02-19 22:02:08.003003-08	1985-02-19 22:02:02-08
1989-06-07 19:02:09.003003-07	1989-06-07 19:02:05-07
1990-07-10 17:02:10.003003-07	1990-07-10 17:02:10-07
1991-05-11 21:02:11.003003-07	1991-05-11 21:02:05-07
1992-10-16 19:02:12.003003-07	1992-10-16 19:02:02-07
1994-12-04 13:02:13.003003-08	1994-12-04 13:02:07-08
1997-01-01 23:02:14.003003-08	1997-01-01 23:02:10-08
1999-04-25 19:02:15.003003-07	1999-04-25 19:02:10-07
1999-12-31 16:00:00-08	1999-12-31 16:00:00-08
2000-01-02 16:00:00-08	2000-01-02 15:59:59-08
2000-03-25 17:00:00-08	2000-03-25 16:59:53-08
2000-04-02 03:00:00-07	2000-04-02 01:59:50-08
2000-10-28 18:00:00-07	2000-10-28 18:00:00-07
2000-10-29 01:00:00-08	2000-10-29 01:59:58-07
2008-12-31 15:59:59.999999-08	2008-12-31 15:59:55-08
2010-05-02 19:02:19.003003-07	2010-05-02 19:02:16-07
2013-08-18 17:02:20.003003-07	2013-08-18 17:02:14-07
2014-07-14 21:02:21.003003-07	2014-07-14 21:02:13-07
2016-03-20 19:02:22.003003-07	2016-03-20 19:02:14-07
2018-01-31 09:02:23.003003-08	2018-01-31 09:02:19-08
2019-09-30 04:02:24.003003-07	2019-09-30 04:02:14-07
2020-03-19 08:02:25.003003-07	2020-03-19 08:02:21-07
2022-07-20 06:02:26.003003-07	2022-07-20 06:02:24-07
2024-08-11 12:02:26.003003-07	2024-08-11 12:02:20-07
2032-12-18 01:02:26.003003-08	2032-12-18 01:02:26-08
infinity	infinity

query II
select t, time_bucket('11 days'::interval, t, '1990-01-06 08:08:10+09'::timestamptz) from timestamps_tz;
----
-infinity	-infinity
1907-11-19 12:00:00-08	1907-11-09 15:08:10-08
1969-12-31 16:00:00-08	1969-12-26 15:08:10-08
1979-04-09 21:02:05.003003-08	1979-04-06 15:08:10-08
1981-09-29 19:02:06.003003-07	1981-09-24 16:08:10-07
1982-06-14 15:02:07.003003-07	1982-06-04 16:08:10-07
1985-02-19 22:02:08.003003-08	1985-02-18 15:08:10-08
1989-06-07 19:02:09.003003-07	1989-05-30 16:08:10-07
1990-07-10 17:02:10.003003-07	1990-06-30 16:08:10-07
1991-05-11 21:02:11.003003-07	1991-05-04 16:08:10-07
1992-10-16 19:02:12.003003-07	1992-10-13 16:08:10-07
1994-12-04 13:02:13.003003-08	1994-12-03 15:08:10-08
1997-01-01 23:02:14.003003-08	1996-12-31 15:08:10-08
1999-04-25 19:02:15.003003-07	1999-04-16 16:08:10-07
1999-12-31 16:00:00-08	1999-12-25 15:08:10-08
2000-01-02 16:00:00-08	1999-12-25 15:08:10-08
2000-03-25 17:00:00-08	2000-03-22 15:08:10-08
2000-04-02 03:00:00-07	2000-03-22 15:08:10-08
2000-10-28 18:00:00-07	2000-10-28 16:08:10-07
2000-10-29 01:00:00-08	2000-10-28 16:08:10-07
2008-12-31 15:59:59.999999-08	2008-12-26 15:08:10-08
2010-05-02 19:02:19.003003-07	2010-04-24 16:08:10-07
2013-08-18 17:02:20.003003-07	2013-08-16 16:08:10-07
2014-07-14 21:02:21.003003-07	2014-07-12 16:08:10-07
2016-03-20 19:02:22.003003-07	2016-03-19 16:08:10-07
2018-01-31 09:02:23.003003-08	2018-01-30 15:08:10-08
2019-09-30 04:02:24.003003-07	2019-09-27 16:08:10-07
2020-03-19 08:02:25.003003-07	2020-03-10 16:08:10-07
2022-07-20 06:02:26.003003-07	2022-07-16 16:08:10-07
2024-08-11 12:02:26.003003-07	2024-08-02 16:08:10-07
2032-12-18 01:02:26.003003-08	2032-12-16 15:08:10-08
infinity	infinity

query II
select t, time_bucket('7 months'::interval, t, '1990-01-06 08:08:10+01'::timestamptz) from timestamps_tz;
----
-infinity	-infinity
1907-11-19 12:00:00-08	1907-09-30 16:00:00-08
1969-12-31 16:00:00-08	1969-07-31 17:00:00-07
1979-04-09 21:02:05.003003-08	1978-11-30 16:00:00-08
1981-09-29 19:02:06.003003-07	1981-03-31 16:00:00-08
1982-06-14 15:02:07.003003-07	1982-05-31 17:00:00-07
1985-02-19 22:02:08.003003-08	1984-09-30 17:00:00-07
1989-06-07 19:02:09.003003-07	1989-05-31 17:00:00-07
1990-07-10 17:02:10.003003-07	1989-12-31 16:00:00-08
1991-05-11 21:02:11.003003-07	1991-02-28 16:00:00-08
1992-10-16 19:02:12.003003-07	1992-04-30 17:00:00-07
1994-12-04 13:02:13.003003-08	1994-08-31 17:00:00-07
1997-01-01 23:02:14.003003-08	1996-12-31 16:00:00-08
1999-04-25 19:02:15.003003-07	1998-09-30 17:00:00-07
1999-12-31 16:00:00-08	1999-11-30 16:00:00-08
2000-01-02 16:00:00-08	1999-11-30 16:00:00-08
2000-03-25 17:00:00-08	1999-11-30 16:00:00-08
2000-04-02 03:00:00-07	1999-11-30 16:00:00-08
2000-10-28 18:00:00-07	2000-06-30 17:00:00-07
2000-10-29 01:00:00-08	2000-06-30 17:00:00-07
2008-12-31 15:59:59.999999-08	2008-08-31 17:00:00-07
2010-05-02 19:02:19.003003-07	2009-10-31 17:00:00-07
2013-08-18 17:02:20.003003-07	2013-04-30 17:00:00-07
2014-07-14 21:02:21.003003-07	2014-06-30 17:00:00-07
2016-03-20 19:02:22.003003-07	2015-08-31 17:00:00-07
2018-01-31 09:02:23.003003-08	2017-12-31 16:00:00-08
2019-09-30 04:02:24.003003-07	2019-02-28 16:00:00-08
2020-03-19 08:02:25.003003-07	2019-09-30 17:00:00-07
2022-07-20 06:02:26.003003-07	2022-01-31 16:00:00-08
2024-08-11 12:02:26.003003-07	2024-05-31 17:00:00-07
2032-12-18 01:02:26.003003-08	2032-07-31 17:00:00-07
infinity	infinity

query II
select t, time_bucket(null::interval, t, '1990-01-06 08:08:10'::timestamptz) from timestamps_tz;
----
-infinity	NULL
1907-11-19 12:00:00-08	NULL
1969-12-31 16:00:00-08	NULL
1979-04-09 21:02:05.003003-08	NULL
1981-09-29 19:02:06.003003-07	NULL
1982-06-14 15:02:07.003003-07	NULL
1985-02-19 22:02:08.003003-08	NULL
1989-06-07 19:02:09.003003-07	NULL
1990-07-10 17:02:10.003003-07	NULL
1991-05-11 21:02:11.003003-07	NULL
1992-10-16 19:02:12.003003-07	NULL
1994-12-04 13:02:13.003003-08	NULL
1997-01-01 23:02:14.003003-08	NULL
1999-04-25 19:02:15.003003-07	NULL
1999-12-31 16:00:00-08	NULL
2000-01-02 16:00:00-08	NULL
2000-03-25 17:00:00-08	NULL
2000-04-02 03:00:00-07	NULL
2000-10-28 18:00:00-07	NULL
2000-10-29 01:00:00-08	NULL
2008-12-31 15:59:59.999999-08	NULL
2010-05-02 19:02:19.003003-07	NULL
2013-08-18 17:02:20.003003-07	NULL
2014-07-14 21:02:21.003003-07	NULL
2016-03-20 19:02:22.003003-07	NULL
2018-01-31 09:02:23.003003-08	NULL
2019-09-30 04:02:24.003003-07	NULL
2020-03-19 08:02:25.003003-07	NULL
2022-07-20 06:02:26.003003-07	NULL
2024-08-11 12:02:26.003003-07	NULL
2032-12-18 01:02:26.003003-08	NULL
infinity	NULL

query I
select time_bucket('7 months'::interval, null::timestamptz, '1990-01-06 08:08:10'::timestamptz) from timestamps_tz;
----
NULL
NULL
NULL
NULL
NULL
NULL
NULL
NULL
NULL
NULL
NULL
NULL
NULL
NULL
NULL
NULL
NULL
NULL
NULL
NULL
NULL
NULL
NULL
NULL
NULL
NULL
NULL
NULL
NULL
NULL
NULL
NULL

query II
select t, time_bucket('7 months'::interval, t, null::timestamptz) from timestamps_tz;
----
-infinity	NULL
1907-11-19 12:00:00-08	NULL
1969-12-31 16:00:00-08	NULL
1979-04-09 21:02:05.003003-08	NULL
1981-09-29 19:02:06.003003-07	NULL
1982-06-14 15:02:07.003003-07	NULL
1985-02-19 22:02:08.003003-08	NULL
1989-06-07 19:02:09.003003-07	NULL
1990-07-10 17:02:10.003003-07	NULL
1991-05-11 21:02:11.003003-07	NULL
1992-10-16 19:02:12.003003-07	NULL
1994-12-04 13:02:13.003003-08	NULL
1997-01-01 23:02:14.003003-08	NULL
1999-04-25 19:02:15.003003-07	NULL
1999-12-31 16:00:00-08	NULL
2000-01-02 16:00:00-08	NULL
2000-03-25 17:00:00-08	NULL
2000-04-02 03:00:00-07	NULL
2000-10-28 18:00:00-07	NULL
2000-10-29 01:00:00-08	NULL
2008-12-31 15:59:59.999999-08	NULL
2010-05-02 19:02:19.003003-07	NULL
2013-08-18 17:02:20.003003-07	NULL
2014-07-14 21:02:21.003003-07	NULL
2016-03-20 19:02:22.003003-07	NULL
2018-01-31 09:02:23.003003-08	NULL
2019-09-30 04:02:24.003003-07	NULL
2020-03-19 08:02:25.003003-07	NULL
2022-07-20 06:02:26.003003-07	NULL
2024-08-11 12:02:26.003003-07	NULL
2032-12-18 01:02:26.003003-08	NULL
infinity	NULL

query IIII
select w, t, origin, time_bucket(w, t, origin) from timestamps_tz;
----
10 days	-infinity	1970-01-04 16:00:00-08	-infinity
00:00:00.000333	1907-11-19 12:00:00-08	1970-03-05 16:00:00-08	1907-11-19 11:59:59.999955-08
00:00:00.000333	1969-12-31 16:00:00-08	1970-01-04 13:05:05.006006-08	1969-12-31 15:59:59.999786-08
00:00:00.000333	1979-04-09 21:02:05.003003-08	1962-12-09 19:05:05.006006-08	1979-04-09 21:02:05.002757-08
00:00:00.333	1981-09-29 19:02:06.003003-07	1970-02-04 16:00:00-08	1981-09-29 19:02:06-07
00:00:00.333	1982-06-14 15:02:07.003003-07	1970-11-14 12:05:05.006006-08	1982-06-14 15:02:06.806006-07
00:00:00.333	1985-02-19 22:02:08.003003-08	1980-08-04 21:05:05.006006-07	1985-02-19 22:02:07.742006-08
00:05:33	1989-06-07 19:02:09.003003-07	1970-11-24 16:00:00-08	1989-06-07 18:59:06-07
00:05:33	1990-07-10 17:02:10.003003-07	1970-04-09 14:05:05.006006-08	1990-07-10 16:58:11.006006-07
00:05:33	1991-05-11 21:02:11.003003-07	1971-01-04 18:05:05.006006-08	1991-05-11 20:57:44.006006-07
05:33:00	1992-10-16 19:02:12.003003-07	1950-04-23 16:00:00-08	1992-10-16 14:00:00-07
05:33:00	1994-12-04 13:02:13.003003-08	1970-06-08 12:05:05.006006-07	1994-12-04 10:38:05.006006-08
05:33:00	1997-01-01 23:02:14.003003-08	1970-07-05 22:05:05.006006-07	1997-01-01 18:23:05.006006-08
333:00:00	1999-04-25 19:02:15.003003-07	1970-02-04 16:00:00-08	1999-04-23 14:00:00-07
333:00:00	1999-12-31 16:00:00-08	1970-01-04 15:05:05.006006-08	1999-12-26 00:05:05.006006-08
333:00:00	2000-01-02 16:00:00-08	1970-03-14 17:05:05.006006-08	1999-12-25 17:05:05.006006-08
333:00:00	2000-03-25 17:00:00-08	1980-10-04 17:00:00-07	2000-03-17 16:00:00-08
333:00:00	2000-04-02 03:00:00-07	1990-05-19 17:00:00-07	2000-03-21 07:00:00-08
333:00:00	2000-10-28 18:00:00-07	2010-07-26 17:00:00-07	2000-10-20 20:00:00-07
333:00:00	2000-10-29 01:00:00-08	2010-07-26 17:00:00-07	2000-10-20 20:00:00-07
10 days	2008-12-31 15:59:59.999999-08	1970-02-26 16:00:00-08	2008-12-23 16:00:00-08
7 days	2010-05-02 19:02:19.003003-07	1970-07-24 17:00:00-07	2010-04-30 17:00:00-07
10 days	2013-08-18 17:02:20.003003-07	2003-03-23 14:05:05.006006-08	2013-08-17 15:05:05.006006-07
10 days	2014-07-14 21:02:21.003003-07	1970-04-11 18:05:05.006006-08	2014-07-09 19:05:05.006006-07
2 months	2016-03-20 19:02:22.003003-07	1970-11-04 16:00:00-08	2016-02-29 16:00:00-08
2 months	2018-01-31 09:02:23.003003-08	1970-05-06 08:05:05.006006-07	2017-12-31 16:00:00-08
2 months	2019-09-30 04:02:24.003003-07	1969-10-09 02:05:05.006006-07	2019-07-31 17:00:00-07
2 years	2020-03-19 08:02:25.003003-07	2032-06-28 06:05:05.006006-07	2018-05-31 17:00:00-07
2 years	2022-07-20 06:02:26.003003-07	1969-11-14 03:05:05.006006-08	2021-10-31 17:00:00-07
10 days	2024-08-11 12:02:26.003003-07	-infinity	NULL
10 days	2032-12-18 01:02:26.003003-08	infinity	NULL
10 days	infinity	1969-12-31 16:00:00-08	infinity

query II
select t, time_bucket('11 seconds'::interval, t, 'Asia/Calcutta') from timestamps_tz;
----
-infinity	-infinity
1907-11-19 12:00:00-08	1907-11-19 12:00:00-08
1969-12-31 16:00:00-08	1969-12-31 15:59:56-08
1979-04-09 21:02:05.003003-08	1979-04-09 21:02:05-08
1981-09-29 19:02:06.003003-07	1981-09-29 19:02:02-07
1982-06-14 15:02:07.003003-07	1982-06-14 15:02:06-07
1985-02-19 22:02:08.003003-08	1985-02-19 22:02:03-08
1989-06-07 19:02:09.003003-07	1989-06-07 19:02:06-07
1990-07-10 17:02:10.003003-07	1990-07-10 17:02:00-07
1991-05-11 21:02:11.003003-07	1991-05-11 21:02:06-07
1992-10-16 19:02:12.003003-07	1992-10-16 19:02:03-07
1994-12-04 13:02:13.003003-08	1994-12-04 13:02:08-08
1997-01-01 23:02:14.003003-08	1997-01-01 23:02:11-08
1999-04-25 19:02:15.003003-07	1999-04-25 19:02:11-07
1999-12-31 16:00:00-08	1999-12-31 15:59:50-08
2000-01-02 16:00:00-08	2000-01-02 16:00:00-08
2000-03-25 17:00:00-08	2000-03-25 16:59:54-08
2000-04-02 03:00:00-07	2000-04-02 01:59:51-08
2000-10-28 18:00:00-07	2000-10-28 17:59:50-07
2000-10-29 01:00:00-08	2000-10-29 01:59:59-07
2008-12-31 15:59:59.999999-08	2008-12-31 15:59:56-08
2010-05-02 19:02:19.003003-07	2010-05-02 19:02:17-07
2013-08-18 17:02:20.003003-07	2013-08-18 17:02:15-07
2014-07-14 21:02:21.003003-07	2014-07-14 21:02:14-07
2016-03-20 19:02:22.003003-07	2016-03-20 19:02:15-07
2018-01-31 09:02:23.003003-08	2018-01-31 09:02:20-08
2019-09-30 04:02:24.003003-07	2019-09-30 04:02:15-07
2020-03-19 08:02:25.003003-07	2020-03-19 08:02:22-07
2022-07-20 06:02:26.003003-07	2022-07-20 06:02:25-07
2024-08-11 12:02:26.003003-07	2024-08-11 12:02:21-07
2032-12-18 01:02:26.003003-08	2032-12-18 01:02:16-08
infinity	infinity

query II
select t, time_bucket('5 months'::interval, t, 'Europe/Berlin') from timestamps_tz;
----
-infinity	-infinity
1907-11-19 12:00:00-08	1907-06-30 15:00:00-08
1969-12-31 16:00:00-08	1969-12-31 15:00:00-08
1979-04-09 21:02:05.003003-08	1979-02-28 15:00:00-08
1981-09-29 19:02:06.003003-07	1981-08-31 15:00:00-07
1982-06-14 15:02:07.003003-07	1982-01-31 15:00:00-08
1985-02-19 22:02:08.003003-08	1984-12-31 15:00:00-08
1989-06-07 19:02:09.003003-07	1989-02-28 15:00:00-08
1990-07-10 17:02:10.003003-07	1990-05-31 15:00:00-07
1991-05-11 21:02:11.003003-07	1991-03-31 14:00:00-08
1992-10-16 19:02:12.003003-07	1992-06-30 15:00:00-07
1994-12-04 13:02:13.003003-08	1994-07-31 15:00:00-07
1997-01-01 23:02:14.003003-08	1996-08-31 15:00:00-07
1999-04-25 19:02:15.003003-07	1999-02-28 15:00:00-08
1999-12-31 16:00:00-08	1999-12-31 15:00:00-08
2000-01-02 16:00:00-08	1999-12-31 15:00:00-08
2000-03-25 17:00:00-08	1999-12-31 15:00:00-08
2000-04-02 03:00:00-07	1999-12-31 15:00:00-08
2000-10-28 18:00:00-07	2000-05-31 15:00:00-07
2000-10-29 01:00:00-08	2000-05-31 15:00:00-07
2008-12-31 15:59:59.999999-08	2008-09-30 15:00:00-07
2010-05-02 19:02:19.003003-07	2009-12-31 15:00:00-08
2013-08-18 17:02:20.003003-07	2013-04-30 15:00:00-07
2014-07-14 21:02:21.003003-07	2014-02-28 15:00:00-08
2016-03-20 19:02:22.003003-07	2015-10-31 16:00:00-07
2018-01-31 09:02:23.003003-08	2017-11-30 15:00:00-08
2019-09-30 04:02:24.003003-07	2019-07-31 15:00:00-07
2020-03-19 08:02:25.003003-07	2019-12-31 15:00:00-08
2022-07-20 06:02:26.003003-07	2022-06-30 15:00:00-07
2024-08-11 12:02:26.003003-07	2024-07-31 15:00:00-07
2032-12-18 01:02:26.003003-08	2032-11-30 15:00:00-08
infinity	infinity

query II
select t, time_bucket('11 seconds'::interval, t, 'Europe/Berlin') from timestamps_tz;
----
-infinity	-infinity
1907-11-19 12:00:00-08	1907-11-19 11:59:57-08
1969-12-31 16:00:00-08	1969-12-31 15:59:53-08
1979-04-09 21:02:05.003003-08	1979-04-09 21:02:02-08
1981-09-29 19:02:06.003003-07	1981-09-29 19:01:59-07
1982-06-14 15:02:07.003003-07	1982-06-14 15:02:03-07
1985-02-19 22:02:08.003003-08	1985-02-19 22:02:00-08
1989-06-07 19:02:09.003003-07	1989-06-07 19:02:03-07
1990-07-10 17:02:10.003003-07	1990-07-10 17:02:08-07
1991-05-11 21:02:11.003003-07	1991-05-11 21:02:03-07
1992-10-16 19:02:12.003003-07	1992-10-16 19:02:11-07
1994-12-04 13:02:13.003003-08	1994-12-04 13:02:05-08
1997-01-01 23:02:14.003003-08	1997-01-01 23:02:08-08
1999-04-25 19:02:15.003003-07	1999-04-25 19:02:08-07
1999-12-31 16:00:00-08	1999-12-31 15:59:58-08
2000-01-02 16:00:00-08	2000-01-02 15:59:57-08
2000-03-25 17:00:00-08	2000-03-25 16:59:51-08
2000-04-02 03:00:00-07	2000-04-02 01:59:59-08
2000-10-28 18:00:00-07	2000-10-28 17:59:58-07
2000-10-29 01:00:00-08	2000-10-29 01:59:56-07
2008-12-31 15:59:59.999999-08	2008-12-31 15:59:53-08
2010-05-02 19:02:19.003003-07	2010-05-02 19:02:14-07
2013-08-18 17:02:20.003003-07	2013-08-18 17:02:12-07
2014-07-14 21:02:21.003003-07	2014-07-14 21:02:11-07
2016-03-20 19:02:22.003003-07	2016-03-20 19:02:12-07
2018-01-31 09:02:23.003003-08	2018-01-31 09:02:17-08
2019-09-30 04:02:24.003003-07	2019-09-30 04:02:23-07
2020-03-19 08:02:25.003003-07	2020-03-19 08:02:19-07
2022-07-20 06:02:26.003003-07	2022-07-20 06:02:22-07
2024-08-11 12:02:26.003003-07	2024-08-11 12:02:18-07
2032-12-18 01:02:26.003003-08	2032-12-18 01:02:24-08
infinity	infinity

query II
select t, time_bucket('5 months'::interval, t, 'Europe/London') from timestamps_tz;
----
-infinity	-infinity
1907-11-19 12:00:00-08	1907-06-30 16:00:00-08
1969-12-31 16:00:00-08	1969-12-31 15:00:00-08
1979-04-09 21:02:05.003003-08	1979-02-28 16:00:00-08
1981-09-29 19:02:06.003003-07	1981-08-31 16:00:00-07
1982-06-14 15:02:07.003003-07	1982-01-31 16:00:00-08
1985-02-19 22:02:08.003003-08	1984-12-31 16:00:00-08
1989-06-07 19:02:09.003003-07	1989-02-28 16:00:00-08
1990-07-10 17:02:10.003003-07	1990-05-31 16:00:00-07
1991-05-11 21:02:11.003003-07	1991-03-31 15:00:00-08
1992-10-16 19:02:12.003003-07	1992-06-30 16:00:00-07
1994-12-04 13:02:13.003003-08	1994-07-31 16:00:00-07
1997-01-01 23:02:14.003003-08	1996-08-31 16:00:00-07
1999-04-25 19:02:15.003003-07	1999-02-28 16:00:00-08
1999-12-31 16:00:00-08	1999-12-31 16:00:00-08
2000-01-02 16:00:00-08	1999-12-31 16:00:00-08
2000-03-25 17:00:00-08	1999-12-31 16:00:00-08
2000-04-02 03:00:00-07	1999-12-31 16:00:00-08
2000-10-28 18:00:00-07	2000-05-31 16:00:00-07
2000-10-29 01:00:00-08	2000-05-31 16:00:00-07
2008-12-31 15:59:59.999999-08	2008-09-30 16:00:00-07
2010-05-02 19:02:19.003003-07	2009-12-31 16:00:00-08
2013-08-18 17:02:20.003003-07	2013-04-30 16:00:00-07
2014-07-14 21:02:21.003003-07	2014-02-28 16:00:00-08
2016-03-20 19:02:22.003003-07	2015-10-31 17:00:00-07
2018-01-31 09:02:23.003003-08	2017-11-30 16:00:00-08
2019-09-30 04:02:24.003003-07	2019-07-31 16:00:00-07
2020-03-19 08:02:25.003003-07	2019-12-31 16:00:00-08
2022-07-20 06:02:26.003003-07	2022-06-30 16:00:00-07
2024-08-11 12:02:26.003003-07	2024-07-31 16:00:00-07
2032-12-18 01:02:26.003003-08	2032-11-30 16:00:00-08
infinity	infinity

query II
select t, time_bucket('11 seconds'::interval, t, 'Europe/London') from timestamps_tz;
----
-infinity	-infinity
1907-11-19 12:00:00-08	1907-11-19 12:00:00-08
1969-12-31 16:00:00-08	1969-12-31 15:59:56-08
1979-04-09 21:02:05.003003-08	1979-04-09 21:02:05-08
1981-09-29 19:02:06.003003-07	1981-09-29 19:02:02-07
1982-06-14 15:02:07.003003-07	1982-06-14 15:02:06-07
1985-02-19 22:02:08.003003-08	1985-02-19 22:02:03-08
1989-06-07 19:02:09.003003-07	1989-06-07 19:02:06-07
1990-07-10 17:02:10.003003-07	1990-07-10 17:02:00-07
1991-05-11 21:02:11.003003-07	1991-05-11 21:02:06-07
1992-10-16 19:02:12.003003-07	1992-10-16 19:02:03-07
1994-12-04 13:02:13.003003-08	1994-12-04 13:02:08-08
1997-01-01 23:02:14.003003-08	1997-01-01 23:02:11-08
1999-04-25 19:02:15.003003-07	1999-04-25 19:02:11-07
1999-12-31 16:00:00-08	1999-12-31 15:59:50-08
2000-01-02 16:00:00-08	2000-01-02 16:00:00-08
2000-03-25 17:00:00-08	2000-03-25 16:59:54-08
2000-04-02 03:00:00-07	2000-04-02 01:59:51-08
2000-10-28 18:00:00-07	2000-10-28 17:59:50-07
2000-10-29 01:00:00-08	2000-10-29 01:59:59-07
2008-12-31 15:59:59.999999-08	2008-12-31 15:59:56-08
2010-05-02 19:02:19.003003-07	2010-05-02 19:02:17-07
2013-08-18 17:02:20.003003-07	2013-08-18 17:02:15-07
2014-07-14 21:02:21.003003-07	2014-07-14 21:02:14-07
2016-03-20 19:02:22.003003-07	2016-03-20 19:02:15-07
2018-01-31 09:02:23.003003-08	2018-01-31 09:02:20-08
2019-09-30 04:02:24.003003-07	2019-09-30 04:02:15-07
2020-03-19 08:02:25.003003-07	2020-03-19 08:02:22-07
2022-07-20 06:02:26.003003-07	2022-07-20 06:02:25-07
2024-08-11 12:02:26.003003-07	2024-08-11 12:02:21-07
2032-12-18 01:02:26.003003-08	2032-12-18 01:02:16-08
infinity	infinity

query II
select t, time_bucket(null::interval, t, 'Asia/Calcutta') from timestamps_tz;
----
-infinity	NULL
1907-11-19 12:00:00-08	NULL
1969-12-31 16:00:00-08	NULL
1979-04-09 21:02:05.003003-08	NULL
1981-09-29 19:02:06.003003-07	NULL
1982-06-14 15:02:07.003003-07	NULL
1985-02-19 22:02:08.003003-08	NULL
1989-06-07 19:02:09.003003-07	NULL
1990-07-10 17:02:10.003003-07	NULL
1991-05-11 21:02:11.003003-07	NULL
1992-10-16 19:02:12.003003-07	NULL
1994-12-04 13:02:13.003003-08	NULL
1997-01-01 23:02:14.003003-08	NULL
1999-04-25 19:02:15.003003-07	NULL
1999-12-31 16:00:00-08	NULL
2000-01-02 16:00:00-08	NULL
2000-03-25 17:00:00-08	NULL
2000-04-02 03:00:00-07	NULL
2000-10-28 18:00:00-07	NULL
2000-10-29 01:00:00-08	NULL
2008-12-31 15:59:59.999999-08	NULL
2010-05-02 19:02:19.003003-07	NULL
2013-08-18 17:02:20.003003-07	NULL
2014-07-14 21:02:21.003003-07	NULL
2016-03-20 19:02:22.003003-07	NULL
2018-01-31 09:02:23.003003-08	NULL
2019-09-30 04:02:24.003003-07	NULL
2020-03-19 08:02:25.003003-07	NULL
2022-07-20 06:02:26.003003-07	NULL
2024-08-11 12:02:26.003003-07	NULL
2032-12-18 01:02:26.003003-08	NULL
infinity	NULL

query I
select time_bucket('11 seconds'::interval, null::timestamptz, 'Asia/Calcutta') from timestamps_tz;
----
NULL
NULL
NULL
NULL
NULL
NULL
NULL
NULL
NULL
NULL
NULL
NULL
NULL
NULL
NULL
NULL
NULL
NULL
NULL
NULL
NULL
NULL
NULL
NULL
NULL
NULL
NULL
NULL
NULL
NULL
NULL
NULL

query II
select t, time_bucket('11 seconds'::interval, t, null::text) from timestamps_tz;
----
-infinity	NULL
1907-11-19 12:00:00-08	NULL
1969-12-31 16:00:00-08	NULL
1979-04-09 21:02:05.003003-08	NULL
1981-09-29 19:02:06.003003-07	NULL
1982-06-14 15:02:07.003003-07	NULL
1985-02-19 22:02:08.003003-08	NULL
1989-06-07 19:02:09.003003-07	NULL
1990-07-10 17:02:10.003003-07	NULL
1991-05-11 21:02:11.003003-07	NULL
1992-10-16 19:02:12.003003-07	NULL
1994-12-04 13:02:13.003003-08	NULL
1997-01-01 23:02:14.003003-08	NULL
1999-04-25 19:02:15.003003-07	NULL
1999-12-31 16:00:00-08	NULL
2000-01-02 16:00:00-08	NULL
2000-03-25 17:00:00-08	NULL
2000-04-02 03:00:00-07	NULL
2000-10-28 18:00:00-07	NULL
2000-10-29 01:00:00-08	NULL
2008-12-31 15:59:59.999999-08	NULL
2010-05-02 19:02:19.003003-07	NULL
2013-08-18 17:02:20.003003-07	NULL
2014-07-14 21:02:21.003003-07	NULL
2016-03-20 19:02:22.003003-07	NULL
2018-01-31 09:02:23.003003-08	NULL
2019-09-30 04:02:24.003003-07	NULL
2020-03-19 08:02:25.003003-07	NULL
2022-07-20 06:02:26.003003-07	NULL
2024-08-11 12:02:26.003003-07	NULL
2032-12-18 01:02:26.003003-08	NULL
infinity	NULL

query IIII
select w, t, timezone, time_bucket(w, t, timezone) from timestamps_tz;
----
10 days	-infinity	UTC	-infinity
00:00:00.000333	1907-11-19 12:00:00-08	UTC	1907-11-19 11:59:59.999892-08
00:00:00.000333	1969-12-31 16:00:00-08	America/Los_Angeles	1969-12-31 15:59:59.999901-08
00:00:00.000333	1979-04-09 21:02:05.003003-08	America/Los_Angeles	1979-04-09 21:02:05.002845-08
00:00:00.333	1981-09-29 19:02:06.003003-07	UTC	1981-09-29 19:02:05.712-07
00:00:00.333	1982-06-14 15:02:07.003003-07	Asia/Aden	1982-06-14 15:02:06.801-07
00:00:00.333	1985-02-19 22:02:08.003003-08	Asia/Aden	1985-02-19 22:02:07.728-08
00:05:33	1989-06-07 19:02:09.003003-07	UTC	1989-06-07 19:01:57-07
00:05:33	1990-07-10 17:02:10.003003-07	Pacific/Guam	1990-07-10 17:00:00-07
00:05:33	1991-05-11 21:02:11.003003-07	Pacific/Guam	1991-05-11 20:57:54-07
05:33:00	1992-10-16 19:02:12.003003-07	UTC	1992-10-16 18:30:00-07
05:33:00	1994-12-04 13:02:13.003003-08	Europe/Berlin	1994-12-04 12:54:00-08
05:33:00	1997-01-01 23:02:14.003003-08	Europe/Berlin	1997-01-01 17:33:00-08
333:00:00	1999-04-25 19:02:15.003003-07	UTC	1999-04-14 02:00:00-07
333:00:00	1999-12-31 16:00:00-08	Europe/London	1999-12-19 19:00:00-08
333:00:00	2000-01-02 16:00:00-08	Europe/London	2000-01-02 16:00:00-08
333:00:00	2000-03-25 17:00:00-08	Europe/London	2000-03-12 01:00:00-08
333:00:00	2000-04-02 03:00:00-07	Europe/London	2000-03-25 22:00:00-08
333:00:00	2000-10-28 18:00:00-07	Europe/London	2000-10-20 02:00:00-07
333:00:00	2000-10-29 01:00:00-08	Europe/London	2000-10-20 02:00:00-07
10 days	2008-12-31 15:59:59.999999-08	UTC	2008-12-25 16:00:00-08
7 days	2010-05-02 19:02:19.003003-07	UTC	2010-05-02 17:00:00-07
10 days	2013-08-18 17:02:20.003003-07	Asia/Kolkata	2013-08-11 11:30:00-07
10 days	2014-07-14 21:02:21.003003-07	Asia/Kolkata	2014-07-07 11:30:00-07
2 months	2016-03-20 19:02:22.003003-07	UTC	2016-02-29 16:00:00-08
2 months	2018-01-31 09:02:23.003003-08	Australia/Sydney	2017-12-31 05:00:00-08
2 months	2019-09-30 04:02:24.003003-07	Australia/Sydney	2019-08-31 07:00:00-07
2 years	2020-03-19 08:02:25.003003-07	Asia/Yekaterinburg	2019-12-31 11:00:00-08
2 years	2022-07-20 06:02:26.003003-07	Asia/Yekaterinburg	2021-12-31 11:00:00-08
10 days	2024-08-11 12:02:26.003003-07	Asia/Tokyo	2024-08-03 08:00:00-07
10 days	2032-12-18 01:02:26.003003-08	Asia/Tokyo	2032-12-09 07:00:00-08
10 days	infinity	UTC	infinity

statement error
select time_bucket('-3 hours'::interval, '2019-04-05 00:00:00+03'::timestamptz);
----

statement error
select time_bucket('-3 hours'::interval, '2019-04-05 00:00:00+03'::timestamptz, '1 hour 30 minutes'::interval);
----

statement error
select time_bucket('-3 hours'::interval, '2019-04-05 00:00:00+03'::timestamptz, '2019-04-05 00:00:00+03'::timestamptz);
----

statement error
select time_bucket('-1 month'::interval, '2019-04-05 00:00:00-11'::timestamptz);
----

statement error
select time_bucket('-1 month'::interval, '2019-04-05 00:00:00-11'::timestamptz, '1 hour 30 minutes'::interval);
----

statement error
select time_bucket('-1 month'::interval, '2019-04-05 00:00:00-11'::timestamptz, '2018-04-05 00:00:00+11'::timestamptz);
----

statement error
select time_bucket('1 day - 172800 seconds'::interval, '2018-05-05 00:00:00+07'::timestamptz);
----

statement error
select time_bucket('1 day - 172800 seconds'::interval, '2018-05-05 00:00:00+07'::timestamptz, '1 hour 30 minutes'::interval);
----

statement error
select time_bucket('1 day - 172800 seconds'::interval, '2018-05-05 00:00:00+07'::timestamptz, '2018-05-05 00:00:00+07'::timestamptz);
----

statement error
select time_bucket('1 month 1 day'::interval, '2018-05-05 00:00:00+02'::timestamptz);
----

statement error
select time_bucket('1 month 1 day'::interval, '2018-05-05 00:00:00+02'::timestamptz, '1 hour 30 minutes'::interval);
----

statement error
select time_bucket('1 month 1 day'::interval, '2018-05-05 00:00:00+02'::timestamptz, '2018-05-05 00:00:00+02'::timestamptz);
----

statement error
select time_bucket('3 days'::interval, '2019-05-05 00:00:00+09'::timestamptz, '2000000000 months'::interval);
----

statement error
select time_bucket('3 days'::interval, '2019-05-05 00:00:00+09'::timestamptz, '-2000000000 months'::interval);
----

statement error
select time_bucket('3 months'::interval, '2019-05-05 00:00:00+00'::timestamptz, '2000000000 months'::interval);
----

statement error
select time_bucket('3 months'::interval, '2019-05-05 00:00:00+00'::timestamptz, '-2000000000 months'::interval);
----

statement error
select time_bucket('1 microseconds'::interval, '290279-12-24 (BC) 19:59:05.224191+00'::timestamptz);
----

query I
select time_bucket('1 microseconds'::interval, '290279-12-24 (BC) 19:59:05.224192+00'::timestamptz);
----
290279-12-24 (BC) 12:06:07.224192-07:52

statement error
select time_bucket('1 microseconds'::interval, '294247-01-10 04:00:54.775+00'::timestamptz);
----

statement error
SELECT TIME_BUCKET(CAST('0.' AS INTERVAL), CAST('2000-01-01 00:00:00+00' AS TIMESTAMPTZ));
----
Can't bucket using zero days

query I
select time_bucket('1 microseconds'::interval, '294247-01-10 04:00:54.774999+00'::timestamptz);
----
294247-01-09 20:00:54.774999-08

query II
with t2 as (select '2000-03-26 00:00:00'::timestamptz + (n::text || 'hours')::interval as ts from  generate_series(0, 72, 3) t1(n)) select ts, time_bucket('10 seconds'::interval, ts, 'Europe/London') from t2;
----
2000-03-26 00:00:00-08	2000-03-26 00:00:00-08
2000-03-26 03:00:00-08	2000-03-26 03:00:00-08
2000-03-26 06:00:00-08	2000-03-26 06:00:00-08
2000-03-26 09:00:00-08	2000-03-26 09:00:00-08
2000-03-26 12:00:00-08	2000-03-26 12:00:00-08
2000-03-26 15:00:00-08	2000-03-26 15:00:00-08
2000-03-26 18:00:00-08	2000-03-26 18:00:00-08
2000-03-26 21:00:00-08	2000-03-26 21:00:00-08
2000-03-27 00:00:00-08	2000-03-27 00:00:00-08
2000-03-27 03:00:00-08	2000-03-27 03:00:00-08
2000-03-27 06:00:00-08	2000-03-27 06:00:00-08
2000-03-27 09:00:00-08	2000-03-27 09:00:00-08
2000-03-27 12:00:00-08	2000-03-27 12:00:00-08
2000-03-27 15:00:00-08	2000-03-27 15:00:00-08
2000-03-27 18:00:00-08	2000-03-27 18:00:00-08
2000-03-27 21:00:00-08	2000-03-27 21:00:00-08
2000-03-28 00:00:00-08	2000-03-28 00:00:00-08
2000-03-28 03:00:00-08	2000-03-28 03:00:00-08
2000-03-28 06:00:00-08	2000-03-28 06:00:00-08
2000-03-28 09:00:00-08	2000-03-28 09:00:00-08
2000-03-28 12:00:00-08	2000-03-28 12:00:00-08
2000-03-28 15:00:00-08	2000-03-28 15:00:00-08
2000-03-28 18:00:00-08	2000-03-28 18:00:00-08
2000-03-28 21:00:00-08	2000-03-28 21:00:00-08
2000-03-29 00:00:00-08	2000-03-29 00:00:00-08

query II
with t2 as (select '2000-10-28 00:00:00'::timestamptz + (n::text || 'hours')::interval as ts from  generate_series(0, 72, 3) t1(n)) select ts, time_bucket('10 seconds'::interval, ts, 'Europe/London') from t2;
----
2000-10-28 00:00:00-07	2000-10-28 00:00:00-07
2000-10-28 03:00:00-07	2000-10-28 03:00:00-07
2000-10-28 06:00:00-07	2000-10-28 06:00:00-07
2000-10-28 09:00:00-07	2000-10-28 09:00:00-07
2000-10-28 12:00:00-07	2000-10-28 12:00:00-07
2000-10-28 15:00:00-07	2000-10-28 15:00:00-07
2000-10-28 18:00:00-07	2000-10-28 18:00:00-07
2000-10-28 21:00:00-07	2000-10-28 21:00:00-07
2000-10-29 00:00:00-07	2000-10-29 00:00:00-07
2000-10-29 02:00:00-08	2000-10-29 02:00:00-08
2000-10-29 05:00:00-08	2000-10-29 05:00:00-08
2000-10-29 08:00:00-08	2000-10-29 08:00:00-08
2000-10-29 11:00:00-08	2000-10-29 11:00:00-08
2000-10-29 14:00:00-08	2000-10-29 14:00:00-08
2000-10-29 17:00:00-08	2000-10-29 17:00:00-08
2000-10-29 20:00:00-08	2000-10-29 20:00:00-08
2000-10-29 23:00:00-08	2000-10-29 23:00:00-08
2000-10-30 02:00:00-08	2000-10-30 02:00:00-08
2000-10-30 05:00:00-08	2000-10-30 05:00:00-08
2000-10-30 08:00:00-08	2000-10-30 08:00:00-08
2000-10-30 11:00:00-08	2000-10-30 11:00:00-08
2000-10-30 14:00:00-08	2000-10-30 14:00:00-08
2000-10-30 17:00:00-08	2000-10-30 17:00:00-08
2000-10-30 20:00:00-08	2000-10-30 20:00:00-08
2000-10-30 23:00:00-08	2000-10-30 23:00:00-08

query I
select
  time_bucket(interval '1' day, timestamptz '2000-01-03 17:40:00+00', origin)
from
  generate_series(timestamptz '2000-01-03 00:00:00+00',
                  timestamptz '2000-01-04 00:00:00+00',
		  interval '1' hour) as t(origin)
order by
  origin
;
----
2000-01-02 16:00:00-08
2000-01-02 17:00:00-08
2000-01-02 18:00:00-08
2000-01-02 19:00:00-08
2000-01-02 20:00:00-08
2000-01-02 21:00:00-08
2000-01-02 22:00:00-08
2000-01-02 23:00:00-08
2000-01-03 00:00:00-08
2000-01-03 01:00:00-08
2000-01-03 02:00:00-08
2000-01-03 03:00:00-08
2000-01-03 04:00:00-08
2000-01-03 05:00:00-08
2000-01-03 06:00:00-08
2000-01-03 07:00:00-08
2000-01-03 08:00:00-08
2000-01-03 09:00:00-08
2000-01-02 10:00:00-08
2000-01-02 11:00:00-08
2000-01-02 12:00:00-08
2000-01-02 13:00:00-08
2000-01-02 14:00:00-08
2000-01-02 15:00:00-08
2000-01-02 16:00:00-08


statement ok
set TimeZone='UTC';

query I
select
  time_bucket(interval '1' day, timestamptz '2023-10-07 16:08:09+00', origin)
from
  generate_series(timestamptz '2001-01-03 00:00:00+00',
                  timestamptz '2001-01-04 00:00:00+00',
                  interval '1' hour) as t(origin)
order by origin
;
----
2023-10-07 00:00:00+00
2023-10-07 01:00:00+00
2023-10-07 02:00:00+00
2023-10-07 03:00:00+00
2023-10-07 04:00:00+00
2023-10-07 05:00:00+00
2023-10-07 06:00:00+00
2023-10-07 07:00:00+00
2023-10-07 08:00:00+00
2023-10-07 09:00:00+00
2023-10-07 10:00:00+00
2023-10-07 11:00:00+00
2023-10-07 12:00:00+00
2023-10-07 13:00:00+00
2023-10-07 14:00:00+00
2023-10-07 15:00:00+00
2023-10-07 16:00:00+00
2023-10-06 17:00:00+00
2023-10-06 18:00:00+00
2023-10-06 19:00:00+00
2023-10-06 20:00:00+00
2023-10-06 21:00:00+00
2023-10-06 22:00:00+00
2023-10-06 23:00:00+00
2023-10-07 00:00:00+00


statement ok
set TimeZone='America/St_Johns';

query I
select
  time_bucket(interval '1' day, timestamptz '2023-10-07 16:08:09+03', origin)
from
  generate_series(timestamptz '2001-01-03 00:00:00+05',
                  timestamptz '2001-01-04 00:00:00+05',
                  interval '1' hour) as t(origin)
order by origin
;
----
2023-10-06 16:30:00-02:30
2023-10-06 17:30:00-02:30
2023-10-06 18:30:00-02:30
2023-10-06 19:30:00-02:30
2023-10-06 20:30:00-02:30
2023-10-06 21:30:00-02:30
2023-10-06 22:30:00-02:30
2023-10-06 23:30:00-02:30
2023-10-07 00:30:00-02:30
2023-10-07 01:30:00-02:30
2023-10-07 02:30:00-02:30
2023-10-07 03:30:00-02:30
2023-10-07 04:30:00-02:30
2023-10-07 05:30:00-02:30
2023-10-07 06:30:00-02:30
2023-10-07 07:30:00-02:30
2023-10-07 08:30:00-02:30
2023-10-07 09:30:00-02:30
2023-10-07 10:30:00-02:30
2023-10-06 11:30:00-02:30
2023-10-06 12:30:00-02:30
2023-10-06 13:30:00-02:30
2023-10-06 14:30:00-02:30
2023-10-06 15:30:00-02:30
2023-10-06 16:30:00-02:30

query I
select
  bool_and(
    date_part('epoch', time_bucket(interval '3' day, timestamptz '2023-06-07 16:08:09+00', origin))
    = date_part('epoch', time_bucket(interval '3' day, timestamp   '2023-06-07 16:08:09', origin at time zone 'UTC'))
  )
from
  generate_series(timestamptz '2023-01-03 00:00:00+05',
                  timestamptz '2024-01-04 00:00:00+05',
                  interval '7877' minute) as t(origin)
;
----
true
