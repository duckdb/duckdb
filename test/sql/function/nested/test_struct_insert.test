# name: test/sql/function/nested/test_struct_insert.test
# description: Test the struct_insert function
# group: [nested]

statement ok
pragma enable_verification

# test basic insertion into a struct
query T
SELECT struct_insert ({a: 1, b: 2}, c := 3)
----
{'a': 1, 'b': 2, 'c': 3}

# insertion into a struct generated by a row of data
query T
WITH data AS (
    SELECT 1 as a, 2 as b, 3 as c
)
SELECT struct_insert (data, d := 4) FROM data
----
{'a': 1, 'b': 2, 'c': 3, 'd': 4}

# insertion of a nested struct into an existing struct
query T
select struct_insert({'a': 1, 'b': 'abc', 'c': true}, d := {'a': 'new stuff'})
----
{'a': 1, 'b': abc, 'c': true, 'd': {'a': new stuff}}

# test incorrect usage
statement error
select struct_insert()

statement error
select struct_insert({a: 1, b: 2})

statement error
select struct_insert(123, a := 1)

statement error
select struct_insert({a: 1, b: 2}, a := 2)
