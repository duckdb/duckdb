# name: test/sql/index/art/storage/test_art_interleaved_insert_delete_restart.test_slow
# description: Test interleaved inserts and deletes with restart to verify buffered replays are applied correctly
# group: [storage]

statement ok
SET memory_limit='1GB'

load __TEST_DIR__/test_art_interleaved_insert_delete_restart.db

statement ok
SET wal_autocheckpoint = '1TB';

statement ok
PRAGMA disable_checkpoint_on_shutdown;

statement ok
CREATE TABLE tbl (i INTEGER);

statement ok
CREATE UNIQUE INDEX idx_i ON tbl (i);

loop i 0 10000

statement ok
INSERT INTO tbl VALUES (${i});

statement ok
DELETE FROM tbl WHERE i = ${i};

endloop

restart

query II
EXPLAIN ANALYZE SELECT i FROM tbl WHERE i = 2;
----
analyzed_plan	<REGEX>:.*Type: Index Scan.*

query I
SELECT i FROM tbl WHERE i = 2;
----

