# name: test/sql/join/asof/test_asof_join_types.test
# description: Test As-Of join subtype (SEMI/ANTI/RIGHT/FULL)
# group: [asof]

statement ok
CREATE TABLE left_table (id INTEGER, ts TIMESTAMP, symbol VARCHAR, price DECIMAL);

statement ok
INSERT INTO left_table VALUES 
    (1, '2024-01-01 10:00:00', 'A', 150.00),
    (2, '2024-01-01 10:05:00', 'A', 151.00),
    (3, '2024-01-01 10:10:00', 'B', 380.00);

statement ok
CREATE TABLE right_table (id INTEGER, ts TIMESTAMP, symbol VARCHAR, bid DECIMAL, active BOOLEAN);

statement ok
INSERT INTO right_table VALUES 
    (1, '2024-01-01 09:59:00', 'A', 149.50, true),
    (2, '2024-01-01 10:04:00', 'A', 150.50, false),
    (3, '2024-01-01 10:09:00', 'B', 379.00, true);

query IIII
SELECT * 
FROM left_table l 
ASOF SEMI JOIN right_table r 
	 ON l.symbol = r.symbol 
	AND l.ts >= r.ts 
	AND l.price + r.bid > 300
ORDER BY ALL;
----
1	2024-01-01 10:00:00	A	150.000
2	2024-01-01 10:05:00	A	151.000
3	2024-01-01 10:10:00	B	380.000

query IIII
SELECT * 
FROM left_table l 
ASOF ANTI JOIN right_table r 
	 ON l.symbol = r.symbol 
	AND l.ts >= r.ts 
	AND l.price + r.bid > 300;
----

query IIIIIIIII
SELECT * 
FROM left_table l 
ASOF RIGHT JOIN right_table r 
	 ON l.symbol = r.symbol 
	AND l.ts >= r.ts 
	AND l.price + r.bid > 300
ORDER BY ALL;
----
2	2024-01-01 10:05:00	A	151.000	2	2024-01-01 10:04:00	A	150.500	false
3	2024-01-01 10:10:00	B	380.000	3	2024-01-01 10:09:00	B	379.000	true
NULL	NULL	NULL	NULL	1	2024-01-01 09:59:00	A	149.500	true

query IIIIIIIII
SELECT * 
FROM left_table l 
ASOF FULL JOIN right_table r 
	 ON l.symbol = r.symbol 
	AND l.ts >= r.ts 
	AND l.price + r.bid > 300
ORDER BY ALL;
----
1	2024-01-01 10:00:00	A	150.000	NULL	NULL	NULL	NULL	NULL
2	2024-01-01 10:05:00	A	151.000	2	2024-01-01 10:04:00	A	150.500	0
3	2024-01-01 10:10:00	B	380.000	3	2024-01-01 10:09:00	B	379.000	1
NULL	NULL	NULL	NULL	1	2024-01-01 09:59:00	A	149.500	1
