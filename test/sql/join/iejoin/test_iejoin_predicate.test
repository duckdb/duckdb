# name: test/sql/join/iejoin/test_iejoin_predicate.test
# description: Test IEJoin arbitrary predicate evaluation
# group: [iejoin]

statement ok
PRAGMA enable_verification

statement ok
PRAGMA explain_output = PHYSICAL_ONLY;

statement ok
SET merge_join_threshold=0

statement ok
create or replace table tleft as
	select 
		i as k100,
		'2024-01-01'::TIMESTAMP + INTERVAL (i) seconds as b100,
		b100 + INTERVAL 1 second as e100,
	from range(10) as tbl(i);


query II
select l.k100 as lid, r.k100 as rid
from tleft l 
inner join tleft r 
on l.b100 < r.e100
and r.b100 < l.e100
and l.k100 + r.k100 < 10
order by 1
----
0	0
1	1
2	2
3	3
4	4

query II
explain
select l.k100 as lid, r.k100 as rid
from tleft l 
left join tleft r 
on l.b100 < r.e100
and r.b100 < l.e100
and l.k100 + r.k100 < 10
order by 1
----
physical_plan	<REGEX>:.*IE_JOIN.*k100.*

query II
select l.k100 as lid, r.k100 as rid
from tleft l 
left join tleft r 
on l.b100 < r.e100
and r.b100 < l.e100
and l.k100 + r.k100 < 10
order by 1
----
0	0
1	1
2	2
3	3
4	4
5	NULL
6	NULL
7	NULL
8	NULL
9	NULL

query II
explain
select l.k100 as lid, r.k100 as rid
from tleft l 
right join tleft r 
on l.b100 < r.e100
and r.b100 < l.e100
and l.k100 + r.k100 < 10
order by 2
----
physical_plan	<REGEX>:.*IE_JOIN.*k100.*

query II
select l.k100 as lid, r.k100 as rid
from tleft l 
right join tleft r 
on l.b100 < r.e100
and r.b100 < l.e100
and l.k100 + r.k100 < 10
order by 2
----
0	0
1	1
2	2
3	3
4	4
NULL	5
NULL	6
NULL	7
NULL	8
NULL	9

query II
explain
select l.k100 as lid, r.k100 as rid
from tleft l 
full join tleft r 
on l.b100 < r.e100
and r.b100 < l.e100
and l.k100 + r.k100 < 10
order by all
----
physical_plan	<REGEX>:.*IE_JOIN.*k100.*

query II
select l.k100 as lid, r.k100 as rid
from tleft l 
full join tleft r 
on l.b100 < r.e100
and r.b100 < l.e100
and l.k100 + r.k100 < 10
order by all
----
0	0
1	1
2	2
3	3
4	4
5	NULL
6	NULL
7	NULL
8	NULL
9	NULL
NULL	5
NULL	6
NULL	7
NULL	8
NULL	9
