# name: test/sql/join/iejoin/test_iejoin_overlaps.test
# description: IEJoin block short circuiting
# group: [iejoin]

statement ok
PRAGMA enable_verification

statement ok
SET merge_join_threshold=0

statement ok
SET nested_loop_join_threshold=0;

statement ok
PRAGMA explain_output = PHYSICAL_ONLY;

# We read from CSVs to prevent the optimiser from
# using statistics to decide the join is a NOP
query II
EXPLAIN
SELECT t1.x, t2.x
FROM 'test/sql/join/iejoin/overlap.left.csv' t1, 'test/sql/join/iejoin/overlap.right.csv' t2
WHERE t1.x < t2.x AND t1.y > t2.y;
----
physical_plan	<REGEX>:.*IE_JOIN.*

query II
SELECT t1.x, t2.x
FROM 'test/sql/join/iejoin/overlap.left.csv' t1, 'test/sql/join/iejoin/overlap.right.csv' t2
WHERE t1.x < t2.x AND t1.y > t2.y;
----

# Reverse order to test op2 short circuit
query II
SELECT t1.x, t2.x
FROM 'test/sql/join/iejoin/overlap.left.csv' t1, 'test/sql/join/iejoin/overlap.right.csv' t2
WHERE t1.y > t2.y AND t1.x < t2.x;
----

query II
EXPLAIN
SELECT t1.x, t2.x
FROM 'test/sql/join/iejoin/overlap.left.csv' t1, 'test/sql/join/iejoin/overlap.right.csv' t2
WHERE t1.y > t2.y AND t1.x < t2.x;
----
physical_plan	<REGEX>:.*IE_JOIN.*
