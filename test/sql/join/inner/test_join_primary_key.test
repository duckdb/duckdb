# name: test/sql/join/inner/test_join_primary_key.test
# description: Test joins with primary keys
# group: [inner]

statement ok
CREATE TABLE integers(i INTEGER, j INTEGER)

# insert unique values
statement ok
INSERT INTO integers VALUES (1, 1), (2, 2), (3, 3), (4, 4)

statement ok
CREATE TABLE integers2(i INTEGER, j INTEGER)

# insert unique values
statement ok
INSERT INTO integers2 VALUES (1, 1), (2, 1), (3, 3), (4, 4)

statement ok
pragma enable_profiling;

query II
SELECT integers.i, integers.j FROM integers JOIN integers2 ON (integers.i = integers2.i);
----
1	1
2	2
3	3
4	4

# test with duplicate on column j
query II
SELECT integers2.i, integers2.j FROM integers JOIN integers2 ON (integers.j = integers2.j) ORDER BY integers2.i;
----
1	1
2	1
3	3
4	4

# test join with unique keys
query II
SELECT * FROM integers;
----
1	1
2	2
3	3
4	4

query II
SELECT * FROM integers2;
----
1	1
2	1
3	3
4	4

query II
SELECT integers.i, integers.j FROM integers JOIN integers2 ON (integers.i = integers2.i);
----
1	1
2	2
3	3
4	4

query II
SELECT integers2.i, integers2.j FROM integers JOIN integers2 ON (integers.i = integers2.i);
----
1	1
2	1
3	3
4	4

# test with duplicate on column j
query II
SELECT integers2.i, integers2.j FROM integers JOIN integers2 ON (integers.j = integers2.j) ORDER BY integers2.i;
----
1	1
2	1
3	3
4	4

# test with duplicate on column i
statement ok
INSERT INTO integers2 VALUES (4, 5)

query II
SELECT integers2.i, integers2.j FROM integers JOIN integers2 ON (integers.i = integers2.i) ORDER BY integers2.i;
----
1	1
2	1
3	3
4	4
4	5

# test right join with unique keys on i
statement ok
INSERT INTO integers2 VALUES (6, 7)

statement ok
DELETE FROM integers2 WHERE j = 5 

query II
SELECT integers2.i, integers2.j FROM integers RIGHT JOIN integers2 ON (integers.i = integers2.i) ORDER BY integers2.i;
----
1	1
2	1
3	3
4	4
6	7

# test multiple vectors


# test PRAGMA
statement ok
PRAGMA disable_unique_join;

query II
SELECT integers.i, integers.j FROM integers JOIN integers2 ON (integers.i = integers2.i);
----
1	1
2	2
3	3
4	4