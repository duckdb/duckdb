# name: test/sql/join/inner/test_join_primary_key.test
# description: Test joins with primary keys
# group: [inner]

#statement ok
#PRAGMA enable_verification;
#
#statement ok
#CREATE TABLE test1 (a INTEGER, b INTEGER);
#
#statement ok
#INSERT INTO test1 VALUES (11, 1), (12, 2), (13, 3), (13, 2)
#
#statement ok
#CREATE TABLE test2 (b INTEGER, c INTEGER);
#
#statement ok
#INSERT INTO test2 VALUES (1, 10), (2, 20), (3, 30), (1, 10), (2, 20), (3, 30), (1, 10), (2, 20), (3, 30), (1, 10), (2, 20), (3, 30), (1, 10), (2, 20), (3, 30)
#
#mode output_hash
#
#statement ok
#PRAGMA enable_profiling;
#
## simple inner join
#query III
#SELECT a, test1.b, c FROM test1, test2 WHERE test1.b = test2.b ORDER BY c;
#----
#11	1	10
#11	1	10
#11	1	10
#11	1	10
#11	1	10
#12	2	20
#12	2	20
#12	2	20
#12	2	20
#12	2	20
#13	3	30
#13	3	30
#13	3	30
#13	3	30
#13	3	30
#
#statement ok
#PRAGMA disable_profiling
##
#loop i 0 90
##
#statement ok
#INSERT INTO test12 SELECT * FROM test11;
##
#endloop
##
#mode output_hash
##
#statement ok
#PRAGMA enable_profiling;
##
#query I
#select test12.range, test11.range from test11,test12 where test11.range=test12.range order by test11.range;
#
#statement ok
#PRAGMA disable_profiling
#
#
#
## insert the first entry (randomly ordered)
#statement ok
#INSERT INTO test1 VALUES (14, 1)
#
#query III
#SELECT a, test1.b, c FROM test1, test2 WHERE test1.b = test2.b ORDER BY c;
#----
#11
#
## join with probe outside build range
#statement ok
#INSERT INTO test2 VALUES (4, 10)
##
#query III
#SELECT a, test1.b, c FROM test1, test2 WHERE test1.b = test2.b ORDER BY c;
#----
#11	1	10
#14	1	10
#11	1	10
#14	1	10
#11	1	10
#14	1	10
#11	1	10
#14	1	10
#11	1	10
#14	1	10
#12	2	20
#12	2	20
#12	2	20
#12	2	20
#12	2	20
#13	3	30
#13	3	30
#13	3	30
#13	3	30
#13	3	30
#
#
## join with nulls
#INSERT INTO test2 VALUES (4, 10)
#query VI
#SELECT a, test1.b, c FROM test1, test2 WHERE test1.b = test2.b ORDER BY c;
#----
#11	1	10
#11	1	10
#11	1	10
#11	1	10
#11	1	10
#12	2	20
#12	2	20
#12	2	20
#12	2	20
#12	2	20
#13	3	30
#13	3	30
#13	3	30
#13	3	30
#13	3	30
#