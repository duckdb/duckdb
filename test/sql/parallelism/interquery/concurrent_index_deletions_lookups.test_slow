# name: test/sql/parallelism/interquery/concurrent_index_deletions_lookups.test_slow
# description: Concurrent index deletions and look-ups
# group: [interquery]

statement ok
ATTACH '__TEST_DIR__/concurrent_checkpoint_delete.db' AS db

statement ok
CREATE TABLE db.integers(i INTEGER PRIMARY KEY);

loop x 0 2

statement ok
INSERT INTO db.integers FROM range(1_000);

loop threadid 0 10

statement ok
BEGIN

loop k 0 10

onlyif threadid<>0
query I
SELECT CASE WHEN COUNT(*) <= 1 THEN NULL ELSE COUNT(*) END FROM db.integers WHERE i=${threadid} + ${k}
----
NULL

endloop

onlyif threadid=0
statement ok
DELETE FROM db.integers

statement ok
COMMIT

endloop

query I
FROM db.integers
----

endloop
