# name: test/sql/generated_columns/virtual/create_table.test
# description: Add a generated column on creation of a table
# group: [virtual]

# Function doesnt exist, neither does the referenced column
#statement error
#CREATE TABLE unit (
#	total_profit BOOLEAN GENERATED ALWAYS AS(non_existant_function() * price) VIRTUAL,
#);

# Return type and type of the generated column dont match
#statement error
#CREATE TABLE unit (
#    total_profit BOOLEAN GENERATED ALWAYS AS(word) VIRTUAL,
#    word VARCHAR,
#    price INTEGER,
#    amount_sold INTEGER,
#);

## Expression contains a subquery
#statement error
#CREATE TABLE unit (
#    total_profit BOOLEAN GENERATED ALWAYS AS((SELECT 1)) VIRTUAL,
#    word VARCHAR,
#    price INTEGER,
#    amount_sold INTEGER,
#);

statement ok
CREATE TABLE unit (
    total_profit INTEGER GENERATED ALWAYS AS(price * amount_sold) VIRTUAL,
    price INTEGER,
    amount_sold INTEGER,
);

statement ok
INSERT INTO unit VALUES (5,4)

query I
SELECT * FROM unit;
----
20

# Delete the generated column
statement ok
ALTER TABLE unit DROP COLUMN total_profit;

# We can now no longer select it
statement error
SELECT total_profit FROM unit;
