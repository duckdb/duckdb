# name: test/sql/upsert/concurrent_insert_or_replace.test
# group: [upsert]

statement ok
CREATE SCHEMA IF NOT EXISTS schema__test

concurrentloop threadid 0 3

statement ok
CREATE TABLE IF NOT EXISTS schema__test.test_table${threadid} (
	id VARCHAR PRIMARY KEY,
	available_actions VARCHAR[],
	subscriber_ids VARCHAR[]
)

loop i 0 5

statement ok
INSERT OR REPLACE INTO schema__test.test_table${threadid}
VALUES ('test:scope/test-worker-${threadid}:test-id-0', ['read', 'write', 'delete'], ['sub-{threadid}', 'sub-{threadid}+${i}'])

query I
SELECT subscriber_ids=['sub-{threadid}', 'sub-{threadid}+${i}'] FROM schema__test.test_table${threadid} WHERE id='test:scope/test-worker-${threadid}:test-id-0'
----
true

endloop

endloop
