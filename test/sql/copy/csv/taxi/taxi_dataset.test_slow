# name: test/sql/copy/csv/taxi/taxi_dataset.test_slow
# description: Verify that we can run with the taxi dataset
# group: [taxi]

# This test is too slow for CI
mode skip

require httpfs

foreach file trips_aa.csv.gz trips_ai.csv.gz trips_aq.csv.gz trips_ay.csv.gz trips_bg.csv.gz trips_bo.csv.gz trips_bw.csv.gz trips_ce.csv.gz trips_cm.csv.gz trips_cu.csv.gz trips_dc.csv.gz trips_dk.csv.gz trips_ab.csv.gz trips_aj.csv.gz trips_ar.csv.gz trips_az.csv.gz trips_bh.csv.gz trips_bp.csv.gz trips_bx.csv.gz trips_cf.csv.gz trips_cn.csv.gz trips_cv.csv.gz trips_dd.csv.gz trips_dl.csv.gz trips_ac.csv.gz trips_ak.csv.gz trips_as.csv.gz trips_ba.csv.gz trips_bi.csv.gz trips_bq.csv.gz trips_by.csv.gz trips_cg.csv.gz trips_co.csv.gz trips_cw.csv.gz trips_de.csv.gz trips_dm.csv.gz trips_ad.csv.gz trips_al.csv.gz trips_at.csv.gz trips_bb.csv.gz trips_bj.csv.gz trips_br.csv.gz trips_bz.csv.gz trips_ch.csv.gz trips_cp.csv.gz trips_cx.csv.gz trips_df.csv.gz  trips_ae.csv.gz trips_am.csv.gz trips_au.csv.gz trips_bc.csv.gz trips_bk.csv.gz trips_bs.csv.gz trips_ca.csv.gz trips_ci.csv.gz trips_cq.csv.gz trips_cy.csv.gz trips_dg.csv.gz trips_af.csv.gz trips_an.csv.gz trips_av.csv.gz trips_bd.csv.gz trips_bl.csv.gz trips_bt.csv.gz trips_cb.csv.gz trips_cj.csv.gz trips_cr.csv.gz trips_cz.csv.gz trips_dh.csv.gz trips_ag.csv.gz trips_ao.csv.gz trips_aw.csv.gz trips_be.csv.gz trips_bm.csv.gz trips_bu.csv.gz trips_cc.csv.gz trips_ck.csv.gz trips_cs.csv.gz trips_da.csv.gz trips_di.csv.gz trips_ah.csv.gz trips_ap.csv.gz trips_ax.csv.gz trips_bf.csv.gz trips_bn.csv.gz trips_bv.csv.gz trips_cd.csv.gz trips_cl.csv.gz trips_ct.csv.gz trips_db.csv.gz trips_dj.csv.gz

statement ok
CREATE TABLE trips (
    trip_id                 BIGINT,
    vendor_id               VARCHAR,
    pickup_datetime         TIMESTAMP,
    dropoff_datetime        TIMESTAMP,
    store_and_fwd_flag      VARCHAR,
    rate_code_id            BIGINT,
    pickup_longitude        DOUBLE,
    pickup_latitude         DOUBLE,
    dropoff_longitude       DOUBLE,
    dropoff_latitude        DOUBLE,
    passenger_count         BIGINT,
    trip_distance           DOUBLE,
    fare_amount             DOUBLE,
    extra                   DOUBLE,
    mta_tax                 DOUBLE,
    tip_amount              DOUBLE,
    tolls_amount            DOUBLE,
    ehail_fee               DOUBLE,
    improvement_surcharge   DOUBLE,
    total_amount            DOUBLE,
    payment_type            VARCHAR,
    trip_type               VARCHAR,
    pickup                  VARCHAR,
    dropoff                 VARCHAR,
    cab_type                VARCHAR,
    precipitation           BIGINT,
    snow_depth              BIGINT,
    snowfall                BIGINT,
    max_temperature         BIGINT,
    min_temperature         BIGINT,
    average_wind_speed      BIGINT,
    pickup_nyct2010_gid     BIGINT,
    pickup_ctlabel          VARCHAR,
    pickup_borocode         BIGINT,
    pickup_boroname         VARCHAR,
    pickup_ct2010           VARCHAR,
    pickup_boroct2010       BIGINT,
    pickup_cdeligibil       VARCHAR,
    pickup_ntacode          VARCHAR,
    pickup_ntaname          VARCHAR,
    pickup_puma             VARCHAR,
    dropoff_nyct2010_gid    BIGINT,
    dropoff_ctlabel         VARCHAR,
    dropoff_borocode        BIGINT,
    dropoff_boroname        VARCHAR,
    dropoff_ct2010          VARCHAR,
    dropoff_boroct2010      VARCHAR,
    dropoff_cdeligibil      VARCHAR,
    dropoff_ntacode         VARCHAR,
    dropoff_ntaname         VARCHAR,
    dropoff_puma            VARCHAR);

statement ok
INSERT INTO trips FROM read_csv('https://blobs.duckdb.org/data/nyc-taxi-dataset/${file}');

query I
SELECT count(*) from trips
----
20000000

statement ok
drop table trips

endloop

# Last file has a different number of values
statement ok
CREATE TABLE trips (
    trip_id                 BIGINT,
    vendor_id               VARCHAR,
    pickup_datetime         TIMESTAMP,
    dropoff_datetime        TIMESTAMP,
    store_and_fwd_flag      VARCHAR,
    rate_code_id            BIGINT,
    pickup_longitude        DOUBLE,
    pickup_latitude         DOUBLE,
    dropoff_longitude       DOUBLE,
    dropoff_latitude        DOUBLE,
    passenger_count         BIGINT,
    trip_distance           DOUBLE,
    fare_amount             DOUBLE,
    extra                   DOUBLE,
    mta_tax                 DOUBLE,
    tip_amount              DOUBLE,
    tolls_amount            DOUBLE,
    ehail_fee               DOUBLE,
    improvement_surcharge   DOUBLE,
    total_amount            DOUBLE,
    payment_type            VARCHAR,
    trip_type               VARCHAR,
    pickup                  VARCHAR,
    dropoff                 VARCHAR,
    cab_type                VARCHAR,
    precipitation           BIGINT,
    snow_depth              BIGINT,
    snowfall                BIGINT,
    max_temperature         BIGINT,
    min_temperature         BIGINT,
    average_wind_speed      BIGINT,
    pickup_nyct2010_gid     BIGINT,
    pickup_ctlabel          VARCHAR,
    pickup_borocode         BIGINT,
    pickup_boroname         VARCHAR,
    pickup_ct2010           VARCHAR,
    pickup_boroct2010       BIGINT,
    pickup_cdeligibil       VARCHAR,
    pickup_ntacode          VARCHAR,
    pickup_ntaname          VARCHAR,
    pickup_puma             VARCHAR,
    dropoff_nyct2010_gid    BIGINT,
    dropoff_ctlabel         VARCHAR,
    dropoff_borocode        BIGINT,
    dropoff_boroname        VARCHAR,
    dropoff_ct2010          VARCHAR,
    dropoff_boroct2010      VARCHAR,
    dropoff_cdeligibil      VARCHAR,
    dropoff_ntacode         VARCHAR,
    dropoff_ntaname         VARCHAR,
    dropoff_puma            VARCHAR);

statement ok
INSERT INTO trips FROM read_csv('https://blobs.duckdb.org/data/nyc-taxi-dataset/trips_dn.csv.gz');

query I
SELECT count(*) from trips
----
2913965

statement ok
drop table trips
