# name: test/sql/copy/csv/test_infinite_loop_escape.test
# description: Test that CSV writer does not loop infinitely when ESCAPE is empty
# group: [csv]

statement ok
PRAGMA enable_verification

# Create a table with a value that needs escaping (a quote)
statement ok
CREATE TABLE trigger_loop (a VARCHAR);

statement ok
INSERT INTO trigger_loop VALUES ('"');

# This command used to trigger an infinite loop because it found the quote
# but added an empty escape character, finding the same quote again forever.
statement ok
COPY trigger_loop TO '__TEST_DIR__/infinite_loop_fix.csv' (FORMAT CSV, QUOTE '"', ESCAPE '');