# name: test/sql/copy/parquet/parquet_write_codecs.test
# description: Parquet write with various codecs
# group: [parquet]

require parquet


foreach codec UNCOMPRESSED SNAPPY GZIP ZSTD LZ4 LZ4_RAW BROTLI

# codec uncompressed
statement ok
COPY (SELECT 42, 'hello') TO '{TEMP_DIR}/${codec}.parquet' (FORMAT 'parquet', CODEC '${codec}');

query II
SELECT * FROM parquet_scan('{TEMP_DIR}/${codec}.parquet');
----
42	hello

statement ok
COPY (FROM "{DATA_DIR}/parquet-testing/userdata1.parquet") TO '{TEMP_DIR}/userdata-${codec}.parquet' (FORMAT 'parquet', CODEC '${codec}', ROW_GROUP_SIZE 10);

statement ok
FROM "{TEMP_DIR}/userdata-${codec}.parquet";

endloop


# unsupported codec
statement error
COPY (SELECT 42, 'hello') TO '{TEMP_DIR}/gzip.parquet' (FORMAT 'parquet', CODEC 'BLABLABLA');
----
<REGEX>:.*Binder Error: Expected codec argument.*

# empty codec
statement error
COPY (SELECT 42, 'hello') TO '{TEMP_DIR}/gzip.parquet' (FORMAT 'parquet', CODEC);
----
<REGEX>:.*Invalid Input Error.*requires an argument.*

# integer codec
statement error
COPY (SELECT 42, 'hello') TO '{TEMP_DIR}/gzip.parquet' (FORMAT 'parquet', CODEC 3);
----
<REGEX>:.*Invalid Input Error.*could not be cast as this type.*