# name: test/sql/copy/parquet/writer/writer_round_trip.test_slow
# description: Parquet read and re-write various files
# group: [writer]

require parquet

foreach parquet_file parquet-testing/manyrowgroups.parquet parquet-testing/map.parquet parquet-testing/arrow/int32_decimal.parquet parquet-testing/arrow/nonnullable.impala.parquet parquet-testing/bug687_nulls.parquet parquet-testing/bug1554.parquet parquet-testing/apkwan.parquet parquet-testing/arrow/nested_lists.snappy.parquet parquet-testing/arrow/nulls.snappy.parquet parquet-testing/nan-float.parquet parquet-testing/manyrowgroups2.parquet parquet-testing/struct.parquet parquet-testing/arrow/list_columns.parquet parquet-testing/timestamp-ms.parquet parquet-testing/arrow/alltypes_dictionary.parquet parquet-testing/arrow/binary.parquet parquet-testing/arrow/nation.dict-malformed.parquet parquet-testing/lineitem-top10000.gzip.parquet parquet-testing/arrow/nested_maps.snappy.parquet parquet-testing/arrow/dict-page-offset-zero.parquet parquet-testing/silly-names.parquet parquet-testing/zstd.parquet parquet-testing/bug1618_struct_strings.parquet parquet-testing/arrow/single_nan.parquet parquet-testing/arrow/int64_decimal.parquet parquet-testing/filter_bug1391.parquet parquet-testing/arrow/fixed_length_decimal_legacy.parquet parquet-testing/timestamp.parquet parquet-testing/arrow/fixed_length_decimal.parquet parquet-testing/leftdate3_192_loop_1.parquet parquet-testing/blob.parquet parquet-testing/bug1588.parquet parquet-testing/bug1589.parquet parquet-testing/arrow/alltypes_plain.parquet parquet-testing/arrow/repeated_no_annotation.parquet parquet-testing/data-types.parquet parquet-testing/unsigned.parquet parquet-testing/pandas-date.parquet parquet-testing/date.parquet parquet-testing/arrow/nullable.impala.parquet parquet-testing/fixed.parquet parquet-testing/arrow/alltypes_plain.snappy.parquet parquet-testing/decimal/int32_decimal.parquet parquet-testing/decimal/pandas_decimal.parquet parquet-testing/decimal/decimal_dc.parquet parquet-testing/decimal/int64_decimal.parquet parquet-testing/decimal/fixed_length_decimal_legacy.parquet parquet-testing/decimal/fixed_length_decimal.parquet parquet-testing/glob2/t1.parquet parquet-testing/cache/cache1.parquet parquet-testing/cache/cache2.parquet parquet-testing/glob/t2.parquet parquet-testing/glob/t1.parquet parquet-testing/bug2557.parquet

statement ok
CREATE TABLE parquet_read AS SELECT * FROM parquet_scan('{DATA_DIR}/${parquet_file}');

statement ok
COPY parquet_read TO '{TEMP_DIR}/test_round_trip.parquet'

statement ok
CREATE TABLE parquet_write AS SELECT * FROM parquet_scan('{TEMP_DIR}/test_round_trip.parquet');

# verify that the count is the same
query I
SELECT COUNT(*) FROM parquet_read EXCEPT SELECT COUNT(*) FROM parquet_write
----

# verify that the data is the same
query I
SELECT COUNT(*) FROM (SELECT * FROM parquet_read EXCEPT SELECT * FROM parquet_write)
----
0

statement ok
DROP TABLE parquet_read

statement ok
DROP TABLE parquet_write

endloop
