# name: test/sql/settings/block_allocator_size.test
# description: Test block_allocator_size setting
# group: [settings]

# defaults to 0, resetting to 0 is ok
statement ok
RESET block_allocator_size;

statement ok
SET block_allocator_size='100MiB';

# can also be set as a percentage of the memory limit
statement ok
SET memory_limit='200MiB';

statement error
SET block_allocator_size='-3%';
----
Unable to parse valid percentage

statement error
SET block_allocator_size='150%';
----
Unable to parse valid percentage

statement ok
SET block_allocator_size='75%';

query I
SELECT value FROM duckdb_settings() WHERE name = 'block_allocator_size';
----
150.0 MiB

# cannot be reduced
statement error
RESET block_allocator_size;
----
cannot be reduced

statement error
SET block_allocator_size='50MiB';
----
cannot be reduced

# can be increased
statement ok
SET block_allocator_size='200MiB';

# cannot be greater than VM size
statement error
SET block_allocator_size='200TiB';
----
cannot be greater than the virtual memory size
