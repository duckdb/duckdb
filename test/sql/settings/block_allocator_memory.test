# name: test/sql/settings/block_allocator_memory.test
# description: Test block_allocator_memory setting
# group: [settings]

# defaults to 0, resetting to 0 is ok
statement ok
RESET block_allocator_memory;

statement ok
SET block_allocator_memory='100MiB';

# can also be set as a percentage of the memory limit
statement ok
SET memory_limit='200MiB';

statement error
SET block_allocator_memory='-3%';
----
Unable to parse valid percentage

statement error
SET block_allocator_memory='150%';
----
Unable to parse valid percentage

statement ok
SET block_allocator_memory='75%';

query I
SELECT value FROM duckdb_settings() WHERE name = 'block_allocator_memory';
----
150.0 MiB

require 64bit

# cannot be reduced
statement error
RESET block_allocator_memory;
----
cannot be reduced

statement error
SET block_allocator_memory='50MiB';
----
cannot be reduced

# can be increased
statement ok
SET block_allocator_memory='200MiB';

# cannot be greater than VM size
statement error
SET block_allocator_memory='200TiB';
----
cannot be greater than the virtual memory size
