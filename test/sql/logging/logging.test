# name: test/sql/logging/logging.test
# description: Test logging functionality
# group: [logging]

require noforcestorage

query IIIIIIII
from duckdb_logs
----

statement ok
set logging_level='debug';

statement ok
set enable_logging=true;

statement ok
SELECT 1;

query IIIII
SELECT * EXCLUDE (timestamp, client_context, transaction_id) FROM duckdb_logs
----
duckdb.ClientContext.BeginQuery	INFO	SELECT 1;	CONNECTION	NULL

statement ok
set enable_logging=false;

# With logging disabled, the log will persist
query IIIII
SELECT * EXCLUDE (timestamp, client_context, transaction_id) FROM duckdb_logs
----
duckdb.ClientContext.BeginQuery	INFO	SELECT 1;	CONNECTION	NULL
duckdb.ClientContext.BeginQuery	INFO	SELECT * EXCLUDE (timestamp, client_context, transaction_id) FROM duckdb_logs	CONNECTION	NULL
duckdb.ClientContext.BeginQuery	INFO	set enable_logging=false;	CONNECTION	NULL

statement ok
set logging_storage='stdout';

statement ok
set logging_storage='memory';

# Storage is now cleared because switching storage will clear it
query IIIII
SELECT * EXCLUDE (timestamp, client_context, transaction_id) FROM duckdb_logs
----
