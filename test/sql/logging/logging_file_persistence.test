# name: test/sql/logging/logging_file_persistence.test
# description: Test file backed log storage persistence
# group: [logging]

# Due to different file locking behaviour, this currently fails on windows
require notwindows

# load the DB from disk
load __TEST_DIR__/logging_file_persistence.test

# Enable FileSystem logging to single csv file  
statement ok
CALL enable_logging('FileSystem', storage='file', storage_config={'path': '__TEST_DIR__/logging_file_persistence.csv'});

# Read some data to trigger FileSystem log
statement ok
FROM "data/csv/big_number.csv"

statement ok
CALL disable_logging();

query IIIIIIIII nosort log_output
FROM duckdb_logs;
----

restart

# TODO: configuring log storage config is clunky now
statement ok
CALL enable_logging('FileSystem', storage='file', storage_config={'path': '__TEST_DIR__/logging_file_persistence.csv'});

statement ok
CALL disable_logging();

query IIIIIIIII nosort log_output
FROM duckdb_logs;
----
