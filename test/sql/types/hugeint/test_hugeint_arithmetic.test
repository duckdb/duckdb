# name: test/sql/types/hugeint/test_hugeint_arithmetic.test
# description: Test arithmetic with huge integers
# group: [hugeint]

statement ok
PRAGMA enable_verification

# negation
query II
SELECT -(100::HUGEINT), -(-(50::HUGEINT));
----
-100	50

# negate 0
query I
SELECT -(0::HUGEINT)
----
0

# negation with large numbers
query II
SELECT -(100000000000000000000::HUGEINT), -(-(100000000000000000000::HUGEINT));
----
-100000000000000000000	100000000000000000000

# addition
# simple addition: small values
query I
SELECT 42::HUGEINT + 42::HUGEINT;
----
84

# negative values
query III
SELECT 42::HUGEINT + -42::HUGEINT, -42::HUGEINT + 100::HUGEINT, -42::HUGEINT+-42::HUGEINT;
----
0	58	-84

# large values
query I
SELECT '100000000000000000000'::HUGEINT + '100000000000000000000'::HUGEINT;
----
200000000000000000000

# large negative values
query I
SELECT '100000000000000000000'::HUGEINT + '-1000000000000000000000'::HUGEINT;
----
-900000000000000000000

query I
SELECT '5'::HUGEINT + '-10000000000000000002'::HUGEINT;
----
-9999999999999999997

# overflow in addition
statement error
SELECT '170141183460469231731687303715884105727'::HUGEINT + '170141183460469231731687303715884105727'::HUGEINT;
----
Out of Range Error: Overflow in addition of INT128 (170141183460469231731687303715884105727 + 170141183460469231731687303715884105727)!

statement error
SELECT '170141183460469231731687303715884105727'::HUGEINT + '10'::HUGEINT;
----
Out of Range Error: Overflow in addition of INT128 (170141183460469231731687303715884105727 + 10)!

# almost overflowing but not quite
query I
SELECT '170141183460469231731687303715884105727'::HUGEINT - 10::HUGEINT + 10::HUGEINT
----
170141183460469231731687303715884105727

query I
SELECT '-170141183460469231731687303715884105728'::HUGEINT + 10::HUGEINT - 10::HUGEINT
----
-170141183460469231731687303715884105728

# overflowing
statement error
SELECT '170141183460469231731687303715884105727'::HUGEINT - 10::HUGEINT + 11::HUGEINT
----
Out of Range Error: Overflow in addition of INT128 (170141183460469231731687303715884105717 + 11)!

statement error
SELECT '-170141183460469231731687303715884105728'::HUGEINT + 10::HUGEINT - 11::HUGEINT
----
Out of Range Error: Overflow in subtraction of INT128 (-170141183460469231731687303715884105718 - 11)!

# subtraction
query II
SELECT 100::HUGEINT - 42::HUGEINT, 3::HUGEINT - 5::HUGEINT;
----
58	-2

# negative combinations
query III
SELECT -100::HUGEINT - 42::HUGEINT, -3::HUGEINT - 5::HUGEINT, 12::HUGEINT-(-12::HUGEINT);
----
-142	-8	24

# large subtraction
query I
SELECT '-10000000000000000002'::HUGEINT - '-10000000000000000002'::HUGEINT;
----
0

# underflow in subtraction
statement error
SELECT '-170141183460469231731687303715884105728'::HUGEINT - '170141183460469231731687303715884105727'::HUGEINT;
----
Out of Range Error: Overflow in subtraction of INT128 (-170141183460469231731687303715884105728 - 170141183460469231731687303715884105727)!

statement error
SELECT '170141183460469231731687303715884105727'::HUGEINT - '-170141183460469231731687303715884105728'::HUGEINT;
----
Out of Range Error: Overflow in subtraction of INT128 (170141183460469231731687303715884105727 - -170141183460469231731687303715884105728)!

# multiplication
query I
SELECT 100::HUGEINT * 50::HUGEINT;
----
5000

# negative multiplication
query III
SELECT 100::HUGEINT * -50::HUGEINT, -100::HUGEINT * 50::HUGEINT, -100::HUGEINT * -50::HUGEINT;
----
-5000	-5000	5000

# multiplying large numbers
query II
SELECT '1701411834604692317'::HUGEINT * '2'::HUGEINT, '100000000000000000000'::HUGEINT * '1000000000000000000'::HUGEINT
----
3402823669209384634	100000000000000000000000000000000000000

query I
SELECT '170141183460469231731687303715884105727'::HUGEINT * 1::HUGEINT
----
170141183460469231731687303715884105727

# overflow in multiplication
statement error
SELECT '170141183460469231731687303715884105727'::HUGEINT * 2::HUGEINT
----
Out of Range Error: Overflow in multiplication of INT128 (170141183460469231731687303715884105727 * 2)!

statement error
SELECT '1701411834604692317'::HUGEINT * '131687303715884105727'::HUGEINT
----
Out of Range Error: Overflow in multiplication of INT128 (1701411834604692317 * 131687303715884105727)!

# division
query II
SELECT 100::HUGEINT // 20::HUGEINT, 90::HUGEINT // 20::HUGEINT
----
5	4

# negative values
query III
SELECT -100::HUGEINT // 20::HUGEINT, 100::HUGEINT // -20::HUGEINT, -100::HUGEINT // -20::HUGEINT
----
-5	-5	5

# division by zero
query I
SELECT 100::HUGEINT // 0::HUGEINT
----
NULL

# large values
query II
SELECT '100000000000000000000000000000000000000'::HUGEINT // '10000000000000'::HUGEINT, '100000000000000000000000000000000000000'::HUGEINT // '2'::HUGEINT
----
10000000000000000000000000	50000000000000000000000000000000000000

# modulo
query II
SELECT 100::HUGEINT % 20::HUGEINT, 90::HUGEINT % 20::HUGEINT
----
0	10

# negative values
query III
SELECT -90 % 20, 90 % -20, -90 % -20
----
-10	10	-10

query III
SELECT -90::HUGEINT % 20::HUGEINT, 90::HUGEINT % -20::HUGEINT, -90::HUGEINT % -20::HUGEINT
----
-10	10	-10

# modulo by zero
query I
SELECT 100::HUGEINT % 0::HUGEINT
----
NULL

# large values
query II
SELECT '100000000000000000000000000000000000000'::HUGEINT % '6587689457689375689735'::HUGEINT, '100000000000000000000000000000000000000'::HUGEINT % '3'::HUGEINT
----
5396771390320972230850	1

# abs
query II
SELECT ABS('100'::HUGEINT), ABS('-100'::HUGEINT);;
----
100	100

# addition
query I
SELECT '-170141183460469231731687303715884105727'::HUGEINT + -1;
----
-170141183460469231731687303715884105728

query I
SELECT '170141183460469231731687303715884105726'::HUGEINT + 1;
----
170141183460469231731687303715884105727

statement error
SELECT -170141183460469231731687303715884105728 + -1;
----
Out of Range Error: Overflow in addition of INT128 (-170141183460469231731687303715884105728 + -1)!


statement error
SELECT 170141183460469231731687303715884105727 + 1;
----
Out of Range Error: Overflow in addition of INT128 (170141183460469231731687303715884105727 + 1)!

# the other way around (i.e. move away from the overflow direction)
query I
SELECT '170141183460469231731687303715884105727'::HUGEINT + -1;
----
170141183460469231731687303715884105726

query I
SELECT '-170141183460469231731687303715884105728'::HUGEINT + 1;
----
-170141183460469231731687303715884105727

# now the reverse: right side is big
query I
SELECT -1 + '-170141183460469231731687303715884105727'::HUGEINT;
----
-170141183460469231731687303715884105728

query I
SELECT 1 + '170141183460469231731687303715884105726'::HUGEINT;
----
170141183460469231731687303715884105727

statement error
SELECT -1 + -170141183460469231731687303715884105728;
----
Out of Range Error: Overflow in addition of INT128 (-1 + -170141183460469231731687303715884105728)!

statement error
SELECT 1 + 170141183460469231731687303715884105727;
----
Out of Range Error: Overflow in addition of INT128 (1 + 170141183460469231731687303715884105727)!

# the other way around (i.e. move away from the overflow direction)
query I
SELECT -1 + '170141183460469231731687303715884105727'::HUGEINT;
----
170141183460469231731687303715884105726

query I
SELECT 1 + '-170141183460469231731687303715884105728'::HUGEINT;
----
-170141183460469231731687303715884105727

# subtraction
query I
SELECT '-170141183460469231731687303715884105727'::HUGEINT - 1;
----
-170141183460469231731687303715884105728

statement error
SELECT -170141183460469231731687303715884105728 - 1;
----
Out of Range Error: Overflow in subtraction of INT128 (-170141183460469231731687303715884105728 - 1)!

query I
SELECT 170141183460469231731687303715884105724 - (-1);
----
170141183460469231731687303715884105725

query I
SELECT 170141183460469231731687303715884105725 - (-1);
----
170141183460469231731687303715884105726

query I
SELECT 170141183460469231731687303715884105726 - (-1);
----
170141183460469231731687303715884105727

statement error
SELECT 170141183460469231731687303715884105727 - (-1);
----
Out of Range Error: Overflow in subtraction of INT128 (170141183460469231731687303715884105727 - -1)!

# the other way around (i.e. move away from the overflow direction)
query I
SELECT 170141183460469231731687303715884105727 - 1;
----
170141183460469231731687303715884105726

query I
SELECT -170141183460469231731687303715884105728 - (-1);
----
-170141183460469231731687303715884105727

# now the reverse: right side is big
query I
SELECT -1 - 170141183460469231731687303715884105727;
----
-170141183460469231731687303715884105728

statement error
SELECT -2 - 170141183460469231731687303715884105727;
----
Out of Range Error: Overflow in subtraction of INT128 (-2 - 170141183460469231731687303715884105727)!

query I
SELECT 1 - (-170141183460469231731687303715884105724);
----
170141183460469231731687303715884105725

query I
SELECT 1 - (-170141183460469231731687303715884105725);
----
170141183460469231731687303715884105726

query I
SELECT 1 - (-170141183460469231731687303715884105726);
----
170141183460469231731687303715884105727

statement error
SELECT 1 - (-170141183460469231731687303715884105728);
----
Out of Range Error: Overflow in subtraction of INT128 (1 - -170141183460469231731687303715884105728)!

# the other way around (i.e. move away from the overflow direction)
query I
SELECT -1 - (-170141183460469231731687303715884105728);
----
170141183460469231731687303715884105727

query I
SELECT 1 - 170141183460469231731687303715884105727;
----
-170141183460469231731687303715884105726

# multiplication
query I
SELECT 170141183460469231731687303715884105727 * 1;
----
170141183460469231731687303715884105727

query I
SELECT 170141183460469231731687303715884105727 * -1;
----
-170141183460469231731687303715884105727

query I
SELECT -170141183460469231731687303715884105728 * 1;
----
-170141183460469231731687303715884105728

query I
SELECT -170141183460469231731687303715884105727 * -1;
----
170141183460469231731687303715884105727

statement error
SELECT -170141183460469231731687303715884105728 * -1;
----
Out of Range Error: Overflow in multiplication of INT128 (-170141183460469231731687303715884105728 * -1)!

statement error
SELECT 85070591730234615865843651857942052864 * 2
----
Out of Range Error: Overflow in multiplication of INT128 (85070591730234615865843651857942052864 * 2)!

statement error
SELECT -85070591730234615865843651857942052864 * 2
----
Out of Range Error: Overflow in multiplication of INT128 (-85070591730234615865843651857942052864 * 2)!

statement error
SELECT 85070591730234615865843651857942052864 * -2
----
Out of Range Error: Overflow in multiplication of INT128 (85070591730234615865843651857942052864 * -2)!

statement error
SELECT -85070591730234615865843651857942052864 * -2
----
Out of Range Error: Overflow in multiplication of INT128 (-85070591730234615865843651857942052864 * -2)!

# division
query I
SELECT -170141183460469231731687303715884105728 // 2;
----
-85070591730234615865843651857942052864

query I
SELECT -170141183460469231731687303715884105728 // -2;
----
85070591730234615865843651857942052864

query I
SELECT -170141183460469231731687303715884105728 // -170141183460469231731687303715884105728;
----
1

query I
SELECT 170141183460469231731687303715884105727 // 170141183460469231731687303715884105727;
----
1

query I
SELECT 170141183460469231731687303715884105727 // 1;
----
170141183460469231731687303715884105727

query I
SELECT 170141183460469231731687303715884105727 // -1;
----
-170141183460469231731687303715884105727

query I
SELECT -170141183460469231731687303715884105728 // 1;
----
-170141183460469231731687303715884105728

query I
SELECT -170141183460469231731687303715884105727 // -1;
----
170141183460469231731687303715884105727

statement error
SELECT -170141183460469231731687303715884105728 // -1;
----
Out of Range Error: Overflow in division of INT128 (-170141183460469231731687303715884105728 // -1)!

statement error
SELECT -170141183460469231731687303715884105728 % -1;
----
Out of Range Error: Overflow in division of INT128 (-170141183460469231731687303715884105728 // -1)!

query I
SELECT -170141183460469231731687303715884105728 % -2;
----
0

query I
SELECT -170141183460469231731687303715884105728 % 2;
----
0

query I
SELECT -170141183460469231731687303715884105728 % 3;
----
-2

query I
SELECT -170141183460469231731687303715884105727 % -170141183460469231731687303715884105726;
----
-1

query I
SELECT -170141183460469231731687303715884105728 % -170141183460469231731687303715884105727;
----
-1

query I
SELECT -170141183460469231731687303715884105728 % -170141183460469231731687303715884105728;
----
0

query I
SELECT -170141183460469231731687303715884105728 % 170141183460469231731687303715884105727;
----
-1

query I
SELECT -170141183460469231731687303715884105728 % 170141183460469231731687303715884105728;
----
0

query I
SELECT 170141183460469231731687303715884105727 % -170141183460469231731687303715884105726;
----
1

query I
SELECT 170141183460469231731687303715884105727 % -170141183460469231731687303715884105727;
----
0

query I
SELECT 170141183460469231731687303715884105727 % -170141183460469231731687303715884105728;
----
170141183460469231731687303715884105727

query I
SELECT 170141183460469231731687303715884105727 % 170141183460469231731687303715884105726;
----
1

# comparisons
query II
SELECT '5'::HUGEINT <> '5'::HUGEINT, '5'::HUGEINT <> '18446744073709551621'::HUGEINT
----
false	true
