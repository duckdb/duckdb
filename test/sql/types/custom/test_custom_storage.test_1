# name: test/sql/types/custom/test_custom_storage.test
# description: CUSTOM types used in table/catalog storage tests
# group: [custom]

require customtype

statement ok
PRAGMA enable_verification

# load the DB from disk
load __TEST_DIR__/custom_types.db

statement ok
CREATE TYPE box (input := 'box_in', output := 'box_out');

statement ok
CREATE TABLE person (
    name text,
    current_box box
);

statement ok
INSERT INTO person VALUES ('Moe', 'happy');

query TT
select * from person
----
Moe	happy Box In Box Out

statement ok
DROP TABLE person;

# reload the database from disk a few times, and check that the data in the catalog is still there
loop i 0 2

restart

statement ok
CREATE TABLE person (
    name text,
    current_box box
);

statement ok
INSERT INTO person VALUES ('Moe', 'happy');

query TT
select * from person
----
Moe	happy

statement ok
DROP TABLE person;

endloop

statement ok
CREATE TABLE person (
    name text,
    current_box box
);

statement ok
INSERT INTO person VALUES ('Moe', 'happy');

query TT
select * from person
----
Moe	happy Box In Box Out

# reload the database from disk a few times, and check that the data in the table is still there
loop i 0 2

restart

# We cant drop mood and we verify the constraint is still there after reloading the database
statement error
DROP TYPE mood;

query TT
select * from person
----
Moe	happy Box In Box Out

endloop