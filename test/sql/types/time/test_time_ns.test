# name: test/sql/types/time/test_time_ns.test
# description: Have you seen the fnords?
# group: [time]

statement ok
PRAGMA enable_verification

# Parse and format
query I
SELECT '15:30:00.123456789'::TIME_NS;
----
15:30:00.123456789

# Insertion
statement ok
CREATE TABLE times(tns TIME_NS)

statement ok
INSERT INTO times VALUES 
	('00:00:00'), 
	('00:01:20'), 
	('10:21:00.0'), 
	('10:21:00.1'), 
	('10:21:00.9'), 
	('16:04:22.01'), 
	('16:04:22.12'), 
	('16:04:22.97'), 
	('20:08:10.001'), 
	('20:08:10.123'), 
	('20:08:10.998'), 
	('03:45:47.0001'), 
	('03:45:47.1234'), 
	('03:45:47.9999'), 
	('02:27:19.00001'), 
	('02:27:19.12345'), 
	('02:27:19.99899'), 
	('09:01:54.000001'), 
	('09:01:54.123456'), 
	('09:01:54.999978'), 
	('23:35:57.0000001'), 
	('23:35:57.1234567'), 
	('23:35:57.9999999'), 
	('13:00:00.00000001'), 
	('13:00:00.12345678'), 
	('13:00:00.99999989'), 
	('23:59:59.000000001'), 
	('23:59:59.123456789'), 
	('23:59:59.999999999'), 
	('24:00:00.000000000'), 
	(NULL)

query I
SELECT * FROM times
----
00:00:00
00:01:20
10:21:00
10:21:00.1
10:21:00.9
16:04:22.01
16:04:22.12
16:04:22.97
20:08:10.001
20:08:10.123
20:08:10.998
03:45:47.0001
03:45:47.1234
03:45:47.9999
02:27:19.00001
02:27:19.12345
02:27:19.99899
09:01:54.000001
09:01:54.123456
09:01:54.999978
23:35:57.0000001
23:35:57.1234567
23:35:57.9999999
13:00:00.00000001
13:00:00.12345678
13:00:00.99999989
23:59:59.000000001
23:59:59.123456789
23:59:59.999999999
24:00:00
NULL

#
# Date parts
#

# Single values
query IIII
SELECT tns, 
	DATE_PART('hour', tns),
	DATE_PART('minute', tns),
	DATE_PART('second', tns),
FROM times;
----
00:00:00	0	0	0
00:01:20	0	1	20
10:21:00	10	21	0
10:21:00.1	10	21	0
10:21:00.9	10	21	0
16:04:22.01	16	4	22
16:04:22.12	16	4	22
16:04:22.97	16	4	22
20:08:10.001	20	8	10
20:08:10.123	20	8	10
20:08:10.998	20	8	10
03:45:47.0001	3	45	47
03:45:47.1234	3	45	47
03:45:47.9999	3	45	47
02:27:19.00001	2	27	19
02:27:19.12345	2	27	19
02:27:19.99899	2	27	19
09:01:54.000001	9	1	54
09:01:54.123456	9	1	54
09:01:54.999978	9	1	54
23:35:57.0000001	23	35	57
23:35:57.1234567	23	35	57
23:35:57.9999999	23	35	57
13:00:00.00000001	13	0	0
13:00:00.12345678	13	0	0
13:00:00.99999989	13	0	0
23:59:59.000000001	23	59	59
23:59:59.123456789	23	59	59
23:59:59.999999999	23	59	59
24:00:00	24	0	0
NULL	NULL	NULL	NULL

query IIIII
SELECT tns, 
	DATE_PART('millisecond', tns),
	DATE_PART('microsecond', tns),
	nanosecond(tns),
	DATE_PART('epoch', tns),
FROM times;
----
00:00:00	0	0	0	0.0
00:01:20	20000	20000000	20000000000	80.0
10:21:00	0	0	0	37260.0
10:21:00.1	100	100000	100000000	37260.1
10:21:00.9	900	900000	900000000	37260.9
16:04:22.01	22010	22010000	22010000000	57862.01
16:04:22.12	22120	22120000	22120000000	57862.12
16:04:22.97	22970	22970000	22970000000	57862.97
20:08:10.001	10001	10001000	10001000000	72490.001
20:08:10.123	10123	10123000	10123000000	72490.123
20:08:10.998	10998	10998000	10998000000	72490.998
03:45:47.0001	47000	47000100	47000100000	13547.0001
03:45:47.1234	47123	47123400	47123400000	13547.1234
03:45:47.9999	47999	47999900	47999900000	13547.9999
02:27:19.00001	19000	19000010	19000010000	8839.00001
02:27:19.12345	19123	19123450	19123450000	8839.12345
02:27:19.99899	19998	19998990	19998990000	8839.99899
09:01:54.000001	54000	54000001	54000001000	32514.000001
09:01:54.123456	54123	54123456	54123456000	32514.123456
09:01:54.999978	54999	54999978	54999978000	32514.999978
23:35:57.0000001	57000	57000000	57000000100	84957.0
23:35:57.1234567	57123	57123456	57123456700	84957.123456
23:35:57.9999999	57999	57999999	57999999900	84957.999999
13:00:00.00000001	0	0	10	46800.0
13:00:00.12345678	123	123456	123456780	46800.123456
13:00:00.99999989	999	999999	999999890	46800.999999
23:59:59.000000001	59000	59000000	59000000001	86399.0
23:59:59.123456789	59123	59123456	59123456789	86399.123456
23:59:59.999999999	59999	59999999	59999999999	86399.999999
24:00:00	0	0	0	86400.0
NULL	NULL	NULL	NULL	NULL

foreach part timezone timezone_hour timezone_minute

query II
SELECT tns, DATE_PART('${part}', tns) p
FROM times
WHERE p <> 0
----

endloop

# Structs
query II
SELECT tns, DATE_PART(['hour', 'minute', 'second'], tns)
FROM times;
----
00:00:00	{'hour': 0, 'minute': 0, 'second': 0}
00:01:20	{'hour': 0, 'minute': 1, 'second': 20}
10:21:00	{'hour': 10, 'minute': 21, 'second': 0}
10:21:00.1	{'hour': 10, 'minute': 21, 'second': 0}
10:21:00.9	{'hour': 10, 'minute': 21, 'second': 0}
16:04:22.01	{'hour': 16, 'minute': 4, 'second': 22}
16:04:22.12	{'hour': 16, 'minute': 4, 'second': 22}
16:04:22.97	{'hour': 16, 'minute': 4, 'second': 22}
20:08:10.001	{'hour': 20, 'minute': 8, 'second': 10}
20:08:10.123	{'hour': 20, 'minute': 8, 'second': 10}
20:08:10.998	{'hour': 20, 'minute': 8, 'second': 10}
03:45:47.0001	{'hour': 3, 'minute': 45, 'second': 47}
03:45:47.1234	{'hour': 3, 'minute': 45, 'second': 47}
03:45:47.9999	{'hour': 3, 'minute': 45, 'second': 47}
02:27:19.00001	{'hour': 2, 'minute': 27, 'second': 19}
02:27:19.12345	{'hour': 2, 'minute': 27, 'second': 19}
02:27:19.99899	{'hour': 2, 'minute': 27, 'second': 19}
09:01:54.000001	{'hour': 9, 'minute': 1, 'second': 54}
09:01:54.123456	{'hour': 9, 'minute': 1, 'second': 54}
09:01:54.999978	{'hour': 9, 'minute': 1, 'second': 54}
23:35:57.0000001	{'hour': 23, 'minute': 35, 'second': 57}
23:35:57.1234567	{'hour': 23, 'minute': 35, 'second': 57}
23:35:57.9999999	{'hour': 23, 'minute': 35, 'second': 57}
13:00:00.00000001	{'hour': 13, 'minute': 0, 'second': 0}
13:00:00.12345678	{'hour': 13, 'minute': 0, 'second': 0}
13:00:00.99999989	{'hour': 13, 'minute': 0, 'second': 0}
23:59:59.000000001	{'hour': 23, 'minute': 59, 'second': 59}
23:59:59.123456789	{'hour': 23, 'minute': 59, 'second': 59}
23:59:59.999999999	{'hour': 23, 'minute': 59, 'second': 59}
24:00:00	{'hour': 24, 'minute': 0, 'second': 0}
NULL	NULL

query II
SELECT tns, DATE_PART(['millisecond', 'microsecond', 'epoch'], tns)
FROM times;
----
00:00:00	{'millisecond': 0, 'microsecond': 0, 'epoch': 0.0}
00:01:20	{'millisecond': 20000, 'microsecond': 20000000, 'epoch': 80.0}
10:21:00	{'millisecond': 0, 'microsecond': 0, 'epoch': 37260.0}
10:21:00.1	{'millisecond': 100, 'microsecond': 100000, 'epoch': 37260.1}
10:21:00.9	{'millisecond': 900, 'microsecond': 900000, 'epoch': 37260.9}
16:04:22.01	{'millisecond': 22010, 'microsecond': 22010000, 'epoch': 57862.01}
16:04:22.12	{'millisecond': 22120, 'microsecond': 22120000, 'epoch': 57862.12}
16:04:22.97	{'millisecond': 22970, 'microsecond': 22970000, 'epoch': 57862.97}
20:08:10.001	{'millisecond': 10001, 'microsecond': 10001000, 'epoch': 72490.001}
20:08:10.123	{'millisecond': 10123, 'microsecond': 10123000, 'epoch': 72490.123}
20:08:10.998	{'millisecond': 10998, 'microsecond': 10998000, 'epoch': 72490.998}
03:45:47.0001	{'millisecond': 47000, 'microsecond': 47000100, 'epoch': 13547.0001}
03:45:47.1234	{'millisecond': 47123, 'microsecond': 47123400, 'epoch': 13547.1234}
03:45:47.9999	{'millisecond': 47999, 'microsecond': 47999900, 'epoch': 13547.9999}
02:27:19.00001	{'millisecond': 19000, 'microsecond': 19000010, 'epoch': 8839.00001}
02:27:19.12345	{'millisecond': 19123, 'microsecond': 19123450, 'epoch': 8839.12345}
02:27:19.99899	{'millisecond': 19998, 'microsecond': 19998990, 'epoch': 8839.99899}
09:01:54.000001	{'millisecond': 54000, 'microsecond': 54000001, 'epoch': 32514.000001}
09:01:54.123456	{'millisecond': 54123, 'microsecond': 54123456, 'epoch': 32514.123456}
09:01:54.999978	{'millisecond': 54999, 'microsecond': 54999978, 'epoch': 32514.999978}
23:35:57.0000001	{'millisecond': 57000, 'microsecond': 57000000, 'epoch': 84957.0}
23:35:57.1234567	{'millisecond': 57123, 'microsecond': 57123456, 'epoch': 84957.123456}
23:35:57.9999999	{'millisecond': 57999, 'microsecond': 57999999, 'epoch': 84957.999999}
13:00:00.00000001	{'millisecond': 0, 'microsecond': 0, 'epoch': 46800.0}
13:00:00.12345678	{'millisecond': 123, 'microsecond': 123456, 'epoch': 46800.123456}
13:00:00.99999989	{'millisecond': 999, 'microsecond': 999999, 'epoch': 46800.999999}
23:59:59.000000001	{'millisecond': 59000, 'microsecond': 59000000, 'epoch': 86399.0}
23:59:59.123456789	{'millisecond': 59123, 'microsecond': 59123456, 'epoch': 86399.123456}
23:59:59.999999999	{'millisecond': 59999, 'microsecond': 59999999, 'epoch': 86399.999999}
24:00:00	{'millisecond': 0, 'microsecond': 0, 'epoch': 86400.0}
NULL	NULL

query II
SELECT tns, DATE_PART(['timezone', 'timezone_hour', 'timezone_minute'], tns) p
FROM times
WHERE p <> {'timezone': 0, 'timezone_hour': 0, 'timezone_minute': 0}
----

# Invalid parts
foreach part year month day quarter dow isodow doy week yearweek 

statement error
SELECT date_part('${part}', '23:59:59.123456789'::TIME_NS);
----
Binder Error: No function matches the given name and argument types

statement error
SELECT date_part(['${part}'], '23:59:59.123456789'::TIME_NS);
----
not recognized

endloop

foreach isoyear era

statement error
SELECT date_part('${part}', '23:59:59.123456789'::TIME_NS);
----
not recognized

statement error
SELECT date_part(['${part}'], '23:59:59.123456789'::TIME_NS);
----
not recognized

endloop

statement error
SELECT date_part('julian', '23:59:59.123456789'::TIME_NS);
----
Binder Error: julian can only take DATE or TIMESTAMP arguments

statement error
SELECT date_part(['julian'], '23:59:59.123456789'::TIME_NS);
----
not recognized

#
# Casts
#

# TIME_NS => TIME
query II
SELECT tns, tns::TIME t
FROM times
----
00:00:00	00:00:00
00:01:20	00:01:20
10:21:00	10:21:00
10:21:00.1	10:21:00.1
10:21:00.9	10:21:00.9
16:04:22.01	16:04:22.01
16:04:22.12	16:04:22.12
16:04:22.97	16:04:22.97
20:08:10.001	20:08:10.001
20:08:10.123	20:08:10.123
20:08:10.998	20:08:10.998
03:45:47.0001	03:45:47.0001
03:45:47.1234	03:45:47.1234
03:45:47.9999	03:45:47.9999
02:27:19.00001	02:27:19.00001
02:27:19.12345	02:27:19.12345
02:27:19.99899	02:27:19.99899
09:01:54.000001	09:01:54.000001
09:01:54.123456	09:01:54.123456
09:01:54.999978	09:01:54.999978
23:35:57.0000001	23:35:57
23:35:57.1234567	23:35:57.123457
23:35:57.9999999	23:35:58
13:00:00.00000001	13:00:00
13:00:00.12345678	13:00:00.123457
13:00:00.99999989	13:00:01
23:59:59.000000001	23:59:59
23:59:59.123456789	23:59:59.123457
23:59:59.999999999	24:00:00
24:00:00	24:00:00
NULL	NULL

# TIMESTAMP_NS => TIME_NS
query I
SELECT '2025-05-20 15:30:00.123456789'::TIMESTAMP_NS::TIME_NS t;
----
15:30:00.123456789

query I
SELECT '1962-05-20 15:30:00.123456789'::TIMESTAMP_NS::TIME_NS t;
----
15:30:00.123456789
