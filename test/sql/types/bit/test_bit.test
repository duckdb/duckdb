# name: test/sql/types/bit/test_bit.test
# description: BIT tests
# group: [bit]

statement ok
PRAGMA enable_verification

query I
SELECT ('0101011'::BIT)
----
0101011

# test alias bitstring
query I
SELECT ('0101011'::BITSTRING)
----
0101011

statement ok
CREATE TABLE bits (b bit);

# test creating a bitstring of determined size

foreach cast VARCHAR BIT

query I
SELECT bitstring('0101011'::${cast}, 15);
----
000000000101011

query I
SELECT bitstring('1'::${cast}, 6);
----
000001

query I
SELECT bitstring('1'::${cast}, 1);
----
1

query I
SELECT bitstring('0101011'::${cast}, 203);
----
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000101011

query I
SELECT bitstring('111100001111000010101010'::${cast}, 36);
----
000000000000111100001111000010101010

statement error
SELECT bitstring('0101011'::${cast}, 3);
----
<REGEX>:Invalid Input Error.*Length must be equal or larger than input string.*

# cast
endloop

statement error
SELECT bitstring('', 0);
----
<REGEX>:Conversion Error.*Cannot cast empty string to BIT.*

statement error
SELECT bitstring('5', 10);
----
<REGEX>:Conversion Error.*Invalid character encountered.*

statement error
SELECT bitstring('0101011');
----
<REGEX>:Binder Error.*No function matches.*

# insert valid bit strings
statement ok
INSERT INTO bits VALUES('101011010'), ('111'), ('1010010101111111001101')

query I
SELECT * FROM bits
----
101011010
111
1010010101111111001101

statement ok
INSERT INTO bits VALUES('0'), ('1'), ('0000000000000000000111')

query I
SELECT * FROM bits
----
101011010
111
1010010101111111001101
0
1
0000000000000000000111

query I
SELECT * FROM bits WHERE b = '111';
----
111

# invalid bit strings
statement error
INSERT INTO bits VALUES('101211010')
----
<REGEX>:Conversion Error.*Invalid character encountered.*

statement error
INSERT INTO bits VALUES('1A10')
----
<REGEX>:Conversion Error.*Invalid character encountered.*

statement error
SELECT ('0101011'::BIT(10))
----
<REGEX>:Parser Error.*Type BIT does not support any modifiers!.*

# bit null test and empty values
query I
SELECT NULL::BIT
----
NULL

statement error
SELECT ''::BIT
----
<REGEX>:Conversion Error.*Cannot cast empty string to BIT.*

statement ok
DELETE FROM bits

statement ok
INSERT INTO bits VALUES (NULL)

statement error
INSERT INTO bits VALUES ('')
----
<REGEX>:Conversion Error.*Cannot cast empty string to BIT.*

query I
SELECT * FROM bits
----
NULL

# try cast
query I
SELECT TRY_CAST('101' AS BIT)
----
101

query I
SELECT TRY_CAST('102' AS BIT)
----
NULL

# cast varchar column to bit type
statement ok
CREATE TABLE varchars (col VARCHAR);

statement ok
INSERT INTO varchars VALUES('1010010101010101100001111111001101'), ('0')

query I
SELECT col::BIT FROM varchars
----
1010010101010101100001111111001101
0

statement ok
INSERT INTO varchars VALUES('1011010'), ('0ðŸ¦†1'), ('1'), ('3')

query I
SELECT TRY_CAST(col AS BIT) FROM varchars
----
1010010101010101100001111111001101
0
1011010
NULL
1
NULL

# Huge bit string
statement ok
CREATE TABLE huge_bits (big bit);

# insert valid bit strings
statement ok
INSERT INTO huge_bits VALUES('101011010010010100111000010101010100001001010010010100010101000001010010000010101010010101001010010010100100000010010010010010101010100010101001001001010010101101011010010010100111000010101010100001001010010010100010101000001010010000010101010010101001010010010100100000010010010010010101010100010101001001001010010101101011010010010100111000010101010100001001010010010100010101000001010010000010101010010101001010010010100100000010010010010010101010100010101001001001010010101101011010010010100111000010101010100001001010010010100010101000001010010000010101010010101001010010010100100000010010010010010101010100010101001001001010010101101011010010010100111000010101010100001001010010010100010101000001010010000010101010010101001010010010100100000010010010010010101010100010101001001001010010101101011010010010100111000010101010100001001010010010100010101000001010010000010101010010101001010010010100100000010010010010010101010100010101001001001010010101101011010010010100111000010101010100001001010010010100010101000001010010000010101010010101001010010010100100000010010010010010101010100010101001001001010010101101011010010010100111000010101010100001001010010010100010101000001010010000010101010010101001010010010100100000010010010010010101010100010101001001001010010101101011010010010100111000010101010100001001010010010100010101000001010010000010101010010101001010010010100100000010010010010010101010100010101001001001010010101101011010010010100111000010101010100001001010010010100010101000001010010000010101010010101001010010010100100000010010010010010101010100010101001001001010010101101011010010010100111000010101010100001001010010010100010101000001010010000010101010010101001010010010100100000010010010010010101010100010101001001001010010101101011010010010100111000010101010100001001010010010100010101000001010010000010101010010101001010010010100100000010010010010010101010100010101001001001010010101101011010010010100111000010101010100001001010010010100010101000001010010000010101010010101001010010010100100000010010010010010101010100010101001001001010010101101011010010010100111000010101010100001001010010010100010101000001010010000010101010010101001010010010100100000010010010010010101010100010101001001001010010101101011010010010100111000010101010100001001010010010100010101000001010010000010101010010101001010010010100100000010010010010010101010100010101001001001010010101101011010010010100111000010101010100001001010010010100010101000001010010000010101010010101001010010010100100000010010010010010101010100010101001001001010010101101011010010010100111000010101010100001001010010010100010101000001010010000010101010010101001010010010100100000010010010010010101010100010101001001001010010101101011010010010100111000010101010100001001010010010100010101000001010010000010101010010101001010010010100100000010010010010010101010100010101001001001010010101101011010010010100111000010101010100001001010010010100010101000001010010000010101010010101001010010010100100000010010010010010101010100010101001001001010010101101011010010010100111000010101010100001001010010010100010101000001010010000010101010010101001010010010100100000010010010010010101010100010101001001001010010101101011010010010100111000010101010100001001010010010100010101000001010010000010101010010101001010010010100100000010010010010010101010100010101001001001010010101101011010010010100111000010101010100001001010010010100010101000001010010000010101010010101001010010010100100000010010010010010101010100010101001001001010010101101011010010010100111000010101010100001001010010010100010101000001010010000010101010010101001010010010100100000010010010010010101010100010101001001001010010101101011010010010100111000010101010100001001010010010100010101000001010010000010101010010101001010010010100100000010010010010010101010100010101001001001010010101101011010010010100111000010101010100001001010010010100010101000001010010000010101010010101001010010010100100000010010010010010101010100010101001001001010010101101011010010010100111000010101010100001001010010010100010101000001010010000010101010010101001010010010100100000010010010010010101010100010101001001001010010101101011010010010100111000010101010100001001010010010100010101000001010010000010101010010101001010010010100100000010010010010010101010100010101001001001010010101101011010010010100111000010101010100001001010010010100010101000001010010000010101010010101001010010010100100000010010010010010101010100010101001001001010010101101011010010010100111000010101010100001001010010010100010101000001010010000010101010010101001010010010100100000010010010010010101010100010101001001001010010101101011010010010100111000010101010100001001010010010100010101000001010010000010101010010101001010010010100100000010010010010010101010100010101001001001010010101101011010010010100111000010101010100001001010010010100010101000001010010000010101010010101001010010010100100000010010010010010101010100010101001001001010010101101011010010010100111000010101010100001001010010010100010101000001010010000010101010010101001010010010100100000010010010010010101010100010101001001001010010101101011010010010100111000010101010100001001010010010100010101000001010010000010101010010101001010010010100100000010010010010010101010100010101001001001010010101101011010010010100111000010101010100001001010010010100010101000001010010000010101010010101001010010010100100000010010010010010101010100010101001001001010010101101011010010010100111000010101010100001001010010010100010101000001010010000010101010010101001010010010100100000010010010010010101010100010101001001001010010101101011010010010100111000010101010100001001010010010100010101000001010010000010101010010101001010010010100100000010010010010010101010100010101001001001010010101101011010010010100111000010101010100001001010010010100010101000001010010000010101010010101001010010010100100000010010010010010101010100010101001001001010010101101011010010010100111000010101010100001001010010010100010101000001010010000010101010010101001010010010100100000010010010010010101010100010101001001001010010101101011010010010100111000010101010100001001010010010100010101000001010010000010101010010101001010010010100100000010010010010010101010100010101001001001010010101101011010010010100111000010101010100001001010010010100010101000001010010000010101010010101001010010010100100000010010010010010101010100010101001001001010010101101011010010010100111000010101010100001001010010010100010101000001010010000010101010010101001010010010100100000010010010010010101010100010101001001001010010101101011010010010100111000010101010100001001010010010100010101000001010010000010101010010101001010010010100100000010010010010010101010100010101001001001010010101010110100100101001110000101010101000010010100100101000101010000010100100000101010100101010010100100101001000000100100100100101010101000101010010010010100101011010110100100101001110000101010101000010010100100101000101010000010100100000101010100101010010100100101001000000100100100100101010101000101010010010010100101011010110100100101001110000101010101000010010100100101000101010000010100100000101010100101010010100100101001000000100100100100101010101000101010010010010100101011010110100100101001110000101010101000010010100100101000101010000010100100000101010100101010010100100101001000000100100100100101010101000101010010010010100101011010110100100101001110000101010101000010010100100101000101010000010100100000101010100101010010100100101001000000100100100100101010101000101010010010010100101011010110100100101001110000101010101000010010100100101000101010000010100100000101010100101010010100100101001000000100100100100101010101000101010010010010100101011010110100100101001110000101010101000010010100100101000101010000010100100000101010100101010010100100101001000000100100100100101010101000101010010010010100101011010110100100101001110000101010101000010010100100101000101010000010100100000101010100101010010100100101001000000100100100100101010101000101010010010010100101011010110100100101001110000101010101000010010100100101000101010000010100100000101010100101010010100100101001000000100100100100101010101000101010010010010100101011010110100100101001110000101010101000010010100100101000101010000010100100000101010100101010010100100101001000000100100100100101010101000101010010010010100101011010110100100101001110000101010101000010010100100101000101010000010100100000101010100101010010100100101001000000100100100100101010101000101010010010010100101011010110100100101001110000101010101000010010100100101000101010000010100100000101010100101010010100100101001000000100100100100101010101000101010010010010100101011010110100100101001110000101010101000010010100100101000101010000010100100000101010100101010010100100101001000000100100100100101010101000101010010010010100101011010110100100101001110000101010101000010010100100101000101010000010100100000101010100101010010100100101001000000100100100100101010101000101010010010010100101011010110100100101001110000101010101000010010100100101000101010000010100100000101010100101010010100100101001000000100100100100101010101000101010010010010100101011010110100100101001110000101010101000010010100100101000101010000010100100000101010100101010010100100101001000000100100100100101010101000101010010010010100101011010110100100101001110000101010101000010010100100101000101010000010100100000101010100101010010100100101001000000100100100100101010101000101010010010010100101011010110100100101001110000101010101000010010100100101000101010000010100100000101010100101010010100100101001000000100100100100101010101000101010010010010100101011010110100100101001110000101010101000010010100100101000101010000010100100000101010100101010010100100101001000000100100100100101010101000101010010010010100101011010110100100101001110000101010101000010010100100101000101010000010100100000101010100101010010100100101001000000100100100100101010101000101010010010010100101011010110100100101001110000101010101000010010100100101000101010000010100100000101010100101010010100100101001000000100100100100101010101000101010010010010100101011')

query I
SELECT bit_length(big) FROM huge_bits
----
10017
