# name: test/sql/types/struct/struct_projection_pushdown_in_storage.test
# group: [struct]

#statement ok
#pragma disable_optimizer;

statement ok
CREATE TABLE test_structs(
	col VARCHAR,
	i STRUCT(a integer, b bool, c VARCHAR)
);

statement ok
INSERT INTO test_structs VALUES
	('test', {'a': 1, 'b': true, 'c': 'test'}),
	('test', {'a': 2, 'b': false, 'c': 'hello'}),
	('hello', NULL),
	('test', {'a': 3, 'b': true, 'c': 'this is a long string'}),
	('test', {'a': NULL, 'b': NULL, 'c': NULL});

query I
SELECT i.a FROM test_structs;
----
1
2
NULL
3
NULL

query II
SELECT i.a, i.c FROM test_structs
----
1	test
2	hello
NULL	NULL
3	this is a long string
NULL	NULL

query II
SELECT i.a, i.c FROM test_structs where col == 'test'
----
1	test
2	hello
3	this is a long string
NULL	NULL

statement ok
pragma explain_output = optimized_only

# The 'struct_extract' expression is entirely removed
query II
EXPLAIN SELECT i.a FROM test_structs;
----
logical_opt	<!REGEX>:.*struct_extract.*
