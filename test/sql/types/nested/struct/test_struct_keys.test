# name: test/sql/types/nested/struct/test_struct_keys.test
# group: [struct]

statement ok
PRAGMA enable_verification;

# Basic
query I
select struct_keys({a: 1, b: 2});
----
[a, b]

# NULL as input (typed)
query I
select struct_keys(NULL::STRUCT(a INT, b VARCHAR));
----
NULL

# Constant vector as input (same result for every row)
statement ok
CREATE TABLE t_struct_constant(x INTEGER);

statement ok
INSERT INTO t_struct_constant VALUES (1), (2), (3);

query I
SELECT struct_keys({a: 1, b: 2}) FROM t_struct_constant;
----
[a, b]
[a, b]
[a, b]

# Dictionary vector as input, preserve per-row NULLs
statement ok
CREATE TABLE filtered_struct (
    col STRUCT(a INT, b VARCHAR),
    idx INTEGER
);

statement ok
INSERT INTO filtered_struct VALUES
    (ROW(1, 'x')::STRUCT(a INT, b VARCHAR), 0),
    (ROW(2, 'y')::STRUCT(a INT, b VARCHAR), 1),
    (NULL::STRUCT(a INT, b VARCHAR), 3),
    (ROW(4, 'q')::STRUCT(a INT, b VARCHAR), 2);

# Expecting to get the results respectively to the filteration & ordering
query I
SELECT struct_keys(col) FROM filtered_struct WHERE idx % 2 != 0 ORDER BY idx;
----
[a, b]
NULL
