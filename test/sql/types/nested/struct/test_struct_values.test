# name: test/sql/types/nested/struct/test_struct_values.test
# group: [struct]

# Basic: returns unnamed struct (ROW) with values in field order
query I
select struct_values({a: 1, b: 'x', c: 3});
----
(1, x, 3)

# NULL as input (typed)
query I
select struct_values(NULL::STRUCT(a INT, b VARCHAR));
----
NULL

# NULL as input (untyped)
query I
select struct_values(NULL);
----
NULL

# Constant vector as input (same result for every row)
statement ok
CREATE TABLE t_struct_values_constant(x INTEGER);

statement ok
INSERT INTO t_struct_values_constant VALUES (1), (2), (3);

query I
SELECT struct_values({a: 1, b: 'y'}) FROM t_struct_values_constant;
----
(1, y)
(1, y)
(1, y)

# Flat vector as input with per-row NULLs
statement ok
CREATE TABLE t_struct_values_flat(col STRUCT(a INT, b VARCHAR), idx INTEGER);

statement ok
INSERT INTO t_struct_values_flat VALUES
	(ROW(1, 'x')::STRUCT(a INT, b VARCHAR), 0),
	(ROW(2, 'y')::STRUCT(a INT, b VARCHAR), 1),
	(ROW(3, 'z')::STRUCT(a INT, b VARCHAR), 2),
	(NULL::STRUCT(a INT, b VARCHAR), 3),
	(ROW(4, 'q')::STRUCT(a INT, b VARCHAR), 4);

query I
SELECT struct_values(col) FROM t_struct_values_flat;
----
(1, x)
(2, y)
(3, z)
NULL
(4, q)

# Preserve per-row NULLs and order after filtering
statement ok
CREATE TABLE filtered_struct_values (
    col STRUCT(a INT, b VARCHAR),
    idx INTEGER
);

statement ok
INSERT INTO filtered_struct_values VALUES
    (ROW(1, 'x')::STRUCT(a INT, b VARCHAR), 0),
    (ROW(2, 'y')::STRUCT(a INT, b VARCHAR), 1),
    (NULL::STRUCT(a INT, b VARCHAR), 3),
    (ROW(4, 'q')::STRUCT(a INT, b VARCHAR), 2);

# Expecting to get the results respectively to the filtration & ordering
query I
SELECT struct_values(col) FROM filtered_struct_values WHERE idx % 2 != 0 ORDER BY idx;
----
(2, y)
NULL

# Unnamed struct as input is allowed and should return the same row
query I
select struct_values(ROW(10, 'hello'));
----
(10, hello)

# Error cases: non-STRUCT inputs should fail
statement error
select struct_values(42);
----
struct_values() expects a STRUCT argument

statement error
select struct_values(['a', 'b']);
----
struct_values() expects a STRUCT argument
