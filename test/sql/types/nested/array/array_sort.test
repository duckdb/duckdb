# name: test/sql/types/nested/array/array_sort.test
# group: [array]

statement ok
PRAGMA enable_verification

statement ok
PRAGMA verify_external

query I
SELECT array_value(i -1, i, i + 1) FROM range(4,1,-1) as r(i) ORDER BY 1 DESC;
----
[3, 4, 5]
[2, 3, 4]
[1, 2, 3]

query I
SELECT array_value(i -1, i, i + 1) FROM range(4,1,-1) as r(i) ORDER BY 1 ASC;
----
[1, 2, 3]
[2, 3, 4]
[3, 4, 5]

# Try with larger arrays (more than 1 byte of validity data)
query I
SELECT * FROM (VALUES (array_value(0,1,2,3,4,NULL,6,7,8,9)), (array_value(10,11,NULL,13,14,15,16,17,18,19))) ORDER BY 1 ASC;
----
[0, 1, 2, 3, 4, NULL, 6, 7, 8, 9]
[10, 11, NULL, 13, 14, 15, 16, 17, 18, 19]


query I
SELECT * FROM (VALUES (array_value(0,1,2,3,4,NULL,6,7,8,9)), (array_value(10,11,NULL,13,14,15,16,17,18,19))) ORDER BY 1 DESC
----
[10, 11, NULL, 13, 14, 15, 16, 17, 18, 19]
[0, 1, 2, 3, 4, NULL, 6, 7, 8, 9]


# Nested sorting
# Test combinations of array/list nesting (up to 3 levels)

foreach COLLECTION_OUTER array_value list_value

foreach COLLECTION_MIDDLE array_value list_value

foreach COLLECTION_INNER array_value list_value

query I
WITH 
	a(i) AS (SELECT * FROM range(0,2)), 
	b(i) AS (SELECT ${COLLECTION_INNER}(a1.i, a2.i) FROM a as a1, a as a2),
	c(i) AS (SELECT ${COLLECTION_MIDDLE}(b1.i, b2.i) FROM b as b1, b as b2)
SELECT ${COLLECTION_OUTER}(c1.i, c2.i) FROM c as c1, c as c2
ORDER BY 1 ASC;
----
[[[0, 0], [0, 0]], [[0, 0], [0, 0]]]
[[[0, 0], [0, 0]], [[0, 0], [0, 1]]]
[[[0, 0], [0, 0]], [[0, 0], [1, 0]]]
[[[0, 0], [0, 0]], [[0, 0], [1, 1]]]
[[[0, 0], [0, 0]], [[0, 1], [0, 0]]]
[[[0, 0], [0, 0]], [[0, 1], [0, 1]]]
[[[0, 0], [0, 0]], [[0, 1], [1, 0]]]
[[[0, 0], [0, 0]], [[0, 1], [1, 1]]]
[[[0, 0], [0, 0]], [[1, 0], [0, 0]]]
[[[0, 0], [0, 0]], [[1, 0], [0, 1]]]
[[[0, 0], [0, 0]], [[1, 0], [1, 0]]]
[[[0, 0], [0, 0]], [[1, 0], [1, 1]]]
[[[0, 0], [0, 0]], [[1, 1], [0, 0]]]
[[[0, 0], [0, 0]], [[1, 1], [0, 1]]]
[[[0, 0], [0, 0]], [[1, 1], [1, 0]]]
[[[0, 0], [0, 0]], [[1, 1], [1, 1]]]
[[[0, 0], [0, 1]], [[0, 0], [0, 0]]]
[[[0, 0], [0, 1]], [[0, 0], [0, 1]]]
[[[0, 0], [0, 1]], [[0, 0], [1, 0]]]
[[[0, 0], [0, 1]], [[0, 0], [1, 1]]]
[[[0, 0], [0, 1]], [[0, 1], [0, 0]]]
[[[0, 0], [0, 1]], [[0, 1], [0, 1]]]
[[[0, 0], [0, 1]], [[0, 1], [1, 0]]]
[[[0, 0], [0, 1]], [[0, 1], [1, 1]]]
[[[0, 0], [0, 1]], [[1, 0], [0, 0]]]
[[[0, 0], [0, 1]], [[1, 0], [0, 1]]]
[[[0, 0], [0, 1]], [[1, 0], [1, 0]]]
[[[0, 0], [0, 1]], [[1, 0], [1, 1]]]
[[[0, 0], [0, 1]], [[1, 1], [0, 0]]]
[[[0, 0], [0, 1]], [[1, 1], [0, 1]]]
[[[0, 0], [0, 1]], [[1, 1], [1, 0]]]
[[[0, 0], [0, 1]], [[1, 1], [1, 1]]]
[[[0, 0], [1, 0]], [[0, 0], [0, 0]]]
[[[0, 0], [1, 0]], [[0, 0], [0, 1]]]
[[[0, 0], [1, 0]], [[0, 0], [1, 0]]]
[[[0, 0], [1, 0]], [[0, 0], [1, 1]]]
[[[0, 0], [1, 0]], [[0, 1], [0, 0]]]
[[[0, 0], [1, 0]], [[0, 1], [0, 1]]]
[[[0, 0], [1, 0]], [[0, 1], [1, 0]]]
[[[0, 0], [1, 0]], [[0, 1], [1, 1]]]
[[[0, 0], [1, 0]], [[1, 0], [0, 0]]]
[[[0, 0], [1, 0]], [[1, 0], [0, 1]]]
[[[0, 0], [1, 0]], [[1, 0], [1, 0]]]
[[[0, 0], [1, 0]], [[1, 0], [1, 1]]]
[[[0, 0], [1, 0]], [[1, 1], [0, 0]]]
[[[0, 0], [1, 0]], [[1, 1], [0, 1]]]
[[[0, 0], [1, 0]], [[1, 1], [1, 0]]]
[[[0, 0], [1, 0]], [[1, 1], [1, 1]]]
[[[0, 0], [1, 1]], [[0, 0], [0, 0]]]
[[[0, 0], [1, 1]], [[0, 0], [0, 1]]]
[[[0, 0], [1, 1]], [[0, 0], [1, 0]]]
[[[0, 0], [1, 1]], [[0, 0], [1, 1]]]
[[[0, 0], [1, 1]], [[0, 1], [0, 0]]]
[[[0, 0], [1, 1]], [[0, 1], [0, 1]]]
[[[0, 0], [1, 1]], [[0, 1], [1, 0]]]
[[[0, 0], [1, 1]], [[0, 1], [1, 1]]]
[[[0, 0], [1, 1]], [[1, 0], [0, 0]]]
[[[0, 0], [1, 1]], [[1, 0], [0, 1]]]
[[[0, 0], [1, 1]], [[1, 0], [1, 0]]]
[[[0, 0], [1, 1]], [[1, 0], [1, 1]]]
[[[0, 0], [1, 1]], [[1, 1], [0, 0]]]
[[[0, 0], [1, 1]], [[1, 1], [0, 1]]]
[[[0, 0], [1, 1]], [[1, 1], [1, 0]]]
[[[0, 0], [1, 1]], [[1, 1], [1, 1]]]
[[[0, 1], [0, 0]], [[0, 0], [0, 0]]]
[[[0, 1], [0, 0]], [[0, 0], [0, 1]]]
[[[0, 1], [0, 0]], [[0, 0], [1, 0]]]
[[[0, 1], [0, 0]], [[0, 0], [1, 1]]]
[[[0, 1], [0, 0]], [[0, 1], [0, 0]]]
[[[0, 1], [0, 0]], [[0, 1], [0, 1]]]
[[[0, 1], [0, 0]], [[0, 1], [1, 0]]]
[[[0, 1], [0, 0]], [[0, 1], [1, 1]]]
[[[0, 1], [0, 0]], [[1, 0], [0, 0]]]
[[[0, 1], [0, 0]], [[1, 0], [0, 1]]]
[[[0, 1], [0, 0]], [[1, 0], [1, 0]]]
[[[0, 1], [0, 0]], [[1, 0], [1, 1]]]
[[[0, 1], [0, 0]], [[1, 1], [0, 0]]]
[[[0, 1], [0, 0]], [[1, 1], [0, 1]]]
[[[0, 1], [0, 0]], [[1, 1], [1, 0]]]
[[[0, 1], [0, 0]], [[1, 1], [1, 1]]]
[[[0, 1], [0, 1]], [[0, 0], [0, 0]]]
[[[0, 1], [0, 1]], [[0, 0], [0, 1]]]
[[[0, 1], [0, 1]], [[0, 0], [1, 0]]]
[[[0, 1], [0, 1]], [[0, 0], [1, 1]]]
[[[0, 1], [0, 1]], [[0, 1], [0, 0]]]
[[[0, 1], [0, 1]], [[0, 1], [0, 1]]]
[[[0, 1], [0, 1]], [[0, 1], [1, 0]]]
[[[0, 1], [0, 1]], [[0, 1], [1, 1]]]
[[[0, 1], [0, 1]], [[1, 0], [0, 0]]]
[[[0, 1], [0, 1]], [[1, 0], [0, 1]]]
[[[0, 1], [0, 1]], [[1, 0], [1, 0]]]
[[[0, 1], [0, 1]], [[1, 0], [1, 1]]]
[[[0, 1], [0, 1]], [[1, 1], [0, 0]]]
[[[0, 1], [0, 1]], [[1, 1], [0, 1]]]
[[[0, 1], [0, 1]], [[1, 1], [1, 0]]]
[[[0, 1], [0, 1]], [[1, 1], [1, 1]]]
[[[0, 1], [1, 0]], [[0, 0], [0, 0]]]
[[[0, 1], [1, 0]], [[0, 0], [0, 1]]]
[[[0, 1], [1, 0]], [[0, 0], [1, 0]]]
[[[0, 1], [1, 0]], [[0, 0], [1, 1]]]
[[[0, 1], [1, 0]], [[0, 1], [0, 0]]]
[[[0, 1], [1, 0]], [[0, 1], [0, 1]]]
[[[0, 1], [1, 0]], [[0, 1], [1, 0]]]
[[[0, 1], [1, 0]], [[0, 1], [1, 1]]]
[[[0, 1], [1, 0]], [[1, 0], [0, 0]]]
[[[0, 1], [1, 0]], [[1, 0], [0, 1]]]
[[[0, 1], [1, 0]], [[1, 0], [1, 0]]]
[[[0, 1], [1, 0]], [[1, 0], [1, 1]]]
[[[0, 1], [1, 0]], [[1, 1], [0, 0]]]
[[[0, 1], [1, 0]], [[1, 1], [0, 1]]]
[[[0, 1], [1, 0]], [[1, 1], [1, 0]]]
[[[0, 1], [1, 0]], [[1, 1], [1, 1]]]
[[[0, 1], [1, 1]], [[0, 0], [0, 0]]]
[[[0, 1], [1, 1]], [[0, 0], [0, 1]]]
[[[0, 1], [1, 1]], [[0, 0], [1, 0]]]
[[[0, 1], [1, 1]], [[0, 0], [1, 1]]]
[[[0, 1], [1, 1]], [[0, 1], [0, 0]]]
[[[0, 1], [1, 1]], [[0, 1], [0, 1]]]
[[[0, 1], [1, 1]], [[0, 1], [1, 0]]]
[[[0, 1], [1, 1]], [[0, 1], [1, 1]]]
[[[0, 1], [1, 1]], [[1, 0], [0, 0]]]
[[[0, 1], [1, 1]], [[1, 0], [0, 1]]]
[[[0, 1], [1, 1]], [[1, 0], [1, 0]]]
[[[0, 1], [1, 1]], [[1, 0], [1, 1]]]
[[[0, 1], [1, 1]], [[1, 1], [0, 0]]]
[[[0, 1], [1, 1]], [[1, 1], [0, 1]]]
[[[0, 1], [1, 1]], [[1, 1], [1, 0]]]
[[[0, 1], [1, 1]], [[1, 1], [1, 1]]]
[[[1, 0], [0, 0]], [[0, 0], [0, 0]]]
[[[1, 0], [0, 0]], [[0, 0], [0, 1]]]
[[[1, 0], [0, 0]], [[0, 0], [1, 0]]]
[[[1, 0], [0, 0]], [[0, 0], [1, 1]]]
[[[1, 0], [0, 0]], [[0, 1], [0, 0]]]
[[[1, 0], [0, 0]], [[0, 1], [0, 1]]]
[[[1, 0], [0, 0]], [[0, 1], [1, 0]]]
[[[1, 0], [0, 0]], [[0, 1], [1, 1]]]
[[[1, 0], [0, 0]], [[1, 0], [0, 0]]]
[[[1, 0], [0, 0]], [[1, 0], [0, 1]]]
[[[1, 0], [0, 0]], [[1, 0], [1, 0]]]
[[[1, 0], [0, 0]], [[1, 0], [1, 1]]]
[[[1, 0], [0, 0]], [[1, 1], [0, 0]]]
[[[1, 0], [0, 0]], [[1, 1], [0, 1]]]
[[[1, 0], [0, 0]], [[1, 1], [1, 0]]]
[[[1, 0], [0, 0]], [[1, 1], [1, 1]]]
[[[1, 0], [0, 1]], [[0, 0], [0, 0]]]
[[[1, 0], [0, 1]], [[0, 0], [0, 1]]]
[[[1, 0], [0, 1]], [[0, 0], [1, 0]]]
[[[1, 0], [0, 1]], [[0, 0], [1, 1]]]
[[[1, 0], [0, 1]], [[0, 1], [0, 0]]]
[[[1, 0], [0, 1]], [[0, 1], [0, 1]]]
[[[1, 0], [0, 1]], [[0, 1], [1, 0]]]
[[[1, 0], [0, 1]], [[0, 1], [1, 1]]]
[[[1, 0], [0, 1]], [[1, 0], [0, 0]]]
[[[1, 0], [0, 1]], [[1, 0], [0, 1]]]
[[[1, 0], [0, 1]], [[1, 0], [1, 0]]]
[[[1, 0], [0, 1]], [[1, 0], [1, 1]]]
[[[1, 0], [0, 1]], [[1, 1], [0, 0]]]
[[[1, 0], [0, 1]], [[1, 1], [0, 1]]]
[[[1, 0], [0, 1]], [[1, 1], [1, 0]]]
[[[1, 0], [0, 1]], [[1, 1], [1, 1]]]
[[[1, 0], [1, 0]], [[0, 0], [0, 0]]]
[[[1, 0], [1, 0]], [[0, 0], [0, 1]]]
[[[1, 0], [1, 0]], [[0, 0], [1, 0]]]
[[[1, 0], [1, 0]], [[0, 0], [1, 1]]]
[[[1, 0], [1, 0]], [[0, 1], [0, 0]]]
[[[1, 0], [1, 0]], [[0, 1], [0, 1]]]
[[[1, 0], [1, 0]], [[0, 1], [1, 0]]]
[[[1, 0], [1, 0]], [[0, 1], [1, 1]]]
[[[1, 0], [1, 0]], [[1, 0], [0, 0]]]
[[[1, 0], [1, 0]], [[1, 0], [0, 1]]]
[[[1, 0], [1, 0]], [[1, 0], [1, 0]]]
[[[1, 0], [1, 0]], [[1, 0], [1, 1]]]
[[[1, 0], [1, 0]], [[1, 1], [0, 0]]]
[[[1, 0], [1, 0]], [[1, 1], [0, 1]]]
[[[1, 0], [1, 0]], [[1, 1], [1, 0]]]
[[[1, 0], [1, 0]], [[1, 1], [1, 1]]]
[[[1, 0], [1, 1]], [[0, 0], [0, 0]]]
[[[1, 0], [1, 1]], [[0, 0], [0, 1]]]
[[[1, 0], [1, 1]], [[0, 0], [1, 0]]]
[[[1, 0], [1, 1]], [[0, 0], [1, 1]]]
[[[1, 0], [1, 1]], [[0, 1], [0, 0]]]
[[[1, 0], [1, 1]], [[0, 1], [0, 1]]]
[[[1, 0], [1, 1]], [[0, 1], [1, 0]]]
[[[1, 0], [1, 1]], [[0, 1], [1, 1]]]
[[[1, 0], [1, 1]], [[1, 0], [0, 0]]]
[[[1, 0], [1, 1]], [[1, 0], [0, 1]]]
[[[1, 0], [1, 1]], [[1, 0], [1, 0]]]
[[[1, 0], [1, 1]], [[1, 0], [1, 1]]]
[[[1, 0], [1, 1]], [[1, 1], [0, 0]]]
[[[1, 0], [1, 1]], [[1, 1], [0, 1]]]
[[[1, 0], [1, 1]], [[1, 1], [1, 0]]]
[[[1, 0], [1, 1]], [[1, 1], [1, 1]]]
[[[1, 1], [0, 0]], [[0, 0], [0, 0]]]
[[[1, 1], [0, 0]], [[0, 0], [0, 1]]]
[[[1, 1], [0, 0]], [[0, 0], [1, 0]]]
[[[1, 1], [0, 0]], [[0, 0], [1, 1]]]
[[[1, 1], [0, 0]], [[0, 1], [0, 0]]]
[[[1, 1], [0, 0]], [[0, 1], [0, 1]]]
[[[1, 1], [0, 0]], [[0, 1], [1, 0]]]
[[[1, 1], [0, 0]], [[0, 1], [1, 1]]]
[[[1, 1], [0, 0]], [[1, 0], [0, 0]]]
[[[1, 1], [0, 0]], [[1, 0], [0, 1]]]
[[[1, 1], [0, 0]], [[1, 0], [1, 0]]]
[[[1, 1], [0, 0]], [[1, 0], [1, 1]]]
[[[1, 1], [0, 0]], [[1, 1], [0, 0]]]
[[[1, 1], [0, 0]], [[1, 1], [0, 1]]]
[[[1, 1], [0, 0]], [[1, 1], [1, 0]]]
[[[1, 1], [0, 0]], [[1, 1], [1, 1]]]
[[[1, 1], [0, 1]], [[0, 0], [0, 0]]]
[[[1, 1], [0, 1]], [[0, 0], [0, 1]]]
[[[1, 1], [0, 1]], [[0, 0], [1, 0]]]
[[[1, 1], [0, 1]], [[0, 0], [1, 1]]]
[[[1, 1], [0, 1]], [[0, 1], [0, 0]]]
[[[1, 1], [0, 1]], [[0, 1], [0, 1]]]
[[[1, 1], [0, 1]], [[0, 1], [1, 0]]]
[[[1, 1], [0, 1]], [[0, 1], [1, 1]]]
[[[1, 1], [0, 1]], [[1, 0], [0, 0]]]
[[[1, 1], [0, 1]], [[1, 0], [0, 1]]]
[[[1, 1], [0, 1]], [[1, 0], [1, 0]]]
[[[1, 1], [0, 1]], [[1, 0], [1, 1]]]
[[[1, 1], [0, 1]], [[1, 1], [0, 0]]]
[[[1, 1], [0, 1]], [[1, 1], [0, 1]]]
[[[1, 1], [0, 1]], [[1, 1], [1, 0]]]
[[[1, 1], [0, 1]], [[1, 1], [1, 1]]]
[[[1, 1], [1, 0]], [[0, 0], [0, 0]]]
[[[1, 1], [1, 0]], [[0, 0], [0, 1]]]
[[[1, 1], [1, 0]], [[0, 0], [1, 0]]]
[[[1, 1], [1, 0]], [[0, 0], [1, 1]]]
[[[1, 1], [1, 0]], [[0, 1], [0, 0]]]
[[[1, 1], [1, 0]], [[0, 1], [0, 1]]]
[[[1, 1], [1, 0]], [[0, 1], [1, 0]]]
[[[1, 1], [1, 0]], [[0, 1], [1, 1]]]
[[[1, 1], [1, 0]], [[1, 0], [0, 0]]]
[[[1, 1], [1, 0]], [[1, 0], [0, 1]]]
[[[1, 1], [1, 0]], [[1, 0], [1, 0]]]
[[[1, 1], [1, 0]], [[1, 0], [1, 1]]]
[[[1, 1], [1, 0]], [[1, 1], [0, 0]]]
[[[1, 1], [1, 0]], [[1, 1], [0, 1]]]
[[[1, 1], [1, 0]], [[1, 1], [1, 0]]]
[[[1, 1], [1, 0]], [[1, 1], [1, 1]]]
[[[1, 1], [1, 1]], [[0, 0], [0, 0]]]
[[[1, 1], [1, 1]], [[0, 0], [0, 1]]]
[[[1, 1], [1, 1]], [[0, 0], [1, 0]]]
[[[1, 1], [1, 1]], [[0, 0], [1, 1]]]
[[[1, 1], [1, 1]], [[0, 1], [0, 0]]]
[[[1, 1], [1, 1]], [[0, 1], [0, 1]]]
[[[1, 1], [1, 1]], [[0, 1], [1, 0]]]
[[[1, 1], [1, 1]], [[0, 1], [1, 1]]]
[[[1, 1], [1, 1]], [[1, 0], [0, 0]]]
[[[1, 1], [1, 1]], [[1, 0], [0, 1]]]
[[[1, 1], [1, 1]], [[1, 0], [1, 0]]]
[[[1, 1], [1, 1]], [[1, 0], [1, 1]]]
[[[1, 1], [1, 1]], [[1, 1], [0, 0]]]
[[[1, 1], [1, 1]], [[1, 1], [0, 1]]]
[[[1, 1], [1, 1]], [[1, 1], [1, 0]]]
[[[1, 1], [1, 1]], [[1, 1], [1, 1]]]

endloop

endloop

endloop
