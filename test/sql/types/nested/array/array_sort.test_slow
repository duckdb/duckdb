# name: test/sql/types/nested/array/array_sort.test_slow
# group: [array]

statement ok
PRAGMA enable_verification

statement ok
PRAGMA verify_external

query I
SELECT array_value(i -1, i, i + 1) FROM range(4,1,-1) as r(i) ORDER BY 1 DESC;
----
[3, 4, 5]
[2, 3, 4]
[1, 2, 3]

query I
SELECT array_value(i -1, i, i + 1) FROM range(4,1,-1) as r(i) ORDER BY 1 ASC;
----
[1, 2, 3]
[2, 3, 4]
[3, 4, 5]

# Try with larger arrays (more than 1 byte of validity data)
query I
SELECT * FROM (VALUES (array_value(0,1,2,3,4,NULL,6,7,8,9)), (array_value(10,11,NULL,13,14,15,16,17,NULL,19))) ORDER BY 1 ASC;
----
[0, 1, 2, 3, 4, NULL, 6, 7, 8, 9]
[10, 11, NULL, 13, 14, 15, 16, 17, NULL, 19]


query I
SELECT * FROM (VALUES (array_value(0,1,2,3,4,NULL,6,7,8,9)), (array_value(10,11,NULL,13,14,15,16,17,NULL,19))) ORDER BY 1 DESC
----
[10, 11, NULL, 13, 14, 15, 16, 17, NULL, 19]
[0, 1, 2, 3, 4, NULL, 6, 7, 8, 9]


query I
SELECT * FROM (VALUES (array_value(0,1,2,NULL)), (array_value(10,11,NULL,13))) ORDER BY 1 ASC;
----
[0, 1, 2, NULL]
[10, 11, NULL, 13]

# (make sure we didnt break struct validity)
query I
SELECT * FROM (VALUES ({a: 0, b: 1, c: 2, d: NULL}), ({a: 10, b: 11, c: NULL, d: 13})) ORDER BY 1 ASC;
----
{'a': 0, 'b': 1, 'c': 2, 'd': NULL}
{'a': 10, 'b': 11, 'c': NULL, 'd': 13}



# Nested larger array sorting
query I
SELECT * FROM (VALUES
		(array_value(array_value(0,1,2,3,4,NULL,6,7,8,9), array_value(10,11,NULL,13,14,15,16,17,NULL,19))),
		(array_value(NULL, NULL)),
		(array_value(NULL, array_value(20,21,22,23,24,NULL,26,27,28,29))),
		(NULL),
		(array_value(array_value(20,21,22,23,24,NULL,26,27,28,29), array_value(30,31,NULL,33,34,35,36,37,NULL,39)))
) ORDER BY 1 ASC;
----
[[0, 1, 2, 3, 4, NULL, 6, 7, 8, 9], [10, 11, NULL, 13, 14, 15, 16, 17, NULL, 19]]
[[20, 21, 22, 23, 24, NULL, 26, 27, 28, 29], [30, 31, NULL, 33, 34, 35, 36, 37, NULL, 39]]
[NULL, [20, 21, 22, 23, 24, NULL, 26, 27, 28, 29]]
[NULL, NULL]
NULL


# Nested sorting
# Test combinations of array/list nesting (up to 3 levels)

foreach COLLECTION_OUTER array_value list_value

foreach COLLECTION_MIDDLE array_value list_value

foreach COLLECTION_INNER array_value list_value

query I
WITH
	a(i) AS (SELECT * FROM range(0,2)),
	b(i) AS (SELECT ${COLLECTION_INNER}(a1.i, a2.i) FROM a as a1, a as a2),
	c(i) AS (SELECT ${COLLECTION_MIDDLE}(b1.i, b2.i) FROM b as b1, b as b2)
SELECT ${COLLECTION_OUTER}(c1.i, c2.i) FROM c as c1, c as c2
ORDER BY 1 ASC;
----
[[[0, 0], [0, 0]], [[0, 0], [0, 0]]]
[[[0, 0], [0, 0]], [[0, 0], [0, 1]]]
[[[0, 0], [0, 0]], [[0, 0], [1, 0]]]
[[[0, 0], [0, 0]], [[0, 0], [1, 1]]]
[[[0, 0], [0, 0]], [[0, 1], [0, 0]]]
[[[0, 0], [0, 0]], [[0, 1], [0, 1]]]
[[[0, 0], [0, 0]], [[0, 1], [1, 0]]]
[[[0, 0], [0, 0]], [[0, 1], [1, 1]]]
[[[0, 0], [0, 0]], [[1, 0], [0, 0]]]
[[[0, 0], [0, 0]], [[1, 0], [0, 1]]]
[[[0, 0], [0, 0]], [[1, 0], [1, 0]]]
[[[0, 0], [0, 0]], [[1, 0], [1, 1]]]
[[[0, 0], [0, 0]], [[1, 1], [0, 0]]]
[[[0, 0], [0, 0]], [[1, 1], [0, 1]]]
[[[0, 0], [0, 0]], [[1, 1], [1, 0]]]
[[[0, 0], [0, 0]], [[1, 1], [1, 1]]]
[[[0, 0], [0, 1]], [[0, 0], [0, 0]]]
[[[0, 0], [0, 1]], [[0, 0], [0, 1]]]
[[[0, 0], [0, 1]], [[0, 0], [1, 0]]]
[[[0, 0], [0, 1]], [[0, 0], [1, 1]]]
[[[0, 0], [0, 1]], [[0, 1], [0, 0]]]
[[[0, 0], [0, 1]], [[0, 1], [0, 1]]]
[[[0, 0], [0, 1]], [[0, 1], [1, 0]]]
[[[0, 0], [0, 1]], [[0, 1], [1, 1]]]
[[[0, 0], [0, 1]], [[1, 0], [0, 0]]]
[[[0, 0], [0, 1]], [[1, 0], [0, 1]]]
[[[0, 0], [0, 1]], [[1, 0], [1, 0]]]
[[[0, 0], [0, 1]], [[1, 0], [1, 1]]]
[[[0, 0], [0, 1]], [[1, 1], [0, 0]]]
[[[0, 0], [0, 1]], [[1, 1], [0, 1]]]
[[[0, 0], [0, 1]], [[1, 1], [1, 0]]]
[[[0, 0], [0, 1]], [[1, 1], [1, 1]]]
[[[0, 0], [1, 0]], [[0, 0], [0, 0]]]
[[[0, 0], [1, 0]], [[0, 0], [0, 1]]]
[[[0, 0], [1, 0]], [[0, 0], [1, 0]]]
[[[0, 0], [1, 0]], [[0, 0], [1, 1]]]
[[[0, 0], [1, 0]], [[0, 1], [0, 0]]]
[[[0, 0], [1, 0]], [[0, 1], [0, 1]]]
[[[0, 0], [1, 0]], [[0, 1], [1, 0]]]
[[[0, 0], [1, 0]], [[0, 1], [1, 1]]]
[[[0, 0], [1, 0]], [[1, 0], [0, 0]]]
[[[0, 0], [1, 0]], [[1, 0], [0, 1]]]
[[[0, 0], [1, 0]], [[1, 0], [1, 0]]]
[[[0, 0], [1, 0]], [[1, 0], [1, 1]]]
[[[0, 0], [1, 0]], [[1, 1], [0, 0]]]
[[[0, 0], [1, 0]], [[1, 1], [0, 1]]]
[[[0, 0], [1, 0]], [[1, 1], [1, 0]]]
[[[0, 0], [1, 0]], [[1, 1], [1, 1]]]
[[[0, 0], [1, 1]], [[0, 0], [0, 0]]]
[[[0, 0], [1, 1]], [[0, 0], [0, 1]]]
[[[0, 0], [1, 1]], [[0, 0], [1, 0]]]
[[[0, 0], [1, 1]], [[0, 0], [1, 1]]]
[[[0, 0], [1, 1]], [[0, 1], [0, 0]]]
[[[0, 0], [1, 1]], [[0, 1], [0, 1]]]
[[[0, 0], [1, 1]], [[0, 1], [1, 0]]]
[[[0, 0], [1, 1]], [[0, 1], [1, 1]]]
[[[0, 0], [1, 1]], [[1, 0], [0, 0]]]
[[[0, 0], [1, 1]], [[1, 0], [0, 1]]]
[[[0, 0], [1, 1]], [[1, 0], [1, 0]]]
[[[0, 0], [1, 1]], [[1, 0], [1, 1]]]
[[[0, 0], [1, 1]], [[1, 1], [0, 0]]]
[[[0, 0], [1, 1]], [[1, 1], [0, 1]]]
[[[0, 0], [1, 1]], [[1, 1], [1, 0]]]
[[[0, 0], [1, 1]], [[1, 1], [1, 1]]]
[[[0, 1], [0, 0]], [[0, 0], [0, 0]]]
[[[0, 1], [0, 0]], [[0, 0], [0, 1]]]
[[[0, 1], [0, 0]], [[0, 0], [1, 0]]]
[[[0, 1], [0, 0]], [[0, 0], [1, 1]]]
[[[0, 1], [0, 0]], [[0, 1], [0, 0]]]
[[[0, 1], [0, 0]], [[0, 1], [0, 1]]]
[[[0, 1], [0, 0]], [[0, 1], [1, 0]]]
[[[0, 1], [0, 0]], [[0, 1], [1, 1]]]
[[[0, 1], [0, 0]], [[1, 0], [0, 0]]]
[[[0, 1], [0, 0]], [[1, 0], [0, 1]]]
[[[0, 1], [0, 0]], [[1, 0], [1, 0]]]
[[[0, 1], [0, 0]], [[1, 0], [1, 1]]]
[[[0, 1], [0, 0]], [[1, 1], [0, 0]]]
[[[0, 1], [0, 0]], [[1, 1], [0, 1]]]
[[[0, 1], [0, 0]], [[1, 1], [1, 0]]]
[[[0, 1], [0, 0]], [[1, 1], [1, 1]]]
[[[0, 1], [0, 1]], [[0, 0], [0, 0]]]
[[[0, 1], [0, 1]], [[0, 0], [0, 1]]]
[[[0, 1], [0, 1]], [[0, 0], [1, 0]]]
[[[0, 1], [0, 1]], [[0, 0], [1, 1]]]
[[[0, 1], [0, 1]], [[0, 1], [0, 0]]]
[[[0, 1], [0, 1]], [[0, 1], [0, 1]]]
[[[0, 1], [0, 1]], [[0, 1], [1, 0]]]
[[[0, 1], [0, 1]], [[0, 1], [1, 1]]]
[[[0, 1], [0, 1]], [[1, 0], [0, 0]]]
[[[0, 1], [0, 1]], [[1, 0], [0, 1]]]
[[[0, 1], [0, 1]], [[1, 0], [1, 0]]]
[[[0, 1], [0, 1]], [[1, 0], [1, 1]]]
[[[0, 1], [0, 1]], [[1, 1], [0, 0]]]
[[[0, 1], [0, 1]], [[1, 1], [0, 1]]]
[[[0, 1], [0, 1]], [[1, 1], [1, 0]]]
[[[0, 1], [0, 1]], [[1, 1], [1, 1]]]
[[[0, 1], [1, 0]], [[0, 0], [0, 0]]]
[[[0, 1], [1, 0]], [[0, 0], [0, 1]]]
[[[0, 1], [1, 0]], [[0, 0], [1, 0]]]
[[[0, 1], [1, 0]], [[0, 0], [1, 1]]]
[[[0, 1], [1, 0]], [[0, 1], [0, 0]]]
[[[0, 1], [1, 0]], [[0, 1], [0, 1]]]
[[[0, 1], [1, 0]], [[0, 1], [1, 0]]]
[[[0, 1], [1, 0]], [[0, 1], [1, 1]]]
[[[0, 1], [1, 0]], [[1, 0], [0, 0]]]
[[[0, 1], [1, 0]], [[1, 0], [0, 1]]]
[[[0, 1], [1, 0]], [[1, 0], [1, 0]]]
[[[0, 1], [1, 0]], [[1, 0], [1, 1]]]
[[[0, 1], [1, 0]], [[1, 1], [0, 0]]]
[[[0, 1], [1, 0]], [[1, 1], [0, 1]]]
[[[0, 1], [1, 0]], [[1, 1], [1, 0]]]
[[[0, 1], [1, 0]], [[1, 1], [1, 1]]]
[[[0, 1], [1, 1]], [[0, 0], [0, 0]]]
[[[0, 1], [1, 1]], [[0, 0], [0, 1]]]
[[[0, 1], [1, 1]], [[0, 0], [1, 0]]]
[[[0, 1], [1, 1]], [[0, 0], [1, 1]]]
[[[0, 1], [1, 1]], [[0, 1], [0, 0]]]
[[[0, 1], [1, 1]], [[0, 1], [0, 1]]]
[[[0, 1], [1, 1]], [[0, 1], [1, 0]]]
[[[0, 1], [1, 1]], [[0, 1], [1, 1]]]
[[[0, 1], [1, 1]], [[1, 0], [0, 0]]]
[[[0, 1], [1, 1]], [[1, 0], [0, 1]]]
[[[0, 1], [1, 1]], [[1, 0], [1, 0]]]
[[[0, 1], [1, 1]], [[1, 0], [1, 1]]]
[[[0, 1], [1, 1]], [[1, 1], [0, 0]]]
[[[0, 1], [1, 1]], [[1, 1], [0, 1]]]
[[[0, 1], [1, 1]], [[1, 1], [1, 0]]]
[[[0, 1], [1, 1]], [[1, 1], [1, 1]]]
[[[1, 0], [0, 0]], [[0, 0], [0, 0]]]
[[[1, 0], [0, 0]], [[0, 0], [0, 1]]]
[[[1, 0], [0, 0]], [[0, 0], [1, 0]]]
[[[1, 0], [0, 0]], [[0, 0], [1, 1]]]
[[[1, 0], [0, 0]], [[0, 1], [0, 0]]]
[[[1, 0], [0, 0]], [[0, 1], [0, 1]]]
[[[1, 0], [0, 0]], [[0, 1], [1, 0]]]
[[[1, 0], [0, 0]], [[0, 1], [1, 1]]]
[[[1, 0], [0, 0]], [[1, 0], [0, 0]]]
[[[1, 0], [0, 0]], [[1, 0], [0, 1]]]
[[[1, 0], [0, 0]], [[1, 0], [1, 0]]]
[[[1, 0], [0, 0]], [[1, 0], [1, 1]]]
[[[1, 0], [0, 0]], [[1, 1], [0, 0]]]
[[[1, 0], [0, 0]], [[1, 1], [0, 1]]]
[[[1, 0], [0, 0]], [[1, 1], [1, 0]]]
[[[1, 0], [0, 0]], [[1, 1], [1, 1]]]
[[[1, 0], [0, 1]], [[0, 0], [0, 0]]]
[[[1, 0], [0, 1]], [[0, 0], [0, 1]]]
[[[1, 0], [0, 1]], [[0, 0], [1, 0]]]
[[[1, 0], [0, 1]], [[0, 0], [1, 1]]]
[[[1, 0], [0, 1]], [[0, 1], [0, 0]]]
[[[1, 0], [0, 1]], [[0, 1], [0, 1]]]
[[[1, 0], [0, 1]], [[0, 1], [1, 0]]]
[[[1, 0], [0, 1]], [[0, 1], [1, 1]]]
[[[1, 0], [0, 1]], [[1, 0], [0, 0]]]
[[[1, 0], [0, 1]], [[1, 0], [0, 1]]]
[[[1, 0], [0, 1]], [[1, 0], [1, 0]]]
[[[1, 0], [0, 1]], [[1, 0], [1, 1]]]
[[[1, 0], [0, 1]], [[1, 1], [0, 0]]]
[[[1, 0], [0, 1]], [[1, 1], [0, 1]]]
[[[1, 0], [0, 1]], [[1, 1], [1, 0]]]
[[[1, 0], [0, 1]], [[1, 1], [1, 1]]]
[[[1, 0], [1, 0]], [[0, 0], [0, 0]]]
[[[1, 0], [1, 0]], [[0, 0], [0, 1]]]
[[[1, 0], [1, 0]], [[0, 0], [1, 0]]]
[[[1, 0], [1, 0]], [[0, 0], [1, 1]]]
[[[1, 0], [1, 0]], [[0, 1], [0, 0]]]
[[[1, 0], [1, 0]], [[0, 1], [0, 1]]]
[[[1, 0], [1, 0]], [[0, 1], [1, 0]]]
[[[1, 0], [1, 0]], [[0, 1], [1, 1]]]
[[[1, 0], [1, 0]], [[1, 0], [0, 0]]]
[[[1, 0], [1, 0]], [[1, 0], [0, 1]]]
[[[1, 0], [1, 0]], [[1, 0], [1, 0]]]
[[[1, 0], [1, 0]], [[1, 0], [1, 1]]]
[[[1, 0], [1, 0]], [[1, 1], [0, 0]]]
[[[1, 0], [1, 0]], [[1, 1], [0, 1]]]
[[[1, 0], [1, 0]], [[1, 1], [1, 0]]]
[[[1, 0], [1, 0]], [[1, 1], [1, 1]]]
[[[1, 0], [1, 1]], [[0, 0], [0, 0]]]
[[[1, 0], [1, 1]], [[0, 0], [0, 1]]]
[[[1, 0], [1, 1]], [[0, 0], [1, 0]]]
[[[1, 0], [1, 1]], [[0, 0], [1, 1]]]
[[[1, 0], [1, 1]], [[0, 1], [0, 0]]]
[[[1, 0], [1, 1]], [[0, 1], [0, 1]]]
[[[1, 0], [1, 1]], [[0, 1], [1, 0]]]
[[[1, 0], [1, 1]], [[0, 1], [1, 1]]]
[[[1, 0], [1, 1]], [[1, 0], [0, 0]]]
[[[1, 0], [1, 1]], [[1, 0], [0, 1]]]
[[[1, 0], [1, 1]], [[1, 0], [1, 0]]]
[[[1, 0], [1, 1]], [[1, 0], [1, 1]]]
[[[1, 0], [1, 1]], [[1, 1], [0, 0]]]
[[[1, 0], [1, 1]], [[1, 1], [0, 1]]]
[[[1, 0], [1, 1]], [[1, 1], [1, 0]]]
[[[1, 0], [1, 1]], [[1, 1], [1, 1]]]
[[[1, 1], [0, 0]], [[0, 0], [0, 0]]]
[[[1, 1], [0, 0]], [[0, 0], [0, 1]]]
[[[1, 1], [0, 0]], [[0, 0], [1, 0]]]
[[[1, 1], [0, 0]], [[0, 0], [1, 1]]]
[[[1, 1], [0, 0]], [[0, 1], [0, 0]]]
[[[1, 1], [0, 0]], [[0, 1], [0, 1]]]
[[[1, 1], [0, 0]], [[0, 1], [1, 0]]]
[[[1, 1], [0, 0]], [[0, 1], [1, 1]]]
[[[1, 1], [0, 0]], [[1, 0], [0, 0]]]
[[[1, 1], [0, 0]], [[1, 0], [0, 1]]]
[[[1, 1], [0, 0]], [[1, 0], [1, 0]]]
[[[1, 1], [0, 0]], [[1, 0], [1, 1]]]
[[[1, 1], [0, 0]], [[1, 1], [0, 0]]]
[[[1, 1], [0, 0]], [[1, 1], [0, 1]]]
[[[1, 1], [0, 0]], [[1, 1], [1, 0]]]
[[[1, 1], [0, 0]], [[1, 1], [1, 1]]]
[[[1, 1], [0, 1]], [[0, 0], [0, 0]]]
[[[1, 1], [0, 1]], [[0, 0], [0, 1]]]
[[[1, 1], [0, 1]], [[0, 0], [1, 0]]]
[[[1, 1], [0, 1]], [[0, 0], [1, 1]]]
[[[1, 1], [0, 1]], [[0, 1], [0, 0]]]
[[[1, 1], [0, 1]], [[0, 1], [0, 1]]]
[[[1, 1], [0, 1]], [[0, 1], [1, 0]]]
[[[1, 1], [0, 1]], [[0, 1], [1, 1]]]
[[[1, 1], [0, 1]], [[1, 0], [0, 0]]]
[[[1, 1], [0, 1]], [[1, 0], [0, 1]]]
[[[1, 1], [0, 1]], [[1, 0], [1, 0]]]
[[[1, 1], [0, 1]], [[1, 0], [1, 1]]]
[[[1, 1], [0, 1]], [[1, 1], [0, 0]]]
[[[1, 1], [0, 1]], [[1, 1], [0, 1]]]
[[[1, 1], [0, 1]], [[1, 1], [1, 0]]]
[[[1, 1], [0, 1]], [[1, 1], [1, 1]]]
[[[1, 1], [1, 0]], [[0, 0], [0, 0]]]
[[[1, 1], [1, 0]], [[0, 0], [0, 1]]]
[[[1, 1], [1, 0]], [[0, 0], [1, 0]]]
[[[1, 1], [1, 0]], [[0, 0], [1, 1]]]
[[[1, 1], [1, 0]], [[0, 1], [0, 0]]]
[[[1, 1], [1, 0]], [[0, 1], [0, 1]]]
[[[1, 1], [1, 0]], [[0, 1], [1, 0]]]
[[[1, 1], [1, 0]], [[0, 1], [1, 1]]]
[[[1, 1], [1, 0]], [[1, 0], [0, 0]]]
[[[1, 1], [1, 0]], [[1, 0], [0, 1]]]
[[[1, 1], [1, 0]], [[1, 0], [1, 0]]]
[[[1, 1], [1, 0]], [[1, 0], [1, 1]]]
[[[1, 1], [1, 0]], [[1, 1], [0, 0]]]
[[[1, 1], [1, 0]], [[1, 1], [0, 1]]]
[[[1, 1], [1, 0]], [[1, 1], [1, 0]]]
[[[1, 1], [1, 0]], [[1, 1], [1, 1]]]
[[[1, 1], [1, 1]], [[0, 0], [0, 0]]]
[[[1, 1], [1, 1]], [[0, 0], [0, 1]]]
[[[1, 1], [1, 1]], [[0, 0], [1, 0]]]
[[[1, 1], [1, 1]], [[0, 0], [1, 1]]]
[[[1, 1], [1, 1]], [[0, 1], [0, 0]]]
[[[1, 1], [1, 1]], [[0, 1], [0, 1]]]
[[[1, 1], [1, 1]], [[0, 1], [1, 0]]]
[[[1, 1], [1, 1]], [[0, 1], [1, 1]]]
[[[1, 1], [1, 1]], [[1, 0], [0, 0]]]
[[[1, 1], [1, 1]], [[1, 0], [0, 1]]]
[[[1, 1], [1, 1]], [[1, 0], [1, 0]]]
[[[1, 1], [1, 1]], [[1, 0], [1, 1]]]
[[[1, 1], [1, 1]], [[1, 1], [0, 0]]]
[[[1, 1], [1, 1]], [[1, 1], [0, 1]]]
[[[1, 1], [1, 1]], [[1, 1], [1, 0]]]
[[[1, 1], [1, 1]], [[1, 1], [1, 1]]]

endloop

endloop

endloop
