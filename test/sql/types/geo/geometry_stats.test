# name: test/sql/types/geo/geometry_stats.test
# group: [geo]

# Stats are not preserved when serialized in the stats() function, so this doesnt work
require no_alternative_verify

statement ok
create table t1(id INT, g GEOMETRY);

statement ok
insert into t1 values (0, 'POINT(0 0)'::GEOMETRY);

query IIIIIII
select s.extent, s.has_empty_geom, s.has_non_empty_geom, s.has_empty_part, s.has_non_empty_part, s.has_null, s.has_no_null from (select stats(g) s from t1 limit 1);
----
{'x_min': 0.0, 'x_max': 0.0, 'y_min': 0.0, 'y_max': 0.0}	false	true	false	true	false	true

statement ok
insert into t1 values (1, 'POINT(-2 2)'::GEOMETRY);

query IIIIIII
select s.extent, s.has_empty_geom, s.has_non_empty_geom, s.has_empty_part, s.has_non_empty_part, s.has_null, s.has_no_null from (select stats(g) s from t1 limit 1);
----
{'x_min': -2.0, 'x_max': 0.0, 'y_min': 0.0, 'y_max': 2.0}	false	true	false	true	false	true

statement ok
insert into t1 values (3, 'POINT(2 -2)'::GEOMETRY);

query IIIIIII
select s.extent, s.has_empty_geom, s.has_non_empty_geom, s.has_empty_part, s.has_non_empty_part, s.has_null, s.has_no_null from (select stats(g) s from t1 limit 1);
----
{'x_min': -2.0, 'x_max': 2.0, 'y_min': -2.0, 'y_max': 2.0}	false	true	false	true	false	true

# Insert Z-Value Geometry
statement ok
insert into t1 values (4, 'LINESTRING Z (0 0 0, 1 1 1, 2 2 2)'::GEOMETRY);

query IIIIIII
select s.extent, s.has_empty_geom, s.has_non_empty_geom, s.has_empty_part, s.has_non_empty_part, s.has_null, s.has_no_null from (select stats(g) s from t1 limit 1);
----
{'x_min': -2.0, 'x_max': 2.0, 'y_min': -2.0, 'y_max': 2.0, 'z_min': 0.0, 'z_max': 2.0}	false	true	false	true	false	true

# Insert M-Value Geometry
statement ok
insert into t1 values (5, 'POLYGON M ((0 0 2, 4 0 2, 4 4 2, 0 4 2, 0 0 2))'::GEOMETRY);

query IIIIIII
select s.extent, s.has_empty_geom, s.has_non_empty_geom, s.has_empty_part, s.has_non_empty_part, s.has_null, s.has_no_null from (select stats(g) s from t1 limit 1);
----
{'x_min': -2.0, 'x_max': 4.0, 'y_min': -2.0, 'y_max': 4.0, 'z_min': 0.0, 'z_max': 2.0, 'm_min': 2.0, 'm_max': 2.0}	false	true	false	true	false	true

# Insert ZM-Value Geometry
statement ok
insert into t1 values (6, 'MULTILINESTRING ZM ((0 0 -10 10, 1 1 -10 10), (2 2 2 1, 3 3 3 1))'::GEOMETRY);

query IIIIIII
select s.extent, s.has_empty_geom, s.has_non_empty_geom, s.has_empty_part, s.has_non_empty_part, s.has_null, s.has_no_null from (select stats(g) s from t1 limit 1);
----
{'x_min': -2.0, 'x_max': 4.0, 'y_min': -2.0, 'y_max': 4.0, 'z_min': -10.0, 'z_max': 3.0, 'm_min': 1.0, 'm_max': 10.0}	false	true	false	true	false	true
