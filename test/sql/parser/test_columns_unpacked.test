# name: test/sql/parser/test_columns_unpacked.test
# group: [parser]

query I
select COALESCE(*COLUMNS(*)) from (select NULL, 2, 3) t(a, b, c);
----
2

query I
select column_name from (describe select COALESCE(*COLUMNS(*)) from (select NULL, 2, 3) t(a, b, c));
----
COALESCE(t.a, t.b, t.c)

# Aliasing the result
query I
select column_name from (describe select COALESCE(*COLUMNS(*)) as a from (select NULL, 2, 3) t(a, b, c));
----
a

statement ok
create table contains_test as select '123abc234' a, 4 b, 'abc' c;

# Feed columns a and c into contains, equivalent to contains(a, c)
query I
select contains(*COLUMNS('[a|c]')) from contains_test;
----
true

# COLUMNS and *COLUMNS are equivalent as a root expression
query II
select COLUMNS('[a|c]') from contains_test;
----
123abc234	abc

query II
select *COLUMNS('[a|c]') from contains_test;
----
123abc234	abc

statement ok
create table sales as from ( values
	(150, '2017/06/12'::DATE, 3),
	(125, '2017/08/29'::DATE, 2),
	(175, '2017/06/12'::DATE, 4),
) t(amount, date, priority)

query I
SELECT first(amount ORDER BY date ASC, priority DESC) FROM sales;
----
175

# TODO: this could be supported
statement error
select first(amount ORDER BY *COLUMNS('date|priority') ASC) from sales;
----
*COLUMNS(...) is not supported in the order expression

# Using a lambda in *COLUMNS
query I
select COALESCE(*COLUMNS(c -> c in ('a', 'c'))) from (select NULL, 2, 3) t(a, b, c);
----
3

# IN (...)
query I
select 2 in (*COLUMNS(*)) from (select 1, 2, 3) t(a, b, c);
----
true

# IN in WHERE clause
query III
from (VALUES (1, 2, 3), (2, 3, 0), (0, 0, 1)) tbl(a, b, c) where 1 IN (*COLUMNS(*));
----
1	2	3
0	0	1
