# name: test/sql/expressions/test_try_filter_doesnt_mutate_columns.test
# description: Test to ensure TRY inside a filter does not mutate the output data
# group: [filter]

# Reproduction of the bug
statement ok
PRAGMA enable_verification;

statement ok
CREATE TABLE t0(c0 INT, c1 INT);

statement ok
INSERT INTO t0(c0, c1) VALUES (1819832341, -2039202523);

statement ok
INSERT INTO t0(c0) VALUES (517438920);

# Filter using TRY in the WHERE clause, WHERE must not mutate c1
query II
SELECT t0.c1, t0.c0
FROM t0
WHERE TRY(t0.c1 - t0.c0) IS NULL
ORDER BY t0.c0;
----
NULL	517438920
-2039202523	1819832341

# Additional test cases for multiple rows and non-NULL TRY

statement ok
CREATE TABLE t1(c0 INT, c1 INT);

statement ok
INSERT INTO t1 VALUES (10, 5);

statement ok
INSERT INTO t1 VALUES (NULL, 3);

statement ok
INSERT INTO t1 VALUES (20, NULL);

statement ok
INSERT INTO t1 VALUES (30, 1000000000);

# Rows where TRY(c1 - c0) IS NULL (due to NULLs)
query II
SELECT c0, c1
FROM t1
WHERE TRY(c1 - c0) IS NULL
ORDER BY c0 NULLS LAST;
----
20	NULL
NULL	3

# Rows where TRY(c1 - c0) IS NOT NULL, values must remain unchanged
query III
SELECT c0, c1, TRY(c1 - c0)
FROM t1
WHERE TRY(c1 - c0) IS NOT NULL
ORDER BY c0;
----
10	5	-5
30	1000000000	999999970
