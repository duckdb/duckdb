# name: test/sql/topn/tpcds_q14_topn.test
# description: Test Top N on TPC-DS SF1
# group: [topn]

statement ok
PRAGMA enable_verification

statement ok
CREATE TABLE final(channel VARCHAR, i_brand_id INTEGER, i_class_id INTEGER, i_category_id INTEGER, sum_sales DECIMAL(38,2), number_sales HUGEINT);

statement ok
COPY final FROM 'data/csv/tpcds_14.csv' (FORMAT CSV, DELIMITER '|', HEADER);

query IIIIII
SELECT * FROM final
ORDER BY channel NULLS FIRST,
         i_brand_id NULLS FIRST,
         i_class_id NULLS FIRST,
         i_category_id NULLS FIRST
LIMIT 100;
----
NULL	NULL	NULL	NULL	7014662.98	160443
catalog	NULL	NULL	NULL	2365617.61	46750
catalog	1001001	NULL	NULL	15639.61	347
catalog	1001001	1	NULL	7537.03	167
catalog	1001001	1	1	868.60	20
catalog	1001001	1	2	1126.88	27
catalog	1001001	1	3	68.52	3
catalog	1001001	1	4	1210.00	23
catalog	1001001	1	5	1093.30	25
catalog	1001001	1	6	52.48	3
catalog	1001001	1	7	452.95	9
catalog	1001001	1	8	712.10	13
catalog	1001001	1	9	1053.72	21
catalog	1001001	1	10	898.48	23
catalog	1001001	2	NULL	1542.32	25
catalog	1001001	2	2	341.84	7
catalog	1001001	2	3	1124.59	15
catalog	1001001	2	5	75.89	3
catalog	1001001	3	NULL	2173.35	45
catalog	1001001	3	1	116.53	5
catalog	1001001	3	2	456.59	14
catalog	1001001	3	4	168.32	4
catalog	1001001	3	5	63.20	1
catalog	1001001	3	6	340.30	7
catalog	1001001	3	7	559.79	7
catalog	1001001	3	8	308.92	4
catalog	1001001	3	9	159.70	3
catalog	1001001	4	NULL	1068.60	31
catalog	1001001	4	2	539.99	13
catalog	1001001	4	3	233.42	8
catalog	1001001	4	4	295.19	10
catalog	1001001	5	NULL	835.63	17
catalog	1001001	5	9	553.45	12
catalog	1001001	5	10	282.18	5
catalog	1001001	7	NULL	62.00	3
catalog	1001001	7	7	62.00	3
catalog	1001001	8	NULL	490.30	13
catalog	1001001	8	7	187.96	7
catalog	1001001	8	10	302.34	6
catalog	1001001	9	NULL	283.80	5
catalog	1001001	9	6	283.80	5
catalog	1001001	11	NULL	660.94	12
catalog	1001001	11	9	660.94	12
catalog	1001001	12	NULL	287.67	9
catalog	1001001	12	10	287.67	9
catalog	1001001	15	NULL	697.97	20
catalog	1001001	15	9	319.21	7
catalog	1001001	15	10	378.76	13
catalog	1001002	NULL	NULL	34357.86	715
catalog	1001002	1	NULL	25374.09	536
catalog	1001002	1	1	25374.09	536
catalog	1001002	2	NULL	1291.83	29
catalog	1001002	2	1	1291.83	29
catalog	1001002	3	NULL	3984.23	68
catalog	1001002	3	1	3984.23	68
catalog	1001002	4	NULL	954.02	21
catalog	1001002	4	1	954.02	21
catalog	1001002	5	NULL	401.39	9
catalog	1001002	5	1	401.39	9
catalog	1001002	6	NULL	80.01	4
catalog	1001002	6	1	80.01	4
catalog	1001002	7	NULL	437.66	10
catalog	1001002	7	1	437.66	10
catalog	1001002	8	NULL	535.21	13
catalog	1001002	8	1	535.21	13
catalog	1001002	9	NULL	152.45	4
catalog	1001002	9	1	152.45	4
catalog	1001002	12	NULL	510.63	7
catalog	1001002	12	1	510.63	7
catalog	1001002	15	NULL	237.38	6
catalog	1001002	15	1	237.38	6
catalog	1001002	16	NULL	398.96	8
catalog	1001002	16	1	398.96	8
catalog	1002001	NULL	NULL	19351.34	386
catalog	1002001	1	NULL	3176.84	55
catalog	1002001	1	1	491.44	14
catalog	1002001	1	2	1240.31	21
catalog	1002001	1	4	442.63	5
catalog	1002001	1	5	156.72	4
catalog	1002001	1	6	261.62	3
catalog	1002001	1	9	298.23	4
catalog	1002001	1	10	285.89	4
catalog	1002001	2	NULL	11365.13	225
catalog	1002001	2	1	2531.13	51
catalog	1002001	2	2	1507.28	26
catalog	1002001	2	3	840.83	17
catalog	1002001	2	4	478.43	13
catalog	1002001	2	5	593.76	10
catalog	1002001	2	6	1392.26	20
catalog	1002001	2	7	733.29	16
catalog	1002001	2	8	1168.84	24
catalog	1002001	2	9	1958.75	38
catalog	1002001	2	10	160.56	10
catalog	1002001	3	NULL	710.78	17
catalog	1002001	3	2	191.80	6
catalog	1002001	3	7	102.44	3
catalog	1002001	3	8	416.54	8
catalog	1002001	4	NULL	1822.20	37
catalog	1002001	4	1	938.17	15
catalog	1002001	4	3	283.47	7

query IIIIII
SELECT * FROM final
ORDER BY channel DESC NULLS FIRST,
         i_brand_id DESC NULLS FIRST,
         i_class_id DESC NULLS FIRST,
         i_category_id DESC NULLS FIRST
LIMIT 100;
----
NULL	NULL	NULL	NULL	7014662.98	160443
web	NULL	NULL	NULL	1183348.75	22789
web	10016017	NULL	NULL	82.76	4
web	10016017	3	NULL	82.76	4
web	10016017	3	10	82.76	4
web	10016016	NULL	NULL	436.02	9
web	10016016	16	NULL	436.02	9
web	10016016	16	10	233.59	5
web	10016016	16	5	202.43	4
web	10016015	NULL	NULL	402.94	9
web	10016015	16	NULL	402.94	9
web	10016015	16	10	402.94	9
web	10016014	NULL	NULL	604.77	9
web	10016014	16	NULL	604.77	9
web	10016014	16	10	604.77	9
web	10016013	NULL	NULL	321.85	8
web	10016013	16	NULL	260.05	5
web	10016013	16	10	260.05	5
web	10016013	2	NULL	61.80	3
web	10016013	2	5	61.80	3
web	10016012	NULL	NULL	630.51	11
web	10016012	16	NULL	48.19	1
web	10016012	16	10	48.19	1
web	10016012	13	NULL	349.34	3
web	10016012	13	8	349.34	3
web	10016012	7	NULL	88.91	4
web	10016012	7	10	88.91	4
web	10016012	3	NULL	144.07	3
web	10016012	3	3	144.07	3
web	10016010	NULL	NULL	969.45	15
web	10016010	16	NULL	704.47	11
web	10016010	16	10	704.47	11
web	10016010	2	NULL	264.98	4
web	10016010	2	10	264.98	4
web	10016009	NULL	NULL	569.14	10
web	10016009	16	NULL	438.95	7
web	10016009	16	10	233.20	4
web	10016009	16	8	205.75	3
web	10016009	4	NULL	130.19	3
web	10016009	4	2	130.19	3
web	10016008	NULL	NULL	328.82	5
web	10016008	16	NULL	328.82	5
web	10016008	16	10	328.82	5
web	10016007	NULL	NULL	320.74	9
web	10016007	16	NULL	320.74	9
web	10016007	16	10	58.42	4
web	10016007	16	9	262.32	5
web	10016006	NULL	NULL	138.26	2
web	10016006	16	NULL	138.26	2
web	10016006	16	10	138.26	2
web	10016005	NULL	NULL	752.58	16
web	10016005	16	NULL	628.49	14
web	10016005	16	10	628.49	14
web	10016005	11	NULL	124.09	2
web	10016005	11	9	124.09	2
web	10016004	NULL	NULL	304.28	7
web	10016004	1	NULL	304.28	7
web	10016004	1	10	53.90	2
web	10016004	1	5	250.38	5
web	10016003	NULL	NULL	798.02	12
web	10016003	16	NULL	167.05	5
web	10016003	16	10	167.05	5
web	10016003	4	NULL	630.97	7
web	10016003	4	10	630.97	7
web	10016002	NULL	NULL	603.23	16
web	10016002	16	NULL	226.12	3
web	10016002	16	4	226.12	3
web	10016002	4	NULL	260.90	6
web	10016002	4	1	260.90	6
web	10016002	3	NULL	45.88	4
web	10016002	3	10	45.88	4
web	10016002	1	NULL	70.33	3
web	10016002	1	10	70.33	3
web	10016001	NULL	NULL	127.24	3
web	10016001	16	NULL	127.24	3
web	10016001	16	10	127.24	3
web	10015017	NULL	NULL	344.84	7
web	10015017	15	NULL	344.84	7
web	10015017	15	10	344.84	7
web	10015016	NULL	NULL	190.34	6
web	10015016	15	NULL	190.34	6
web	10015016	15	10	190.34	6
web	10015015	NULL	NULL	793.09	12
web	10015015	15	NULL	793.09	12
web	10015015	15	10	601.99	10
web	10015015	15	4	191.10	2
web	10015013	NULL	NULL	1461.08	22
web	10015013	15	NULL	676.44	9
web	10015013	15	10	544.04	6
web	10015013	15	6	132.40	3
web	10015013	3	NULL	125.90	2
web	10015013	3	10	125.90	2
web	10015013	2	NULL	441.80	4
web	10015013	2	4	441.80	4
web	10015013	1	NULL	216.94	7
web	10015013	1	4	49.83	3
web	10015013	1	1	167.11	4
web	10015012	NULL	NULL	148.71	5
web	10015012	15	NULL	148.71	5
web	10015012	15	1	148.71	5

query IIIIII
SELECT * FROM final
ORDER BY channel NULLS LAST,
         i_brand_id NULLS LAST,
         i_class_id NULLS LAST,
         i_category_id NULLS LAST
LIMIT 100;
----
catalog	1001001	1	1	868.60	20
catalog	1001001	1	2	1126.88	27
catalog	1001001	1	3	68.52	3
catalog	1001001	1	4	1210.00	23
catalog	1001001	1	5	1093.30	25
catalog	1001001	1	6	52.48	3
catalog	1001001	1	7	452.95	9
catalog	1001001	1	8	712.10	13
catalog	1001001	1	9	1053.72	21
catalog	1001001	1	10	898.48	23
catalog	1001001	1	NULL	7537.03	167
catalog	1001001	2	2	341.84	7
catalog	1001001	2	3	1124.59	15
catalog	1001001	2	5	75.89	3
catalog	1001001	2	NULL	1542.32	25
catalog	1001001	3	1	116.53	5
catalog	1001001	3	2	456.59	14
catalog	1001001	3	4	168.32	4
catalog	1001001	3	5	63.20	1
catalog	1001001	3	6	340.30	7
catalog	1001001	3	7	559.79	7
catalog	1001001	3	8	308.92	4
catalog	1001001	3	9	159.70	3
catalog	1001001	3	NULL	2173.35	45
catalog	1001001	4	2	539.99	13
catalog	1001001	4	3	233.42	8
catalog	1001001	4	4	295.19	10
catalog	1001001	4	NULL	1068.60	31
catalog	1001001	5	9	553.45	12
catalog	1001001	5	10	282.18	5
catalog	1001001	5	NULL	835.63	17
catalog	1001001	7	7	62.00	3
catalog	1001001	7	NULL	62.00	3
catalog	1001001	8	7	187.96	7
catalog	1001001	8	10	302.34	6
catalog	1001001	8	NULL	490.30	13
catalog	1001001	9	6	283.80	5
catalog	1001001	9	NULL	283.80	5
catalog	1001001	11	9	660.94	12
catalog	1001001	11	NULL	660.94	12
catalog	1001001	12	10	287.67	9
catalog	1001001	12	NULL	287.67	9
catalog	1001001	15	9	319.21	7
catalog	1001001	15	10	378.76	13
catalog	1001001	15	NULL	697.97	20
catalog	1001001	NULL	NULL	15639.61	347
catalog	1001002	1	1	25374.09	536
catalog	1001002	1	NULL	25374.09	536
catalog	1001002	2	1	1291.83	29
catalog	1001002	2	NULL	1291.83	29
catalog	1001002	3	1	3984.23	68
catalog	1001002	3	NULL	3984.23	68
catalog	1001002	4	1	954.02	21
catalog	1001002	4	NULL	954.02	21
catalog	1001002	5	1	401.39	9
catalog	1001002	5	NULL	401.39	9
catalog	1001002	6	1	80.01	4
catalog	1001002	6	NULL	80.01	4
catalog	1001002	7	1	437.66	10
catalog	1001002	7	NULL	437.66	10
catalog	1001002	8	1	535.21	13
catalog	1001002	8	NULL	535.21	13
catalog	1001002	9	1	152.45	4
catalog	1001002	9	NULL	152.45	4
catalog	1001002	12	1	510.63	7
catalog	1001002	12	NULL	510.63	7
catalog	1001002	15	1	237.38	6
catalog	1001002	15	NULL	237.38	6
catalog	1001002	16	1	398.96	8
catalog	1001002	16	NULL	398.96	8
catalog	1001002	NULL	NULL	34357.86	715
catalog	1002001	1	1	491.44	14
catalog	1002001	1	2	1240.31	21
catalog	1002001	1	4	442.63	5
catalog	1002001	1	5	156.72	4
catalog	1002001	1	6	261.62	3
catalog	1002001	1	9	298.23	4
catalog	1002001	1	10	285.89	4
catalog	1002001	1	NULL	3176.84	55
catalog	1002001	2	1	2531.13	51
catalog	1002001	2	2	1507.28	26
catalog	1002001	2	3	840.83	17
catalog	1002001	2	4	478.43	13
catalog	1002001	2	5	593.76	10
catalog	1002001	2	6	1392.26	20
catalog	1002001	2	7	733.29	16
catalog	1002001	2	8	1168.84	24
catalog	1002001	2	9	1958.75	38
catalog	1002001	2	10	160.56	10
catalog	1002001	2	NULL	11365.13	225
catalog	1002001	3	2	191.80	6
catalog	1002001	3	7	102.44	3
catalog	1002001	3	8	416.54	8
catalog	1002001	3	NULL	710.78	17
catalog	1002001	4	1	938.17	15
catalog	1002001	4	3	283.47	7
catalog	1002001	4	4	208.51	6
catalog	1002001	4	5	267.36	4
catalog	1002001	4	7	50.87	2
catalog	1002001	4	9	73.82	3

query IIIIII
SELECT * FROM final
ORDER BY channel DESC NULLS LAST,
         i_brand_id DESC NULLS LAST,
         i_class_id DESC NULLS LAST,
         i_category_id DESC NULLS LAST
LIMIT 100;
----
web	10016017	3	10	82.76	4
web	10016017	3	NULL	82.76	4
web	10016017	NULL	NULL	82.76	4
web	10016016	16	10	233.59	5
web	10016016	16	5	202.43	4
web	10016016	16	NULL	436.02	9
web	10016016	NULL	NULL	436.02	9
web	10016015	16	10	402.94	9
web	10016015	16	NULL	402.94	9
web	10016015	NULL	NULL	402.94	9
web	10016014	16	10	604.77	9
web	10016014	16	NULL	604.77	9
web	10016014	NULL	NULL	604.77	9
web	10016013	16	10	260.05	5
web	10016013	16	NULL	260.05	5
web	10016013	2	5	61.80	3
web	10016013	2	NULL	61.80	3
web	10016013	NULL	NULL	321.85	8
web	10016012	16	10	48.19	1
web	10016012	16	NULL	48.19	1
web	10016012	13	8	349.34	3
web	10016012	13	NULL	349.34	3
web	10016012	7	10	88.91	4
web	10016012	7	NULL	88.91	4
web	10016012	3	3	144.07	3
web	10016012	3	NULL	144.07	3
web	10016012	NULL	NULL	630.51	11
web	10016010	16	10	704.47	11
web	10016010	16	NULL	704.47	11
web	10016010	2	10	264.98	4
web	10016010	2	NULL	264.98	4
web	10016010	NULL	NULL	969.45	15
web	10016009	16	10	233.20	4
web	10016009	16	8	205.75	3
web	10016009	16	NULL	438.95	7
web	10016009	4	2	130.19	3
web	10016009	4	NULL	130.19	3
web	10016009	NULL	NULL	569.14	10
web	10016008	16	10	328.82	5
web	10016008	16	NULL	328.82	5
web	10016008	NULL	NULL	328.82	5
web	10016007	16	10	58.42	4
web	10016007	16	9	262.32	5
web	10016007	16	NULL	320.74	9
web	10016007	NULL	NULL	320.74	9
web	10016006	16	10	138.26	2
web	10016006	16	NULL	138.26	2
web	10016006	NULL	NULL	138.26	2
web	10016005	16	10	628.49	14
web	10016005	16	NULL	628.49	14
web	10016005	11	9	124.09	2
web	10016005	11	NULL	124.09	2
web	10016005	NULL	NULL	752.58	16
web	10016004	1	10	53.90	2
web	10016004	1	5	250.38	5
web	10016004	1	NULL	304.28	7
web	10016004	NULL	NULL	304.28	7
web	10016003	16	10	167.05	5
web	10016003	16	NULL	167.05	5
web	10016003	4	10	630.97	7
web	10016003	4	NULL	630.97	7
web	10016003	NULL	NULL	798.02	12
web	10016002	16	4	226.12	3
web	10016002	16	NULL	226.12	3
web	10016002	4	1	260.90	6
web	10016002	4	NULL	260.90	6
web	10016002	3	10	45.88	4
web	10016002	3	NULL	45.88	4
web	10016002	1	10	70.33	3
web	10016002	1	NULL	70.33	3
web	10016002	NULL	NULL	603.23	16
web	10016001	16	10	127.24	3
web	10016001	16	NULL	127.24	3
web	10016001	NULL	NULL	127.24	3
web	10015017	15	10	344.84	7
web	10015017	15	NULL	344.84	7
web	10015017	NULL	NULL	344.84	7
web	10015016	15	10	190.34	6
web	10015016	15	NULL	190.34	6
web	10015016	NULL	NULL	190.34	6
web	10015015	15	10	601.99	10
web	10015015	15	4	191.10	2
web	10015015	15	NULL	793.09	12
web	10015015	NULL	NULL	793.09	12
web	10015013	15	10	544.04	6
web	10015013	15	6	132.40	3
web	10015013	15	NULL	676.44	9
web	10015013	3	10	125.90	2
web	10015013	3	NULL	125.90	2
web	10015013	2	4	441.80	4
web	10015013	2	NULL	441.80	4
web	10015013	1	4	49.83	3
web	10015013	1	1	167.11	4
web	10015013	1	NULL	216.94	7
web	10015013	NULL	NULL	1461.08	22
web	10015012	15	1	148.71	5
web	10015012	15	NULL	148.71	5
web	10015012	NULL	NULL	148.71	5
web	10015011	15	10	104.46	5
web	10015011	15	NULL	104.46	5
