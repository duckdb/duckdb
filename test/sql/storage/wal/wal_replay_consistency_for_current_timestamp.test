# name: test/sql/storage/wal/wal_replay_consistency_for_current_timestamp.test
# group: [wal]

statement ok
PRAGMA disable_checkpoint_on_shutdown;

statement ok
SET wal_autocheckpoint='1TB'

statement ok
ATTACH '__TEST_DIR__/wal_replay.db';

statement ok
CREATE TABLE t AS SELECT range::INT AS id FROM range(100);

statement ok
ALTER TABLE t ADD COLUMN d TIMESTAMP WITH TIME ZONE DEFAULT CURRENT_TIMESTAMP;

statement ok
CREATE TABLE original AS SELECT d FROM t;

statement ok
DETACH wal_replay;

statement ok
ATTACH '__TEST_DIR__/wal_replay.db';

query I
SELECT COUNT(*) != 0 FROM t JOIN original ON t.d = original.d;
----
true