# name: test/sql/storage/wal/wal_replay_consistency_for_random.test
# group: [wal]

statement ok
PRAGMA disable_checkpoint_on_shutdown;

statement ok
SET wal_autocheckpoint='1TB'

statement ok
ATTACH '__TEST_DIR__/wal_replay.db';

statement ok
USE wal_replay;

statement ok
CREATE TABLE t AS SELECT range::INT AS id FROM range(10);

statement ok
ALTER TABLE t ADD COLUMN r DOUBLE DEFAULT RANDOM();

statement ok
CREATE TABLE original AS SELECT id, r FROM t;

# stop using wal_replay to be able to detach it
statement ok
USE memory;

statement ok
DETACH wal_replay;

statement ok
ATTACH '__TEST_DIR__/wal_replay.db';

statement ok
USE wal_replay;

# there is a result
query I
select COUNT(r) != 0 from t;
----
true

# result is consistent
query I sort r1
select r from t;
----

query I sort r1
select r from original;
----