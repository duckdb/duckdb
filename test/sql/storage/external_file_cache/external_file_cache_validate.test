# name: test/sql/storage/external_file_cache/external_file_cache_validate.test
# description: Test the validate_external_file_cache setting
# group: [external_file_cache]

require parquet

statement ok
copy (select 1 as col1, 2 as col2 from range(100)) to '__TEST_DIR__/test_validate.parquet';

statement ok
set prefetch_all_parquet_files=true;

# Test 1: Check default value, which should be VALIDATE_ALL.
query I
select current_setting('validate_external_file_cache');
----
validate_all

# Test 2: check validation option VALIDATE_REMOTE.
statement ok
set validate_external_file_cache='VALIDATE_REMOTE';

query I
select current_setting('validate_external_file_cache');
----
validate_remote

query I
select sum(col1) from '__TEST_DIR__/test_validate.parquet';
----
100

# Test 3: With NO_VALIDATION, queries should still work.
statement ok
set validate_external_file_cache='NO_VALIDATION';

query I
select current_setting('validate_external_file_cache');
----
no_validation

query I
select sum(col1) from '__TEST_DIR__/test_validate.parquet';
----
100

# Test 5: Invalid enum value should fail
statement error
set validate_external_file_cache='INVALID_VALUE';
----
<REGEX>:.*unrecognized value.*
