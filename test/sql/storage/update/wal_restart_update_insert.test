# name: test/sql/storage/update/wal_restart_update_insert.test
# description: Test WAL restart with updates and insertions
# group: [update]

# load the DB from disk
load __TEST_DIR__/wal_restart_update_insert.test.db

statement ok
CREATE TABLE test(i INTEGER PRIMARY KEY, j INTEGER);

statement ok
INSERT INTO test SELECT r, r FROM range(2000) t(r);

statement ok
CHECKPOINT

statement ok
PRAGMA disable_checkpoint_on_shutdown

statement ok
SET checkpoint_threshold='1TB'

statement ok
INSERT INTO test SELECT r, r FROM range(2000,200000) t(r)

statement ok
UPDATE test SET j=j+1

restart

statement ok
PRAGMA disable_checkpoint_on_shutdown

statement ok
SET checkpoint_threshold='1TB'

statement ok
INSERT INTO test SELECT r, r FROM range(200000,400000) t(r)

restart

query I
select count(*) FROM test
----
400000
