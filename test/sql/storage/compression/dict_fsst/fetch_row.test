# name: test/sql/storage/compression/dict_fsst/fetch_row.test
# description: Test storage with Dictionary compression
# group: [dict_fsst]

load {LOCAL_TEMP_DIR}/test_dictionary_fetchrow.db readwrite v1.3.0

statement ok
PRAGMA force_compression = 'dict_fsst';

statement ok
CREATE TABLE test (a INTEGER, b VARCHAR);

statement ok
INSERT INTO test (a, b)
SELECT
	x AS a,
	CASE x % 5
		WHEN 0 THEN 'aaaa'
		WHEN 1 THEN 'bbbb'
		WHEN 2 THEN 'cccc'
		WHEN 3 THEN 'this is not an inlined string'
		WHEN 4 THEN NULL
	END AS b
FROM range(80) t(x);

statement ok
CHECKPOINT

restart

query I
SELECT compression FROM pragma_storage_info('test') WHERE segment_type ILIKE 'VARCHAR' LIMIT 1
----
DICT_FSST

query I
SELECT DISTINCT b FROM test ORDER BY a % 5;
----
aaaa
bbbb
cccc
this is not an inlined string
NULL

query I
SELECT DISTINCT b FROM test ORDER BY a % 5;
----
aaaa
bbbb
cccc
this is not an inlined string
NULL
