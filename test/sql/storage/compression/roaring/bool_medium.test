# name: test/sql/storage/compression/roaring/bool.test
# description: Test bitpacking with nulls
# group: [roaring]

load __TEST_DIR__/test_roaring.db readwrite v1.2.0

statement ok
PRAGMA force_compression='roaring';

# simple compression with few values
statement ok
CREATE TABLE test (a BOOL);

statement ok
INSERT INTO test VALUES
(false), (false), (true), (false), (false), (false), (false), (false),
(false), (false), (true), (false), (false), (false), (false), (false),
(false), (false), (true), (false), (false), (false), (false), (false),
(false), (false), (true), (false), (false), (false), (false), (false),
(false), (false), (true), (false), (false), (false), (false), (false),
(false), (false), (true), (false), (false), (false), (false), (false),
(false), (false), (true), (false), (false), (false), (false), (false),
(false), (false), (true), (false), (false), (false), (false), (false);
# INSERT INTO test VALUES (true), (false), (true), (null), (false), (true), (null), (false);

statement ok
checkpoint;

query I
FROM test;
----
false
false
true
false
false
false
false
false
false
false
true
false
false
false
false
false
false
false
true
false
false
false
false
false
false
false
true
false
false
false
false
false
false
false
true
false
false
false
false
false
false
false
true
false
false
false
false
false
false
false
true
false
false
false
false
false
false
false
true
false
false
false
false
false

# SELECT * FROM pragma_storage_info('test');
# SELECT compression FROM pragma_storage_info('test') WHERE compression != 'Roaring';
# SELECT * FROM test;
# ----

# query I
# select count(*) from test WHERE a IS NOT NULL;
# ----
# 1938
#
# query III
# select sum(a), min(a), max(a) from test;
# ----
# 2591106	1337	1337
#
# statement ok
# delete from test;
#
# # 3 runs per Vector (uses uncompressed runs)
# statement ok
# with intermediates as (
# 	select i % 2048 as i
# 	from range(0, 10_000) t(i)
# )
# INSERT INTO test SELECT case when (i >= 0 and i < 110) or (i >= 1500 and i < 1800) or (i >= 2000) then null else 1337 end FROM intermediates;
# # (0,110)
# # (1500,1800)
# # (2000,2048)
#
# statement ok
# checkpoint;
#
# query I
# select count(*) from test WHERE a IS NOT NULL;
# ----
# 7758
#
# query III
# select sum(a), min(a), max(a) from test;
# ----
# 10372446	1337	1337
#
# statement ok
# DROP TABLE test;
