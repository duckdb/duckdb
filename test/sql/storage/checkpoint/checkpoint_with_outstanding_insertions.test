# name: test/sql/storage/checkpoint/checkpoint_with_outstanding_insertions.test
# description: Test checkpoint with a transaction that needs to read old data
# group: [checkpoint]

load __TEST_DIR__/insert_checkpoint.db

statement ok
create or replace table z(id integer);

statement ok
insert into z from range(200_000);

statement ok
set checkpoint_threshold='1TB'

statement ok
set immediate_transaction_mode=true

statement ok con1
begin

statement ok con1
insert into z from range(200_000, 400_000)

statement ok con2
checkpoint

query II con1
select min(id), max(id) from z;
----
0	399999

query II con2
select min(id), max(id) from z;
----
0	199999

statement ok con1
commit

query II
select min(id), max(id) from z;
----
0	399999

restart

query II
select min(id), max(id) from z;
----
0	399999

