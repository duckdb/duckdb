# name: test/sql/pragma/profiling/test_custom_profiling_rows_scanned_parquet.test
# group: [profiling]

require json

require parquet

statement ok
PRAGMA enable_verification;

statement ok
COPY (SELECT * FROM range(0, 10) as r(i)) TO '__TEST_DIR__/range.parquet' (FORMAT 'parquet');

statement ok
COPY (SELECT * FROM range(0, 10) as r(i)) TO '__TEST_DIR__/range2.parquet' (FORMAT 'parquet');

statement ok
PRAGMA enable_profiling = 'json';

statement ok
PRAGMA profiling_output = '__TEST_DIR__/profiling_output.json';

statement ok
PRAGMA custom_profiling_settings='{"OPERATOR_CARDINALITY": "true", "OPERATOR_ROWS_SCANNED": "true", "CUMULATIVE_CARDINALITY": "true", "CUMULATIVE_ROWS_SCANNED": "true"}';

statement ok
SELECT * FROM '__TEST_DIR__/range.parquet' order by all;

statement ok
pragma disable_profiling;

statement ok
CREATE OR REPLACE TABLE metrics_output AS SELECT * FROM '__TEST_DIR__/profiling_output.json';

statement ok
SELECT cumulative_cardinality, cumulative_rows_scanned FROM metrics_output;

query I
SELECT
	CASE WHEN cumulative_rows_scanned = 10 THEN 'true'
	ELSE 'false' END
FROM metrics_output;
----
true