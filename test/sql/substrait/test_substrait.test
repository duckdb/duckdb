# name: test/sql/substrait/test_substrait.test
# description: Test get_substrait and from_substrait basic functionality
# group: [substrait]

require substrait

statement ok
PRAGMA enable_verification

statement ok
CREATE TABLE crossfit (exercise text,dificulty_level int);

statement ok
insert into crossfit values ('Push Ups', 3), ('Pull Ups', 5) , (' Push Jerk', 7), ('Bar Muscle Up', 10);

query I
CALL get_substrait('select count(exercise) as exercise from crossfit where dificulty_level <=5')
----
\x12\x07\x1A\x05\x1A\x03lte\x12\x11\x1A\x0F\x10\x01\x1A\x0Bis_not_null\x12\x09\x1A\x07\x10\x02\x1A\x03and\x12\x10\x1A\x0E\x10\x03\x1A\x0Acount_star\x1A\x98\x01\x12\x95\x01\x0A\x88\x01:\x85\x01\x12{"y\x12o:m\x12Y\x12W\x12+\x0A)\x12\x1B\x0A\x08exercise\x0A\x0Fdificulty_level:\x0A\x0A\x08crossfit\x1A(\x1A&\x08\x02\x12\x12\x1A\x10\x12\x08\x12\x06\x0A\x04\x12\x02\x08\x01\x12\x04\x0A\x02(\x05\x12\x0E\x1A\x0C\x08\x01\x12\x08\x12\x06\x0A\x04\x12\x02\x08\x01\x1A\x08\x12\x06\x0A\x04\x12\x02\x08\x01\x1A\x06\x12\x04\x0A\x02\x12\x00\x1A\x00"\x04\x0A\x02\x08\x03\x1A\x06\x12\x04\x0A\x02\x12\x00\x12\x08exercise


query I
CALL from_substrait('\x12\x07\x1A\x05\x1A\x03lte\x12\x11\x1A\x0F\x10\x01\x1A\x0Bis_not_null\x12\x09\x1A\x07\x10\x02\x1A\x03and\x12\x10\x1A\x0E\x10\x03\x1A\x0Acount_star\x1A\x98\x01\x12\x95\x01\x0A\x88\x01:\x85\x01\x12{"y\x12o:m\x12Y\x12W\x12+\x0A)\x12\x1B\x0A\x08exercise\x0A\x0Fdificulty_level:\x0A\x0A\x08crossfit\x1A(\x1A&\x08\x02\x12\x12\x1A\x10\x12\x08\x12\x06\x0A\x04\x12\x02\x08\x01\x12\x04\x0A\x02(\x05\x12\x0E\x1A\x0C\x08\x01\x12\x08\x12\x06\x0A\x04\x12\x02\x08\x01\x1A\x08\x12\x06\x0A\x04\x12\x02\x08\x01\x1A\x06\x12\x04\x0A\x02\x12\x00\x1A\x00"\x04\x0A\x02\x08\x03\x1A\x06\x12\x04\x0A\x02\x12\x00\x12\x08exercise'::BLOB)
----
2

# Query with multiple columns
query I
CALL get_substrait('select * from crossfit')
----
\x1Av\x12t\x0AW:U\x12A:?\x12+\x0A)\x12\x1B\x0A\x08exercise\x0A\x0Fdificulty_level:\x0A\x0A\x08crossfit\x1A\x06\x12\x04\x0A\x02\x12\x00\x1A\x08\x12\x06\x0A\x04\x12\x02\x08\x01\x1A\x06\x12\x04\x0A\x02\x12\x00\x1A\x08\x12\x06\x0A\x04\x12\x02\x08\x01\x12\x08exercise\x12\x0Fdificulty_level


query II
CALL from_substrait('\x1Av\x12t\x0AW:U\x12A:?\x12+\x0A)\x12\x1B\x0A\x08exercise\x0A\x0Fdificulty_level:\x0A\x0A\x08crossfit\x1A\x06\x12\x04\x0A\x02\x12\x00\x1A\x08\x12\x06\x0A\x04\x12\x02\x08\x01\x1A\x06\x12\x04\x0A\x02\x12\x00\x1A\x08\x12\x06\x0A\x04\x12\x02\x08\x01\x12\x08exercise\x12\x0Fdificulty_level'::BLOB)
----
Push Ups	3
Pull Ups	5
 Push Jerk	7
Bar Muscle Up	10


# Should fail with empty
statement error
CALL get_substrait()

statement error
CALL from_substrait()

# Should fail with NULL
statement error
CALL get_substrait(NULL)

statement error
CALL from_substrait(NULL)

# Should fail with Invalid Query
statement error
CALL get_substrait(select bla from t)

#Shoud fail with invalid binary
statement error
CALL from_substrait(ongezoutennoten)