# name: test/sql/create/create_as_partition_sorted_options.test
# description: Test CREATE OR REPLACE TABLE
# group: [create]

statement ok
pragma enable_verification

statement error
CREATE TABLE integers PARTITIONED BY (i) as select range i from range(10);
----
<REGEX>:.*PARTITIONED BY is not supported for tables in a duckdb catalog.*

statement error
CREATE TABLE integers SORTED BY (i) as select range i from range(10);
----
<REGEX>:.*SORTED BY is not supported for tables in a duckdb catalog.*

statement error
CREATE TABLE integers PARTITIONED BY (i) SORTED BY (i) as select range i from range(10);
----
<REGEX>:.*PARTITIONED BY is not supported for tables in a duckdb catalog.*

statement error
CREATE TABLE iceberg_table
WITH (
	'location' = 's3://amzn-s3-demo-bucket/iceberg-folder',
	'table_type'='ICEBERG',
    'format'='parquet'
) as select range i from range(10);
----
<REGEX>:.*WITH clause is not supported for tables in a duckdb catalog.*

statement error
CREATE TABLE iceberg_table
PARTITIONED BY (id)
SORTED BY (date)
WITH (
  location='s3://amzn-s3-demo-bucket/iceberg-folder',
  table_type='ICEBERG',
  format='parquet'
)
as select range i, range::DATE date from range(10);
----
<REGEX>:.*PARTITIONED BY is not supported for tables in a duckdb catalog.*

statement error
CREATE TABLE iceberg_table
SORTED BY (date)
WITH (
  location='s3://amzn-s3-demo-bucket/iceberg-folder',
  table_type='ICEBERG',
  format='parquet'
)
as select range i, range::DATE date from range(10);
----
<REGEX>:.*SORTED BY is not supported for tables in a duckdb catalog.*

statement error
CREATE TABLE iceberg_table
WITH (
  location='s3://amzn-s3-demo-bucket/iceberg-folder',
  table_type='ICEBERG',
  format='parquet'
)
as select range i, range::DATE date from range(10);
----
<REGEX>:.*WITH clause is not supported for tables in a duckdb catalog.*


# different orders
statement error
CREATE TABLE iceberg_table
SORTED BY (date)
PARTITIONED BY (id)
WITH (
  location='s3://amzn-s3-demo-bucket/iceberg-folder',
  table_type='ICEBERG',
  format='parquet'
)
as select range id, range::DATE date from range(10);
----
<REGEX>:.*PARTITIONED BY is not supported for tables in a duckdb catalog.*

# WITH must come after sorted and partition options
statement error
CREATE TABLE iceberg_table
WITH (
  location='s3://amzn-s3-demo-bucket/iceberg-folder',
  table_type='ICEBERG',
  format='parquet'
)
SORTED BY (date)
PARTITIONED BY (id)
as select range id, range::DATE date from range(10);
----
<REGEX>:.*Parser Error.*

statement ok
SET VARIABLE location_var='boop'

# Paritioned by variable
statement error
CREATE TABLE iceberg_table
Partitioned by (getvariable('location_var'))
as select range id, range::DATE date from range(10);
----
<REGEX>:.*PARTITIONED BY is not supported for tables in a duckdb catalog.*

# Table options using a environment variable
statement error
CREATE TABLE iceberg_table
WITH (
  location=getvariable('location_var'),
  table_type='ICEBERG',
  format='parquet'
)
as select range id, range::DATE date from range(10);
----
<REGEX>:.*WITH clause is not supported for tables in a duckdb catalog.*

# check when option keys are quoted
statement error
CREATE TABLE iceberg_table
WITH (
  'location'=getvariable('location_var'),
  'table_type'='ICEBERG',
  'format'='parquet'
)
as select range id, range::DATE date from range(10);
----
<REGEX>:.*WITH clause is not supported for tables in a duckdb catalog.*

# single value options are also supported (default to True)
statement error
CREATE TABLE iceberg_table
WITH (
  'location',
  'table_type',
  'format'
)
as select range id, range::DATE date from range(10);
----
<REGEX>:.*WITH clause is not supported for tables in a duckdb catalog.*

# single value options are also supported (not quoted)
statement error
CREATE TABLE iceberg_table
WITH (
  location,
  table_type,
  format
)
as select range id, range::DATE date from range(10);
----
<REGEX>:.*WITH clause is not supported for tables in a duckdb catalog.*
