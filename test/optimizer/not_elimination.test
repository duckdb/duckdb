# name: test/optimizer/not_elimination.test
# description: Not elimination test
# group: [optimizer]

statement ok
CREATE TABLE test(col0 INTEGER, col1 SMALLINT, col2 INTEGER, col3 INTEGER);

statement ok
PRAGMA explain_output = OPTIMIZED_ONLY;

# Nested NOT
query I nosort nested_not_test1
EXPLAIN SELECT col0 FROM test WHERE NOT NOT col1 > 1
----

query I nosort nested_not_test1
EXPLAIN SELECT col0 FROM test WHERE NOT NOT NOT NOT col1 > 1
----

query I nosort nested_not_test1
EXPLAIN SELECT col0 FROM test WHERE col1 > 1
----

query I nosort nested_not_test2
EXPLAIN SELECT col0 FROM test WHERE NOT NOT NOT col1 > 1
----

query I nosort nested_not_test2
EXPLAIN SELECT col0 FROM test WHERE NOT col1 > 1
----

# NOT + IS_NULL/IS_NOT_NULL
query I nosort not_is_null_test
EXPLAIN SELECT col0 FROM test WHERE NOT col1 IS NULL
----

query I nosort not_is_null_test
EXPLAIN SELECT col0 FROM test WHERE col1 IS NOT NULL
----

query I nosort not_null_test
EXPLAIN SELECT col0 FROM test WHERE NOT col1 IS NOT NULL
----

query I nosort not_null_test
EXPLAIN SELECT col0 FROM test WHERE col1 IS NULL
----

# NOT + AND
query I nosort not_and_test1
EXPLAIN SELECT col0 FROM test WHERE NOT (col1 > 3 AND col2 <= 2)
----

query I nosort not_and_test1
EXPLAIN SELECT col0 FROM test WHERE col1 <= 3 OR col2 > 2
----

query I nosort not_and_test2
EXPLAIN SELECT col0 FROM test WHERE NOT (col1 = 3 AND col2 != 2)
----

query I nosort not_and_test2
EXPLAIN SELECT col0 FROM test WHERE col1 != 3 OR col2 = 2
----

query I nosort not_and_test3
EXPLAIN SELECT col0 FROM test WHERE NOT (col1 = 3 AND col2 != 2 AND col3 < 3)
----

query I nosort not_and_test3
EXPLAIN SELECT col0 FROM test WHERE col1 != 3 OR col2 = 2 OR col3 >= 3
----

# NOT + OR
query I nosort not_or_test1
EXPLAIN SELECT col0 FROM test WHERE NOT (col1 >= 3 OR col2 < 2)
----

query I nosort not_or_test1
EXPLAIN SELECT col0 FROM test WHERE col1 < 3 AND col2 >= 2
----

query I nosort not_or_test2
EXPLAIN SELECT col0 FROM test WHERE NOT (col1 != 3 OR col2 = 2)
----

query I nosort not_or_test2
EXPLAIN SELECT col0 FROM test WHERE col1 = 3 AND col2 != 2
----

query I nosort not_or_test3
EXPLAIN SELECT col0 FROM test WHERE NOT (col1 != 3 OR col2 = 2 OR col3 > 3)
----

query I nosort not_or_test3
EXPLAIN SELECT col0 FROM test WHERE col1 = 3 AND col2 != 2 AND col3 <= 3
----

# NOT + Nested AND/OR
query I nosort nested_conjunction1
EXPLAIN SELECT col0 FROM test WHERE NOT (col1 >= 3 OR (col2 < 2 AND col0 IS NOT DISTINCT FROM NULL))
----

query I nosort nested_conjunction1
EXPLAIN SELECT col0 FROM test WHERE col1 < 3 AND (col2 >= 2 OR col0 IS DISTINCT FROM NULL)
----

query I nosort nested_conjunction2
EXPLAIN SELECT col0 FROM test WHERE NOT (col1 >= 3 AND (col2 < 2 OR col0 IS DISTINCT FROM NULL))
----

query I nosort nested_conjunction2
EXPLAIN SELECT col0 FROM test WHERE col1 < 3 OR (col2 >= 2 AND col0 IS NOT DISTINCT FROM NULL)
----

query I nosort nested_conjunction3
EXPLAIN SELECT col0 FROM test WHERE NOT (col1 >= 3 AND (col2 < 2 AND (col0 = 0 OR col3 != 3)))
----

query I nosort nested_conjunction3
EXPLAIN SELECT col0 FROM test WHERE col1 < 3 OR (col2 >= 2 OR (col0 != 0 AND col3 = 3))
----
