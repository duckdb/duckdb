//===----------------------------------------------------------------------===//
//
//                         DuckDB
//
// duckdb/common/enums/metric_type.hpp
//
// This file is automatically generated by scripts/generate_metric_enums.py
// Do not edit this file manually, your changes will be overwritten
//===----------------------------------------------------------------------===//

#pragma once

#include "duckdb/common/types/value.hpp"
#include "duckdb/common/unordered_set.hpp"
#include "duckdb/common/constants.hpp"
#include "duckdb/common/enums/optimizer_type.hpp"

namespace duckdb {

enum class MetricGroup : uint8_t {
	ALL,
	CORE,
	DEFAULT,
	EXECUTION,
	FILE,
	OPERATOR,
	OPTIMIZER,
	PHASE_TIMING,
	INVALID,
};

enum class MetricType : uint8_t {
	// Core metrics
	CPU_TIME,
	CUMULATIVE_CARDINALITY,
	CUMULATIVE_ROWS_SCANNED,
	EXTRA_INFO,
	LATENCY,
	QUERY_NAME,
	RESULT_SET_SIZE,
	ROWS_RETURNED,
	// Execution metrics
	BLOCKED_THREAD_TIME,
	SYSTEM_PEAK_BUFFER_MEMORY,
	SYSTEM_PEAK_TEMP_DIR_SIZE,
	TOTAL_MEMORY_ALLOCATED,
	// File metrics
	ATTACH_LOAD_STORAGE_LATENCY,
	ATTACH_REPLAY_WAL_LATENCY,
	CHECKPOINT_LATENCY,
	COMMIT_LOCAL_STORAGE_LATENCY,
	TOTAL_BYTES_READ,
	TOTAL_BYTES_WRITTEN,
	WAITING_TO_ATTACH_LATENCY,
	WAL_REPLAY_ENTRY_COUNT,
	WRITE_TO_WAL_LATENCY,
	// Operator metrics
	OPERATOR_CARDINALITY,
	OPERATOR_NAME,
	OPERATOR_ROWS_SCANNED,
	OPERATOR_TIMING,
	OPERATOR_TYPE,
	// Optimizer metrics
	OPTIMIZER_EXPRESSION_REWRITER,
	OPTIMIZER_FILTER_PULLUP,
	OPTIMIZER_FILTER_PUSHDOWN,
	OPTIMIZER_EMPTY_RESULT_PULLUP,
	OPTIMIZER_CTE_FILTER_PUSHER,
	OPTIMIZER_REGEX_RANGE,
	OPTIMIZER_IN_CLAUSE,
	OPTIMIZER_JOIN_ORDER,
	OPTIMIZER_DELIMINATOR,
	OPTIMIZER_UNNEST_REWRITER,
	OPTIMIZER_UNUSED_COLUMNS,
	OPTIMIZER_STATISTICS_PROPAGATION,
	OPTIMIZER_COMMON_SUBEXPRESSIONS,
	OPTIMIZER_COMMON_AGGREGATE,
	OPTIMIZER_COLUMN_LIFETIME,
	OPTIMIZER_BUILD_SIDE_PROBE_SIDE,
	OPTIMIZER_LIMIT_PUSHDOWN,
	OPTIMIZER_ROW_GROUP_PRUNER,
	OPTIMIZER_TOP_N,
	OPTIMIZER_TOP_N_WINDOW_ELIMINATION,
	OPTIMIZER_COMPRESSED_MATERIALIZATION,
	OPTIMIZER_DUPLICATE_GROUPS,
	OPTIMIZER_REORDER_FILTER,
	OPTIMIZER_SAMPLING_PUSHDOWN,
	OPTIMIZER_JOIN_FILTER_PUSHDOWN,
	OPTIMIZER_EXTENSION,
	OPTIMIZER_MATERIALIZED_CTE,
	OPTIMIZER_SUM_REWRITER,
	OPTIMIZER_LATE_MATERIALIZATION,
	OPTIMIZER_CTE_INLINING,
	OPTIMIZER_COMMON_SUBPLAN,
	OPTIMIZER_JOIN_ELIMINATION,
	// PhaseTiming metrics
	ALL_OPTIMIZERS,
	CUMULATIVE_OPTIMIZER_TIMING,
	PHYSICAL_PLANNER,
	PHYSICAL_PLANNER_COLUMN_BINDING,
	PHYSICAL_PLANNER_CREATE_PLAN,
	PHYSICAL_PLANNER_RESOLVE_TYPES,
	PLANNER,
	PLANNER_BINDING,
};

struct MetricTypeHashFunction {
    uint64_t operator()(const MetricType &index) const {
        return std::hash<uint8_t>()(static_cast<uint8_t>(index));
    }
};

typedef unordered_set<MetricType, MetricTypeHashFunction> profiler_settings_t;
typedef unordered_map<MetricType, Value, MetricTypeHashFunction> profiler_metrics_t;

class MetricsUtils {
public:
	static constexpr uint8_t START_CORE = static_cast<uint8_t>(MetricType::CPU_TIME);
	static constexpr uint8_t END_CORE = static_cast<uint8_t>(MetricType::ROWS_RETURNED);

	static constexpr uint8_t START_EXECUTION = static_cast<uint8_t>(MetricType::BLOCKED_THREAD_TIME);
	static constexpr uint8_t END_EXECUTION = static_cast<uint8_t>(MetricType::TOTAL_MEMORY_ALLOCATED);

	static constexpr uint8_t START_FILE = static_cast<uint8_t>(MetricType::ATTACH_LOAD_STORAGE_LATENCY);
	static constexpr uint8_t END_FILE = static_cast<uint8_t>(MetricType::WRITE_TO_WAL_LATENCY);

	static constexpr uint8_t START_OPERATOR = static_cast<uint8_t>(MetricType::OPERATOR_CARDINALITY);
	static constexpr uint8_t END_OPERATOR = static_cast<uint8_t>(MetricType::OPERATOR_TYPE);

	static constexpr uint8_t START_OPTIMIZER = static_cast<uint8_t>(MetricType::OPTIMIZER_EXPRESSION_REWRITER);
	static constexpr uint8_t END_OPTIMIZER = static_cast<uint8_t>(MetricType::OPTIMIZER_JOIN_ELIMINATION);

	static constexpr uint8_t START_PHASE_TIMING = static_cast<uint8_t>(MetricType::ALL_OPTIMIZERS);
	static constexpr uint8_t END_PHASE_TIMING = static_cast<uint8_t>(MetricType::PLANNER_BINDING);

public:

	// All metrics
	static profiler_settings_t GetAllMetrics();
	static profiler_settings_t GetMetricsByGroupType(MetricGroup type);

	// Core metrics
	static profiler_settings_t GetCoreMetrics();
	static bool IsCoreMetric(MetricType type);

	// Default metrics
	static profiler_settings_t GetDefaultMetrics();
	static bool IsDefaultMetric(MetricType type);

	// Execution metrics
	static profiler_settings_t GetExecutionMetrics();
	static bool IsExecutionMetric(MetricType type);

	// File metrics
	static profiler_settings_t GetFileMetrics();
	static bool IsFileMetric(MetricType type);

	// Operator metrics
	static profiler_settings_t GetOperatorMetrics();
	static bool IsOperatorMetric(MetricType type);

	// Optimizer metrics
	static profiler_settings_t GetOptimizerMetrics();
	static bool IsOptimizerMetric(MetricType type);
	static MetricType GetOptimizerMetricByType(OptimizerType type);
	static OptimizerType GetOptimizerTypeByMetric(MetricType type);

	// PhaseTiming metrics
	static profiler_settings_t GetPhaseTimingMetrics();
	static bool IsPhaseTimingMetric(MetricType type);

	// RootScope metrics
	static profiler_settings_t GetRootScopeMetrics();
	static bool IsRootScopeMetric(MetricType type);
};
} // namespace duckdb
