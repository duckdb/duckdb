//===----------------------------------------------------------------------===//
//
//                         DuckDB
//
// duckdb/common/enums/metric_type.hpp
//
// This file is automatically generated by scripts/generate_metric_enums.py
// Do not edit this file manually, your changes will be overwritten
//===----------------------------------------------------------------------===//

#pragma once

#include "duckdb/common/types/value.hpp"
#include "duckdb/common/unordered_set.hpp"
#include "duckdb/common/constants.hpp"
#include "duckdb/common/enums/optimizer_type.hpp"

namespace duckdb {

enum class MetricGroup : uint8_t {
	ALL,
	CORE,
	DEFAULT,
	EXECUTION,
	FILE,
	OPERATOR,
	OPTIMIZER,
	PHASE_TIMING,
	INVALID,
};

enum class MetricType : uint8_t {
	// Core metrics
	CPU_TIME = 4,
	CUMULATIVE_CARDINALITY = 5,
	CUMULATIVE_ROWS_SCANNED = 6,
	EXTRA_INFO = 7,
	LATENCY = 8,
	QUERY_NAME = 14,
	RESULT_SET_SIZE = 15,
	ROWS_RETURNED = 16,
	// Execution metrics
	BLOCKED_THREAD_TIME = 2,
	SYSTEM_PEAK_BUFFER_MEMORY = 17,
	SYSTEM_PEAK_TEMP_DIR_SIZE = 18,
	TOTAL_MEMORY_ALLOCATED = 21,
	// File metrics
	ATTACH_LOAD_STORAGE_LATENCY = 0,
	ATTACH_REPLAY_WAL_LATENCY = 1,
	CHECKPOINT_LATENCY = 3,
	COMMIT_LOCAL_STORAGE_LATENCY = 23,
	TOTAL_BYTES_READ = 19,
	TOTAL_BYTES_WRITTEN = 20,
	WAITING_TO_ATTACH_LATENCY = 22,
	WAL_REPLAY_ENTRY_COUNT = 25,
	WRITE_TO_WAL_LATENCY = 24,
	// Operator metrics
	OPERATOR_CARDINALITY = 9,
	OPERATOR_NAME = 10,
	OPERATOR_ROWS_SCANNED = 11,
	OPERATOR_TIMING = 12,
	OPERATOR_TYPE = 13,
	// Optimizer metrics
	OPTIMIZER_EXPRESSION_REWRITER = 34,
	OPTIMIZER_FILTER_PULLUP = 35,
	OPTIMIZER_FILTER_PUSHDOWN = 36,
	OPTIMIZER_EMPTY_RESULT_PULLUP = 37,
	OPTIMIZER_CTE_FILTER_PUSHER = 38,
	OPTIMIZER_REGEX_RANGE = 39,
	OPTIMIZER_IN_CLAUSE = 40,
	OPTIMIZER_JOIN_ORDER = 41,
	OPTIMIZER_DELIMINATOR = 42,
	OPTIMIZER_UNNEST_REWRITER = 43,
	OPTIMIZER_UNUSED_COLUMNS = 44,
	OPTIMIZER_STATISTICS_PROPAGATION = 45,
	OPTIMIZER_COMMON_SUBEXPRESSIONS = 46,
	OPTIMIZER_COMMON_AGGREGATE = 47,
	OPTIMIZER_COLUMN_LIFETIME = 48,
	OPTIMIZER_BUILD_SIDE_PROBE_SIDE = 49,
	OPTIMIZER_LIMIT_PUSHDOWN = 50,
	OPTIMIZER_ROW_GROUP_PRUNER = 51,
	OPTIMIZER_TOP_N = 52,
	OPTIMIZER_TOP_N_WINDOW_ELIMINATION = 53,
	OPTIMIZER_COMPRESSED_MATERIALIZATION = 54,
	OPTIMIZER_DUPLICATE_GROUPS = 55,
	OPTIMIZER_REORDER_FILTER = 56,
	OPTIMIZER_SAMPLING_PUSHDOWN = 57,
	OPTIMIZER_JOIN_FILTER_PUSHDOWN = 58,
	OPTIMIZER_EXTENSION = 59,
	OPTIMIZER_MATERIALIZED_CTE = 60,
	OPTIMIZER_SUM_REWRITER = 61,
	OPTIMIZER_LATE_MATERIALIZATION = 62,
	OPTIMIZER_CTE_INLINING = 63,
	OPTIMIZER_COMMON_SUBPLAN = 64,
	OPTIMIZER_JOIN_ELIMINATION = 65,
	OPTIMIZER_WINDOW_SELF_JOIN = 66,
	// PhaseTiming metrics
	ALL_OPTIMIZERS = 26,
	CUMULATIVE_OPTIMIZER_TIMING = 27,
	PHYSICAL_PLANNER = 28,
	PHYSICAL_PLANNER_COLUMN_BINDING = 29,
	PHYSICAL_PLANNER_CREATE_PLAN = 30,
	PHYSICAL_PLANNER_RESOLVE_TYPES = 31,
	PLANNER = 32,
	PLANNER_BINDING = 33,
};

struct MetricTypeHashFunction {
    uint64_t operator()(const MetricType &index) const {
        return std::hash<uint8_t>()(static_cast<uint8_t>(index));
    }
};

typedef unordered_set<MetricType, MetricTypeHashFunction> profiler_settings_t;
typedef unordered_map<MetricType, Value, MetricTypeHashFunction> profiler_metrics_t;

class MetricsUtils {
public:
	static constexpr uint8_t START_OPTIMIZER = static_cast<uint8_t>(MetricType::OPTIMIZER_EXPRESSION_REWRITER);
	static constexpr uint8_t END_OPTIMIZER = static_cast<uint8_t>(MetricType::OPTIMIZER_WINDOW_SELF_JOIN);

public:

	// All metrics
	static profiler_settings_t GetAllMetrics();
	static profiler_settings_t GetMetricsByGroupType(MetricGroup type);

	// Core metrics
	static profiler_settings_t GetCoreMetrics();
	static bool IsCoreMetric(MetricType type);

	// Default metrics
	static profiler_settings_t GetDefaultMetrics();
	static bool IsDefaultMetric(MetricType type);

	// Execution metrics
	static profiler_settings_t GetExecutionMetrics();
	static bool IsExecutionMetric(MetricType type);

	// File metrics
	static profiler_settings_t GetFileMetrics();
	static bool IsFileMetric(MetricType type);

	// Operator metrics
	static profiler_settings_t GetOperatorMetrics();
	static bool IsOperatorMetric(MetricType type);

	// Optimizer metrics
	static profiler_settings_t GetOptimizerMetrics();
	static bool IsOptimizerMetric(MetricType type);
	static MetricType GetOptimizerMetricByType(OptimizerType type);
	static OptimizerType GetOptimizerTypeByMetric(MetricType type);

	// PhaseTiming metrics
	static profiler_settings_t GetPhaseTimingMetrics();
	static bool IsPhaseTimingMetric(MetricType type);

	// RootScope metrics
	static profiler_settings_t GetRootScopeMetrics();
	static bool IsRootScopeMetric(MetricType type);
};
} // namespace duckdb
