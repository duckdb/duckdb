diff --git a/src/ducklake_extension.cpp b/src/ducklake_extension.cpp
index 1064250..5a6fc2b 100644
--- a/src/ducklake_extension.cpp
+++ b/src/ducklake_extension.cpp
@@ -5,6 +5,7 @@
 #include "storage/ducklake_storage.hpp"
 #include "functions/ducklake_table_functions.hpp"
 #include "storage/ducklake_secret.hpp"
+#include "duckdb/storage/storage_extension.hpp"
 
 namespace duckdb {
 
@@ -12,7 +13,7 @@ static void LoadInternal(ExtensionLoader &loader) {
 	loader.SetDescription("Adds support for DuckLake, SQL as a Lakehouse Format");
 
 	auto &config = DBConfig::GetConfig(loader.GetDatabaseInstance());
-	config.storage_extensions["ducklake"] = make_uniq<DuckLakeStorageExtension>();
+	StorageExtension::Register(config, "ducklake", make_shared_ptr<DuckLakeStorageExtension>());
 
 	config.AddExtensionOption("ducklake_max_retry_count",
 	                          "The maximum amount of retry attempts for a ducklake transaction", LogicalType::UBIGINT,
diff --git a/src/functions/ducklake_add_data_files.cpp b/src/functions/ducklake_add_data_files.cpp
index 27f3051..5264af9 100644
--- a/src/functions/ducklake_add_data_files.cpp
+++ b/src/functions/ducklake_add_data_files.cpp
@@ -184,8 +184,8 @@ FROM parquet_full_metadata(%s)
 	}
 
 	for (auto &row : *result) {
-		auto &chunk = *row.iterator.chunk;
-		idx_t row_idx = row.row;
+		auto &chunk = row.GetChunk();
+		idx_t row_idx = row.GetRowInChunk();
 
 		auto &file_metadata_vec = chunk.data[0];
 		auto &parquet_metadata_vec = chunk.data[1];
diff --git a/src/functions/ducklake_compaction_functions.cpp b/src/functions/ducklake_compaction_functions.cpp
index 65793fd..dc56801 100644
--- a/src/functions/ducklake_compaction_functions.cpp
+++ b/src/functions/ducklake_compaction_functions.cpp
@@ -35,7 +35,7 @@ DuckLakeCompaction::DuckLakeCompaction(PhysicalPlan &physical_plan, const vector
 //===--------------------------------------------------------------------===//
 // GetData
 //===--------------------------------------------------------------------===//
-SourceResultType DuckLakeCompaction::GetData(ExecutionContext &context, DataChunk &chunk,
+SourceResultType DuckLakeCompaction::GetDataInternal(ExecutionContext &context, DataChunk &chunk,
                                              OperatorSourceInput &input) const {
 	return SourceResultType::FINISHED;
 }
diff --git a/src/functions/ducklake_flush_inlined_data.cpp b/src/functions/ducklake_flush_inlined_data.cpp
index 0308b0e..73601b8 100644
--- a/src/functions/ducklake_flush_inlined_data.cpp
+++ b/src/functions/ducklake_flush_inlined_data.cpp
@@ -34,7 +34,7 @@ DuckLakeFlushData::DuckLakeFlushData(PhysicalPlan &physical_plan, const vector<L
 //===--------------------------------------------------------------------===//
 // GetData
 //===--------------------------------------------------------------------===//
-SourceResultType DuckLakeFlushData::GetData(ExecutionContext &context, DataChunk &chunk,
+SourceResultType DuckLakeFlushData::GetDataInternal(ExecutionContext &context, DataChunk &chunk,
                                             OperatorSourceInput &input) const {
 	return SourceResultType::FINISHED;
 }
diff --git a/src/include/storage/ducklake_compaction.hpp b/src/include/storage/ducklake_compaction.hpp
index 2542578..a669b67 100644
--- a/src/include/storage/ducklake_compaction.hpp
+++ b/src/include/storage/ducklake_compaction.hpp
@@ -35,7 +35,7 @@ public:
 
 public:
 	// // Source interface
-	SourceResultType GetData(ExecutionContext &context, DataChunk &chunk, OperatorSourceInput &input) const override;
+	SourceResultType GetDataInternal(ExecutionContext &context, DataChunk &chunk, OperatorSourceInput &input) const override;
 
 	bool IsSource() const override {
 		return true;
diff --git a/src/include/storage/ducklake_delete.hpp b/src/include/storage/ducklake_delete.hpp
index c0978de..2d8e976 100644
--- a/src/include/storage/ducklake_delete.hpp
+++ b/src/include/storage/ducklake_delete.hpp
@@ -76,7 +76,7 @@ public:
 
 public:
 	// // Source interface
-	SourceResultType GetData(ExecutionContext &context, DataChunk &chunk, OperatorSourceInput &input) const override;
+	SourceResultType GetDataInternal(ExecutionContext &context, DataChunk &chunk, OperatorSourceInput &input) const override;
 
 	bool IsSource() const override {
 		return true;
diff --git a/src/include/storage/ducklake_flush_data.hpp b/src/include/storage/ducklake_flush_data.hpp
index 1a1c31d..589942e 100644
--- a/src/include/storage/ducklake_flush_data.hpp
+++ b/src/include/storage/ducklake_flush_data.hpp
@@ -31,7 +31,7 @@ public:
 
 public:
 	// // Source interface
-	SourceResultType GetData(ExecutionContext &context, DataChunk &chunk, OperatorSourceInput &input) const override;
+	SourceResultType GetDataInternal(ExecutionContext &context, DataChunk &chunk, OperatorSourceInput &input) const override;
 
 	bool IsSource() const override {
 		return true;
diff --git a/src/include/storage/ducklake_insert.hpp b/src/include/storage/ducklake_insert.hpp
index 7460cb7..29c419a 100644
--- a/src/include/storage/ducklake_insert.hpp
+++ b/src/include/storage/ducklake_insert.hpp
@@ -63,7 +63,7 @@ public:
 
 public:
 	// // Source interface
-	SourceResultType GetData(ExecutionContext &context, DataChunk &chunk, OperatorSourceInput &input) const override;
+	SourceResultType GetDataInternal(ExecutionContext &context, DataChunk &chunk, OperatorSourceInput &input) const override;
 
 	bool IsSource() const override {
 		return true;
diff --git a/src/include/storage/ducklake_multi_file_list.hpp b/src/include/storage/ducklake_multi_file_list.hpp
index bddd741..3cc202f 100644
--- a/src/include/storage/ducklake_multi_file_list.hpp
+++ b/src/include/storage/ducklake_multi_file_list.hpp
@@ -29,54 +29,50 @@ public:
 	DuckLakeMultiFileList(DuckLakeFunctionInfo &read_info, vector<DuckLakeFileListEntry> files_to_scan);
 	DuckLakeMultiFileList(DuckLakeFunctionInfo &read_info, const DuckLakeInlinedTableInfo &inlined_table);
 
-	unique_ptr<MultiFileList> ComplexFilterPushdown(ClientContext &context, const MultiFileOptions &options,
-	                                                MultiFilePushdownInfo &info,
-	                                                vector<unique_ptr<Expression>> &filters) override;
-
 	unique_ptr<MultiFileList> DynamicFilterPushdown(ClientContext &context, const MultiFileOptions &options,
 	                                                const vector<string> &names, const vector<LogicalType> &types,
 	                                                const vector<column_t> &column_ids,
 	                                                TableFilterSet &filters) const override;
 
-	vector<OpenFileInfo> GetAllFiles() override;
-	FileExpandResult GetExpandResult() override;
-	idx_t GetTotalFileCount() override;
-	unique_ptr<NodeStatistics> GetCardinality(ClientContext &context) override;
+	vector<OpenFileInfo> GetAllFiles() const override;
+	FileExpandResult GetExpandResult() const override;
+	idx_t GetTotalFileCount() const override;
+	unique_ptr<NodeStatistics> GetCardinality(ClientContext &context) const override;
 	DuckLakeTableEntry &GetTable();
-	unique_ptr<MultiFileList> Copy() override;
+	unique_ptr<MultiFileList> Copy() const override;
 	bool HasTransactionLocalData() const {
 		return !transaction_local_files.empty() || transaction_local_data;
 	}
-	vector<DuckLakeFileListExtendedEntry> GetFilesExtended();
-	const vector<DuckLakeFileListEntry> &GetFiles();
-	const DuckLakeFileListEntry &GetFileEntry(idx_t file_idx);
+	vector<DuckLakeFileListExtendedEntry> GetFilesExtended() const;
+	const vector<DuckLakeFileListEntry> &GetFiles() const;
+	const DuckLakeFileListEntry &GetFileEntry(idx_t file_idx) const;
 
 	bool IsDeleteScan() const;
 	const DuckLakeDeleteScanEntry &GetDeleteScanEntry(idx_t file_idx);
 
 protected:
 	//! Get the i-th expanded file
-	OpenFileInfo GetFile(idx_t i) override;
+	OpenFileInfo GetFile(idx_t i) const override;
 
 private:
-	void GetFilesForTable();
-	void GetTableInsertions();
-	void GetTableDeletions();
+	void GetFilesForTable() const;
+	void GetTableInsertions() const;
+	void GetTableDeletions() const;
 
 private:
-	mutex file_lock;
+	mutable mutex file_lock;
 	DuckLakeFunctionInfo &read_info;
 	//! The set of files to read
-	vector<DuckLakeFileListEntry> files;
-	bool read_file_list;
+	mutable vector<DuckLakeFileListEntry> files;
+	mutable bool read_file_list;
 	//! The set of transaction-local files
 	vector<DuckLakeDataFile> transaction_local_files;
 	//! Inlined transaction-local data
 	shared_ptr<DuckLakeInlinedData> transaction_local_data;
 	//! Inlined data tables
-	vector<DuckLakeInlinedTableInfo> inlined_data_tables;
+	mutable vector<DuckLakeInlinedTableInfo> inlined_data_tables;
 	//! The set of delete scans, only used when scanning deleted tuples using ducklake_table_deletions
-	vector<DuckLakeDeleteScanEntry> delete_scans;
+	mutable vector<DuckLakeDeleteScanEntry> delete_scans;
 	//! The filter to apply
 	string filter;
 };
diff --git a/src/include/storage/ducklake_update.hpp b/src/include/storage/ducklake_update.hpp
index c2e2972..4dbb737 100644
--- a/src/include/storage/ducklake_update.hpp
+++ b/src/include/storage/ducklake_update.hpp
@@ -34,7 +34,7 @@ public:
 
 public:
 	// // Source interface
-	SourceResultType GetData(ExecutionContext &context, DataChunk &chunk, OperatorSourceInput &input) const override;
+	SourceResultType GetDataInternal(ExecutionContext &context, DataChunk &chunk, OperatorSourceInput &input) const override;
 
 	bool IsSource() const override {
 		return true;
diff --git a/src/storage/ducklake_autoload_helper.cpp b/src/storage/ducklake_autoload_helper.cpp
index 3d8396f..7237e72 100644
--- a/src/storage/ducklake_autoload_helper.cpp
+++ b/src/storage/ducklake_autoload_helper.cpp
@@ -27,8 +27,7 @@ void DuckLakeInitializer::CheckAndAutoloadedRequiredExtension(const string &patt
 
 	string required_extension = LookupExtensionForPattern(pattern);
 	if (!required_extension.empty() && !context.db->ExtensionIsLoaded(required_extension)) {
-		auto &dbconfig = DBConfig::GetConfig(context);
-		if (!ExtensionHelper::CanAutoloadExtension(required_extension) || !dbconfig.options.autoload_known_extensions) {
+		if (!ExtensionHelper::CanAutoloadExtension(required_extension) || !Settings::Get<AutoloadKnownExtensionsSetting>(context)) {
 			auto error_message =
 			    "Data path " + pattern + " requires the extension " + required_extension + " to be loaded";
 			error_message =
diff --git a/src/storage/ducklake_delete.cpp b/src/storage/ducklake_delete.cpp
index 024a1c2..69f6466 100644
--- a/src/storage/ducklake_delete.cpp
+++ b/src/storage/ducklake_delete.cpp
@@ -399,7 +399,7 @@ SinkFinalizeType DuckLakeDelete::Finalize(Pipeline &pipeline, Event &event, Clie
 //===--------------------------------------------------------------------===//
 // GetData
 //===--------------------------------------------------------------------===//
-SourceResultType DuckLakeDelete::GetData(ExecutionContext &context, DataChunk &chunk,
+SourceResultType DuckLakeDelete::GetDataInternal(ExecutionContext &context, DataChunk &chunk,
                                          OperatorSourceInput &input) const {
 	auto &global_state = sink_state->Cast<DuckLakeDeleteGlobalState>();
 	auto value = Value::BIGINT(NumericCast<int64_t>(global_state.total_deleted_count));
diff --git a/src/storage/ducklake_insert.cpp b/src/storage/ducklake_insert.cpp
index d14f968..fc1ab36 100644
--- a/src/storage/ducklake_insert.cpp
+++ b/src/storage/ducklake_insert.cpp
@@ -16,11 +16,13 @@
 #include "duckdb/planner/operator/logical_create_table.hpp"
 #include "duckdb/planner/parsed_data/bound_create_table_info.hpp"
 #include "duckdb/planner/expression/bound_cast_expression.hpp"
+#include "duckdb/planner/expression/bound_columnref_expression.hpp"
 #include "duckdb/planner/expression/bound_reference_expression.hpp"
 #include "duckdb/common/multi_file/multi_file_reader.hpp"
 #include "duckdb/main/extension_helper.hpp"
 #include "duckdb/function/function_binder.hpp"
 #include "duckdb/planner/operator/logical_projection.hpp"
+#include "duckdb/planner/binder.hpp"
 
 namespace duckdb {
 
@@ -205,7 +207,7 @@ SinkResultType DuckLakeInsert::Sink(ExecutionContext &context, DataChunk &chunk,
 //===--------------------------------------------------------------------===//
 // GetData
 //===--------------------------------------------------------------------===//
-SourceResultType DuckLakeInsert::GetData(ExecutionContext &context, DataChunk &chunk,
+SourceResultType DuckLakeInsert::GetDataInternal(ExecutionContext &context, DataChunk &chunk,
                                          OperatorSourceInput &input) const {
 	auto &global_state = sink_state->Cast<DuckLakeInsertGlobalState>();
 	auto value = Value::BIGINT(NumericCast<int64_t>(global_state.total_insert_count));
@@ -250,7 +252,7 @@ CopyFunctionCatalogEntry &DuckLakeFunctions::GetCopyFunction(ClientContext &cont
 	// name), but that do not offer enough control
 	auto &db = *context.db;
 	string extension_name = ExtensionHelper::FindExtensionInEntries(name, EXTENSION_COPY_FUNCTIONS);
-	if (!extension_name.empty() && db.config.options.autoload_known_extensions &&
+	if (!extension_name.empty() && Settings::Get<AutoloadKnownExtensionsSetting>(context) &&
 	    ExtensionHelper::CanAutoloadExtension(extension_name)) {
 		// This will either succeed or throw
 		ExtensionHelper::AutoLoadExtension(db, extension_name);
diff --git a/src/storage/ducklake_merge_into.cpp b/src/storage/ducklake_merge_into.cpp
index 51ffef0..e55ffd0 100644
--- a/src/storage/ducklake_merge_into.cpp
+++ b/src/storage/ducklake_merge_into.cpp
@@ -32,7 +32,7 @@ public:
 
 public:
 	// Source interface
-	SourceResultType GetData(ExecutionContext &context, DataChunk &chunk, OperatorSourceInput &input) const override;
+	SourceResultType GetDataInternal(ExecutionContext &context, DataChunk &chunk, OperatorSourceInput &input) const override;
 
 	bool IsSource() const override {
 		return true;
@@ -61,7 +61,7 @@ DuckLakeMergeInsert::DuckLakeMergeInsert(PhysicalPlan &physical_plan, const vect
     : PhysicalOperator(physical_plan, PhysicalOperatorType::EXTENSION, types, 1), copy(copy), insert(insert) {
 }
 
-SourceResultType DuckLakeMergeInsert::GetData(ExecutionContext &context, DataChunk &chunk,
+SourceResultType DuckLakeMergeInsert::GetDataInternal(ExecutionContext &context, DataChunk &chunk,
                                               OperatorSourceInput &input) const {
 	return SourceResultType::FINISHED;
 }
diff --git a/src/storage/ducklake_metadata_manager.cpp b/src/storage/ducklake_metadata_manager.cpp
index 7ebb3ed..5fe0a8e 100644
--- a/src/storage/ducklake_metadata_manager.cpp
+++ b/src/storage/ducklake_metadata_manager.cpp
@@ -2158,9 +2158,7 @@ WHERE table_id=tid AND column_id=cid
 	}
 }
 
-template <class T>
-static timestamp_tz_t GetTimestampTZFromRow(ClientContext &context, const T &row, idx_t col_idx) {
-	auto val = row.iterator.chunk->GetValue(col_idx, row.row);
+static timestamp_tz_t GetTimestampTZFromRow(ClientContext &context, const Value &val) {
 	return val.CastAs(context, LogicalType::TIMESTAMP_TZ).template GetValue<timestamp_tz_t>();
 }
 
@@ -2183,12 +2181,12 @@ ORDER BY snapshot_id
 	for (auto &row : *res) {
 		DuckLakeSnapshotInfo snapshot_info;
 		snapshot_info.id = row.GetValue<idx_t>(0);
-		snapshot_info.time = GetTimestampTZFromRow(*context, row, 1);
+		snapshot_info.time = GetTimestampTZFromRow(*context, row.GetBaseValue(1));
 		snapshot_info.schema_version = row.GetValue<idx_t>(2);
 		snapshot_info.change_info.changes_made = row.IsNull(3) ? string() : row.GetValue<string>(3);
-		snapshot_info.author = row.iterator.chunk->GetValue(4, row.row);
-		snapshot_info.commit_message = row.iterator.chunk->GetValue(5, row.row);
-		snapshot_info.commit_extra_info = row.iterator.chunk->GetValue(6, row.row);
+		snapshot_info.author = row.GetBaseValue(4);
+		snapshot_info.commit_message = row.GetBaseValue(5);
+		snapshot_info.commit_extra_info = row.GetBaseValue(6);
 		snapshots.push_back(std::move(snapshot_info));
 	}
 	return snapshots;
@@ -2212,7 +2210,7 @@ FROM {METADATA_CATALOG}.ducklake_files_scheduled_for_deletion
 		path.path = row.GetValue<string>(1);
 		path.path_is_relative = row.GetValue<bool>(2);
 		info.path = FromRelativePath(path);
-		info.time = GetTimestampTZFromRow(*context, row, 3);
+		info.time = GetTimestampTZFromRow(*context, row.GetBaseValue(3));
 		result.push_back(std::move(info));
 	}
 	return result;
diff --git a/src/storage/ducklake_multi_file_list.cpp b/src/storage/ducklake_multi_file_list.cpp
index 7a826f8..0c74636 100644
--- a/src/storage/ducklake_multi_file_list.cpp
+++ b/src/storage/ducklake_multi_file_list.cpp
@@ -25,20 +25,20 @@ namespace duckdb {
 DuckLakeMultiFileList::DuckLakeMultiFileList(DuckLakeFunctionInfo &read_info,
                                              vector<DuckLakeDataFile> transaction_local_files_p,
                                              shared_ptr<DuckLakeInlinedData> transaction_local_data_p, string filter_p)
-    : MultiFileList(vector<OpenFileInfo> {}, FileGlobOptions::ALLOW_EMPTY), read_info(read_info), read_file_list(false),
+    : read_info(read_info), read_file_list(false),
       transaction_local_files(std::move(transaction_local_files_p)),
       transaction_local_data(std::move(transaction_local_data_p)), filter(std::move(filter_p)) {
 }
 
 DuckLakeMultiFileList::DuckLakeMultiFileList(DuckLakeFunctionInfo &read_info,
                                              vector<DuckLakeFileListEntry> files_to_scan)
-    : MultiFileList(vector<OpenFileInfo> {}, FileGlobOptions::ALLOW_EMPTY), read_info(read_info),
+    : read_info(read_info),
       files(std::move(files_to_scan)), read_file_list(true) {
 }
 
 DuckLakeMultiFileList::DuckLakeMultiFileList(DuckLakeFunctionInfo &read_info,
                                              const DuckLakeInlinedTableInfo &inlined_table)
-    : MultiFileList(vector<OpenFileInfo> {}, FileGlobOptions::ALLOW_EMPTY), read_info(read_info), read_file_list(true) {
+    : read_info(read_info), read_file_list(true) {
 	DuckLakeFileListEntry file_entry;
 	file_entry.file.path = inlined_table.table_name;
 	file_entry.row_id_start = 0;
@@ -47,13 +47,6 @@ DuckLakeMultiFileList::DuckLakeMultiFileList(DuckLakeFunctionInfo &read_info,
 	inlined_data_tables.push_back(inlined_table);
 }
 
-unique_ptr<MultiFileList> DuckLakeMultiFileList::ComplexFilterPushdown(ClientContext &context,
-                                                                       const MultiFileOptions &options,
-                                                                       MultiFilePushdownInfo &info,
-                                                                       vector<unique_ptr<Expression>> &filters) {
-	return nullptr;
-}
-
 bool ValueIsFinite(const Value &val) {
 	if (val.type().id() != LogicalTypeId::FLOAT && val.type().id() != LogicalTypeId::DOUBLE) {
 		return true;
@@ -299,7 +292,7 @@ DuckLakeMultiFileList::DynamicFilterPushdown(ClientContext &context, const Multi
 	return nullptr;
 }
 
-vector<OpenFileInfo> DuckLakeMultiFileList::GetAllFiles() {
+vector<OpenFileInfo> DuckLakeMultiFileList::GetAllFiles() const {
 	vector<OpenFileInfo> file_list;
 	for (idx_t i = 0; i < GetTotalFileCount(); i++) {
 		file_list.push_back(GetFile(i));
@@ -307,15 +300,15 @@ vector<OpenFileInfo> DuckLakeMultiFileList::GetAllFiles() {
 	return file_list;
 }
 
-FileExpandResult DuckLakeMultiFileList::GetExpandResult() {
+FileExpandResult DuckLakeMultiFileList::GetExpandResult() const {
 	return FileExpandResult::MULTIPLE_FILES;
 }
 
-idx_t DuckLakeMultiFileList::GetTotalFileCount() {
+idx_t DuckLakeMultiFileList::GetTotalFileCount() const {
 	return GetFiles().size();
 }
 
-unique_ptr<NodeStatistics> DuckLakeMultiFileList::GetCardinality(ClientContext &context) {
+unique_ptr<NodeStatistics> DuckLakeMultiFileList::GetCardinality(ClientContext &context) const {
 	auto stats = read_info.table.GetTableStats(context);
 	if (!stats) {
 		return nullptr;
@@ -327,7 +320,7 @@ DuckLakeTableEntry &DuckLakeMultiFileList::GetTable() {
 	return read_info.table;
 }
 
-OpenFileInfo DuckLakeMultiFileList::GetFile(idx_t i) {
+OpenFileInfo DuckLakeMultiFileList::GetFile(idx_t i) const {
 	auto &files = GetFiles();
 	if (i >= files.size()) {
 		return OpenFileInfo();
@@ -393,7 +386,7 @@ OpenFileInfo DuckLakeMultiFileList::GetFile(idx_t i) {
 	return result;
 }
 
-unique_ptr<MultiFileList> DuckLakeMultiFileList::Copy() {
+unique_ptr<MultiFileList> DuckLakeMultiFileList::Copy() const {
 	auto result = make_uniq<DuckLakeMultiFileList>(read_info, transaction_local_files, transaction_local_data, filter);
 	result->files = GetFiles();
 	result->read_file_list = read_file_list;
@@ -401,7 +394,7 @@ unique_ptr<MultiFileList> DuckLakeMultiFileList::Copy() {
 	return std::move(result);
 }
 
-const DuckLakeFileListEntry &DuckLakeMultiFileList::GetFileEntry(idx_t file_idx) {
+const DuckLakeFileListEntry &DuckLakeMultiFileList::GetFileEntry(idx_t file_idx) const {
 	auto &files = GetFiles();
 	return files[file_idx];
 }
@@ -428,7 +421,7 @@ DuckLakeFileData GetDeleteData(const DuckLakeDataFile &file) {
 	return result;
 }
 
-vector<DuckLakeFileListExtendedEntry> DuckLakeMultiFileList::GetFilesExtended() {
+vector<DuckLakeFileListExtendedEntry> DuckLakeMultiFileList::GetFilesExtended() const {
 	lock_guard<mutex> l(file_lock);
 	vector<DuckLakeFileListExtendedEntry> result;
 	auto transaction_ref = read_info.GetTransaction();
@@ -500,7 +493,7 @@ vector<DuckLakeFileListExtendedEntry> DuckLakeMultiFileList::GetFilesExtended()
 	return result;
 }
 
-void DuckLakeMultiFileList::GetFilesForTable() {
+void DuckLakeMultiFileList::GetFilesForTable() const {
 	auto transaction_ref = read_info.GetTransaction();
 	auto &transaction = *transaction_ref;
 	if (!read_info.table_id.IsTransactionLocal()) {
@@ -550,7 +543,7 @@ void DuckLakeMultiFileList::GetFilesForTable() {
 	}
 }
 
-void DuckLakeMultiFileList::GetTableInsertions() {
+void DuckLakeMultiFileList::GetTableInsertions() const {
 	if (read_info.table_id.IsTransactionLocal()) {
 		throw InternalException("Cannot get changes between snapshots for transaction-local files");
 	}
@@ -569,7 +562,7 @@ void DuckLakeMultiFileList::GetTableInsertions() {
 	}
 }
 
-void DuckLakeMultiFileList::GetTableDeletions() {
+void DuckLakeMultiFileList::GetTableDeletions() const {
 	if (read_info.table_id.IsTransactionLocal()) {
 		throw InternalException("Cannot get changes between snapshots for transaction-local files");
 	}
@@ -604,7 +597,7 @@ const DuckLakeDeleteScanEntry &DuckLakeMultiFileList::GetDeleteScanEntry(idx_t f
 	return delete_scans[file_idx];
 }
 
-const vector<DuckLakeFileListEntry> &DuckLakeMultiFileList::GetFiles() {
+const vector<DuckLakeFileListEntry> &DuckLakeMultiFileList::GetFiles() const {
 	lock_guard<mutex> l(file_lock);
 	if (!read_file_list) {
 		// we have not read the file list yet - read it
diff --git a/src/storage/ducklake_transaction.cpp b/src/storage/ducklake_transaction.cpp
index 29634fd..147ba95 100644
--- a/src/storage/ducklake_transaction.cpp
+++ b/src/storage/ducklake_transaction.cpp
@@ -2,6 +2,7 @@
 
 #include "common/ducklake_types.hpp"
 #include "common/ducklake_util.hpp"
+#include "duckdb/catalog/catalog_search_path.hpp"
 #include "duckdb/common/thread.hpp"
 #include "duckdb/common/types/uuid.hpp"
 #include "duckdb/main/attached_database.hpp"
diff --git a/src/storage/ducklake_transaction_manager.cpp b/src/storage/ducklake_transaction_manager.cpp
index 4ebc45f..d8ffb3d 100644
--- a/src/storage/ducklake_transaction_manager.cpp
+++ b/src/storage/ducklake_transaction_manager.cpp
@@ -11,7 +11,7 @@ DuckLakeTransactionManager::DuckLakeTransactionManager(AttachedDatabase &db_p, D
 Transaction &DuckLakeTransactionManager::StartTransaction(ClientContext &context) {
 	auto transaction = make_shared_ptr<DuckLakeTransaction>(ducklake_catalog, *this, context);
 	transaction->Start();
-	if (DBConfig::GetSetting<ImmediateTransactionModeSetting>(context) && get_snapshot) {
+	if (Settings::Get<ImmediateTransactionModeSetting>(context) && get_snapshot) {
 		get_snapshot = false;
 		// no snapshot loaded yet for this transaction - load it
 		transaction->GetSnapshot();
diff --git a/src/storage/ducklake_update.cpp b/src/storage/ducklake_update.cpp
index f0bd68e..f2e5cc6 100644
--- a/src/storage/ducklake_update.cpp
+++ b/src/storage/ducklake_update.cpp
@@ -11,6 +11,7 @@
 #include "duckdb/parallel/thread_context.hpp"
 #include "duckdb/parser/expression/cast_expression.hpp"
 #include "duckdb/planner/expression/bound_cast_expression.hpp"
+#include "duckdb/planner/expression/bound_columnref_expression.hpp"
 #include "duckdb/planner/expression/bound_function_expression.hpp"
 #include "duckdb/planner/operator/logical_get.hpp"
 #include "duckdb/planner/operator/logical_projection.hpp"
@@ -207,7 +208,7 @@ SinkFinalizeType DuckLakeUpdate::Finalize(Pipeline &pipeline, Event &event, Clie
 //===--------------------------------------------------------------------===//
 // GetData
 //===--------------------------------------------------------------------===//
-SourceResultType DuckLakeUpdate::GetData(ExecutionContext &context, DataChunk &chunk,
+SourceResultType DuckLakeUpdate::GetDataInternal(ExecutionContext &context, DataChunk &chunk,
                                          OperatorSourceInput &input) const {
 	auto &global_state = sink_state->Cast<DuckLakeUpdateGlobalState>();
 	auto value = Value::BIGINT(NumericCast<int64_t>(global_state.total_updated_count.load()));
